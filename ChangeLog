2002-12-28  Alexander Chernov  <cher@ispras.ru>

	* serve.c:
	(update_standings_file) compiler warning about use of uninitialized
	  variable is fixed.

	* master_html.c:
	(write_all_runs) compiler warnings about use of uninitialized
	  variables are fixed;
	(write_all_clars) the same.

	* master.c:
	(send_msg_if_asked) compiler warning about use of uninitialized
	  variable is fixed.

	* html.c:
	(do_write_standings) compiler warning about use of uninitialized
	  variable is fixed.

	* contests.c:
	(parse_contest_xml) compiler warning about use of uninitialized
	  variable is fixed.

	* users.c: 
	(main) a backdoor is removed.

	* userlist-server.c:
	(login_team_user) "possibly use of unitialized variable" warning
	  is fixed;
	(cmd_login_priv_user) the same;
	(login_team_cookie) the same;
	(login_priv_cookie) the same;
	(do_list_users) in raw output mode if a team does not have
	  participants, it is now printed anyway;
	  invisible users are not printed in user lists.

	* team.c:
	(send_clar_if_asked) in virtual contest mode contest start and stop
	  times are not checked;
	(submit_if_asked) the same as above.

	* team.c:
	(display_enter_password) default session mode is 2 (SID_URL).

	* runlog.h: 
	(run_get_virtual_status) new function prototype.

	* runlog.c:
	(run_get_virtual_status) a new function, which returns the virtuality
	  status of the given user;
	(run_virtual_start) virtuality status of the user is set to virtual;
	(run_virtual_stop) checked, that the user is virtual.

	* prepare.h, prepare.c:
	new global parameters: `standings_virtual_team_color',
	  `standings_real_team_color'.

	* html.c:
	(do_write_standings) global parameters `standings_real_team_color',
	  `standings_virtual_team_color' are supported.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

2002-12-27  Alexander Chernov  <cher@ispras.ru>

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* team.c: GLOBAL CHANGE: virtual contest mode is supported;
	(make_self_url) `REDIRECT_URL' environment variable is checked;
	(print_standings_button) new function to print the standings button;
	(show_clar_if_asked) `print_nav_buttons' accepts 3 parameters instead
	  of 2;
	(request_source_if_asked) the same as above;
	(action_stangings) new function to generate virtual standings in
	  the virtual contest mode;
	(request_report_if_asked) `print_nav_buttons' accepts 3 parameters instead
	  of 2;
	(action_virtual_start) new function to start the virtual contest;
	(action_virtual_stop) new function to stop the virtual contest;
	(print_nav_buttons) now accepts 3 parameters instead of 2. The
	  second parameter is now "Virtual standings" label; the 3rd
	  parameter is "Log out" label;
	(main) client actions `ACTION_START_VIRTUAL', `ACTION_STOP_VIRTUAL',
	  `ACTION_STANGINGS' are supported;
	  `print_nav_buttons' accepts 3 parameters instead of 2.

	* serve.c: GLOBAL CHANGE: virtual contests are supported;
	(update_standings_file) fog time is not checked when in virtual
	  contest mode;
	(update_status_file) `is_virtual' flag of the status structure
	  is filled;
	  standings are never frozen in virtual contest mode;
	(cmd_team_show_item) `SRV_CMD_VIRTUAL_STANDINGS' request is
	  handled;
	(cmd_team_submit_run) virtual contests are supported: duration is
	  counted relative to the participant's contest start time;
	(cmd_team_submit_clar) the same as above;
	(cmd_command_0) a new function to handle unprivileged command with 0
	  or 1 parameter;
	  `SRV_CMD_VIRTUAL_START', `SRV_CMD_VIRTUAL_STOP' commands are
	  handled;
	(cmd_judge_command_0) a new function to handle commands with 0 or 1
	  parameter, which are allowed for any user with privileges;
	  `SRV_CMD_RESET_FILTER' command is handled;
	(packet_handlers) handlers for the new commands
	  `SRV_CMD_VIRTUAL_STOP', `SRV_CMD_VIRTUAL_START',
	  `SRV_CMD_VIRTUAL_STANDINGS', `SRV_CMD_RESET_FILTER' are added;
	(do_loop) fog period is not checked in virtual contest mode;
	  contest is never auto-started and auto-stopped in virtual contest
	  mode;
	(main) if virtual contest is requested for not SCORE_ACM scoring
	  system, an error is printed;
	  `run_build_virtual_table' is called in virtual contest mode.

	* runlog.h:
	new run entry statuses: `RUN_VIRTUAL_START', `RUN_VIRTUAL_STOP';
	(run_get_duration) new function prototype;
	(run_build_virtual_table) new function prototype;
	(run_get_virtual_start_time) new function prototype;
	(run_get_virtual_stop_time) new function prototype;
	(run_virtual_start) new function prototype;
	(run_virtual_stop) new function prototype.

	* runlog.c:
	(append_record) new static function to add a new record to the log;
	(run_add_record) `append_record' function is used to create a new
	  record;
	(run_change_status) status of `RUN_VIRTUAL_START', `RUN_VIRTUAL_STOP'
	  entries cannot be changed;
	(run_get_duration) a new function to return the contest duration;
	(run_status_str) `RUN_VIRTUAL_START', `RUN_VIRTUAL_STOP' are
	  supported;
	(run_set_entry) `RUN_VIRTUAL_START', `RUN_VIRTUAL_STOP' entries
	  cannot be edited;
	(struct vt_entry) new structure to hold the virtual contest status
	  for all the participants;
	(get_entry) new static function to create a new virtual participant
	  entry, if such does not exist, and return the entry;
	(run_build_virtual_table) new function to build the virtual
	  participation table by the run log;
	(run_get_virtual_start_time) new function to return the virtual
	  contest start time for the given user;
	(run_get_virtual_stop_time) new function to return the virtual
	  contest stop time for the given user;
	(run_virtual_start) new function to start the virtual contest for
	  the given user;
	(run_virtual_stop) new function to stop the virtual contest for
	  the given user.

	* protocol.h: (struct prot_serve_status) field `is_virtual' added;
	several new commands added: `SRV_CMD_VIRTUAL_START',
	  `SRV_CMD_VIRTUAL_STOP', `SRV_CMD_VIRTUAL_STANDINGS',
	  `SRV_CMD_RESET_FILTER';
	new error code: `SRV_ERR_ONLY_VIRTUAL'.

	* protocol.c: text for `SRV_ERR_ONLY_VIRTUAL' error is added.

	* prepare.h:
	two new global parameters added: `virtual', `standings_team_color'.

	* prepare.c: global parameters:
	  virtual - if set to 1, denotes virtual contest;
	  standings_team_color - may be set to some HTML color to highlight
	  the team's line on the virtual standings page.

	* master_html.c: (write_all_runs) virtual contests are handled;
	  "Reset filter" button is generated;
	  filter parse and execution errors are printed;
	  special output format for `RUN_VIRTUAL_START', `RUN_VIRTUAL_STOP'
	  runlog entries;
	  virtual participant's entries time is printed in virtual time;
	(write_all_clars) astronimic time is used in virtual contest mode;
	(write_priv_standings) use of `write_standings_header',
	  `do_write_standings' is updated due to changed parameters;
	(write_priv_source) source cannot be printed for `RUN_VIRTUAL_START'
	  and `RUN_VIRTUAL_STOP' entries;
	(write_priv_clar) astronomical time is used in virtual contest mode;
	(html_reset_filter) new function to reset the runlog filter to
	  its initial state.

	* master.c:
	(action_reset_filter) new function to send `SRV_CMD_RESET_FILTER'
	  command. Use to reset the filter to default state;
	(main) `ACTION_RESET_FILTER' is handled.

	* html.h: 
	(write_standings_header) prototype is changed;
	(do_write_standings) prototype is changed;
	(html_reset_filter) new function prototype added.

	* html.c: 
	(new_write_user_runs) virtual contests are supported;
	(new_write_user_clars) virtual contests are supported. In virtual
	  contest mode all clarification requests are replies are tagged
	  with astronomic time, not duration from the start;
	(new_write_user_clar) the same as above;
	(write_standings_header) two new parameters added: `user_id' and
	  `user_name'. They are used in virtual contest mode to print
	  personal standings;
	(do_write_kirov_standings) RUN_VIRTUAL_START and RUN_VIRTUAL_STOP
	  run statuses are ignored;
	(do_write_standings) new parameter `user_id' added. Used in virtual
	  contest mode to generate standings relative to the current virtual
	  time of the given participant;
	(write_standings) use of `write_standings_header' and
	  `do_write_standings' is updated to due changes in their parameters;
	(print_nav_buttons) new parameter `t3', which is now button label
	  for "Log Out", `t2' is now button label for "Virtual standings"
	  button;
	  "Virtual standings" button is printed;
	(time_to_str) new function;
	(write_team_page) virtual contest mode is supported. In this mode
	  general contest information section is also printed on the
	  server side;
	  use of `print_nav_buttons' updated;
	(write_virtual_standings) new function to print the user's virtual
	  standings.

	* clntutil.h: external declaration of `server_is_virtual' added.

	* clntutil.c: `server_is_virtual' global variable added;
	(client_check_server_status) `is_virtual' flag is read;
	(client_print_server_status) virtual contests are supported.

	* client_actions.h:
	several new actions added: virtual contest actions and reset filter
	  action.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

2002-12-23  Alexander Chernov  <cher@ispras.ru>

	* teamdb.h: (teamdb_toggle_ban) prototype removed;
	(teamdb_toggle_vis) prototype removed;
	(teamdb_toggle_flags) new function prototype added.

	* teamdb.c: (teamdb_toggle_vis) function removed;
	(teamdb_toggle_ban) function removed;
	(teamdb_toggle_flags) a new function to request visibility/ban
	  flag toggling from the userlist-server.

	* serve.c:
	(cmd_priv_command_0) `SRV_CMD_TOGGLE_VISIBILITY', `SRV_CMD_TOGGLE_BAN'
	  commands are supported;
	(packet_handlers) packet handler for the commands above added.

	* protocol.h:
	new server commands: SRV_CMD_TOGGLE_VISIBILITY, SRV_CMD_TOGGLE_BAN.

	* master.c: user banning/making invisible is now supported;
	(action_toggle_visibility) a new function to request toggle of
	  user visibility status;
	(action_toggle_ban) a new function to request toggle of user ban
	  status;
	(main) client actions `ACTION_USER_TOGGLE_BAN',
	  `ACTION_USER_TOGGLE_VISIBILITY' are supporting by calling the
	  corresponding functions (described above).

2002-12-22  Alexander Chernov  <cher@ispras.ru>

	* makefile:
	ChangeLog for userlist_clnt, serve_clnt, charsets subdirectories
	  is updated with `log' rule.

2002-12-22  Alexander Chernov  <cher@ispras.ru>

	* master.c:
	GLOBAL CHANGE: new protocol (UNIX socket-based) of master-serve
	  communication is implemented;
	GLOBAL CHANGE: new session support is implemented (including
	  implementation of cookie support, which is now on by default);
	due to the above changes the code is almost totally rewritten;
	configuration parameters removed: `conf_dir', `pipe_dir',
	  `judge_dir', `judge_cmd_dir', `judge_data_dir';
	"client_actions.h" is included;
	<ctype.h> is included;
	session mode enumerated constants SID_* are defined;
	(read_state_params) `action' or `action_' cgi parameter is parsed;
	  `form_start_simple', `form_start_multipart', `hidden_vars' are
	  generated depending on the current session mode;
	(make_self_url) `SERVER_PORT' environment variable is not used, since
	  it is already contained in HTTP_HOST environment variable;
	(hyperref) new function to print self-referencing url depending on
	  the current session support mode;
	(set_cookie_if_needed) new function to send a cookie to client,
	  if it is needed;
	(display_enter_password) `set_cookie_if_needed' is called;
	  session support selection dialog is generated;
	(get_cookie) new function to parse cookie string;
	(ask_passwd) removed in favor of `authentificate';
	(check_passwd) removed in favor of `authentificate';
	(open_userlist_server) new function to open userlist-server
	  connection;
	(permission_denied) new function to report the corresponging error;
	(fatal_server_error) new function to report the corresponging error;
	(is_auth_error) new function, which returns 1, if the given
	  error code is authentification error;
	(get_session_id) new function, which parses session id from CGI
	  parameters;
	(client_put_refresh_header) new function, which generates
	  auto-refreshing http header;
	(authentificate) new function to authentificate users, supporting
	  all session modes;
	(print_refresh_button) all session support modes implemented;
	(print_standings_button) all session support modes implemented;
	(print_update_button) all session support modes implemented;
	(print_teamview_button) all session support modes implemented;
	(print_logout_button) new function to print "Log out" button;
	(print_reset_button) all session support modes implemented;
	(print_regenerate_button) all session support modes implemented;
	(print_suspend_button) all session support modes implemented;
	(print_resume_button) all session support modes implemented;
	(operation_status_page) new function to generate page to
	  show the result of operation;
	(start_if_asked) new protocol supported, `operation_status_page'
	  is called;
	(stop_if_asked) the same as above;
	(update_standings_if_asked) the same as above;
	(changedur_if_asked) the same is above;
	(sched_if_asked) the same as above;
	(change_status_if_asked) the same as above;
	(change_status) new function to support status changing from
	  source view page;
	(change_problem) new function, which implements problem changing
	  from source view page;
	(change_language) new function, which implements language changing
	  from source view page;
	(change_user_id) new function, which implements user_id changing
	  from source view page;
	(change_user_login) new function, which implements user login
	  changing from source view page;
	(view_one_team_if_asked) removed;
	(do_team_action_if_asked) removed;
	(add_team_if_asked) removed;
	(view_source_if_asked) new protocol, and session modes supported;
	(view_report_if_asked) the same as above;
	(view_teams_if_asked) the same as above;
	(confirm_reset_if_asked) new session support mode implemented;
	(confirm_regenerate_if_asked) the same as above;
	(confirm_update_standings) new function;
	(confirm_rejudge_all) new function;
	(do_contest_reset_if_asked) new session support mode implemented;
	  new protocol is supported;
	(do_generate_passwords_if_asked) the same;
	(do_suspend_if_asked) the same;
	(do_resume_if_asked) the same;
	(do_rejudge_all_if_asked) the same;
	(do_rejudge_problem_if_asked) the same;
	(view_clar_if_asked) defined `static';
	  new session support is implemented;
	  new protocol is supported;
	(send_msg_if_asked) the same as above;
	(send_reply_if_asked) the same as above;
	(view_standings_if_asked) the same as above;
	(log_out_if_asked) new function to log out user (remove all cookies);
	(set_defaults) all removed configuration parameters are no longer
	  supported;
	  `client_make_form_headers' is called with `self_url' argument;
	(open_serve) if connection cannot be established, fatal error is
	  reported;
	(display_master_page) server connection is explicitly opened;
	  the current sid_mode is passed to the server;
	(print_nav_buttons) new function to print navigation buttons;
	(main) new `authentificate' function is used instead of old
	  `ask_passwd', `check_passwd', etc;
	  the action is chosen depending on the client_actions value;
	  `print_nav_buttons' is used.

	* master_html.c:
	"fileutl.h", "client_actions.h", "sformat.h" is included;
	session mode enumeration constants SID_* are defined;
	(html_start_form) new function to start a form depending on the
	  current session mode;
	(html_hyperref) a new function to print self-reference hyperref
	  depending on the current session mode;
	(print_nav_buttons) new function to print navigation buttons;
	(write_change_status_dialog) new function to generate html for
	  run status change dialog;
	(write_all_runs) new parameters `sid_mode', `sid';
	  new session support is implemented;
	(write_all_clars) new parameters `sid_mode', `sid';
	  new session support mode is implemented;
	(write_master_page) new parameters `sid_mode', `sid',
	  which are passed to the above function;
	(write_priv_standings) new function to print the current standings;
	(write_priv_source) new function;
	(write_priv_report) new function;
	(write_priv_clar) new function;
	(write_priv_users) new function.

	* html.h: (write_runs_table) removed;
	(write_clars_table) removed;
	(write_clar_view) removed;
	(write_team_statistics) removed;
	(write_judge_allstat) removed;
	(write_judge_source_view) removed;
	(write_judge_report_view) removed;
	(write_judge_standings) removed;
	(write_judge_teams_view) removed;
	(write_judge_one_team_view) removed;
	(new_write_user_runs) prototype changed;
	(new_write_user_clars) prototype changed;
	(write_team_page) prototype changed;
	(write_master_page) parameters `sid_mode', `sid' are added;
	(write_priv_standings) prototype added;
	(write_standings_header) prototype added;
	(do_write_kirov_standings) prototype added;
	(do_write_standings) prototype added;
	(write_priv_source) prototype added;
	(write_priv_report) prototype added;
	(write_priv_clar) prototype added;
	(write_priv_users) prototype added;
	(html_start_form) prototype added;
	(html_hyperref) prototype added.

	* html.c: "client_actions.h" included;
	session support mode enumeration SID_* is defined;
	(write_clar_view) removed;
	(new_write_user_runs) parameters changed: `form' is removed, but
	  `sid_mode', `sid', `self_url', `hidden_vars' are added;
	  function is updated for new session support mode;
	(new_write_user_clars) parameters changed the same way as above;
	  new session support is implemented;
	(write_team_statistics) removed;
	(write_standings_header) new function;
	(do_write_kirov_standings) `header_str' is removed, the header is
	  printed in a separate function (above);
	  global parameter `ignore_compile_errors' is honored;
	  function is no longer static (used from master_html.c);
	(do_write_standings) `header_str' parameter is removed;
	  global parameter `ignore_compile_errors' is supported;
	  function is no longer static;
	(write_standings) `write_standings_header' is called;
	  parameters for do_write_*_standings are updated;
	(do_write_public_log) global parameter `ignore_compile_errors'
	  is supported;
	(write_judge_allruns) removed; similar function is now
	  in master_html.c;
	(write_judge_allclars) removed;
	(write_judge_allstats) removed, similar function is now in
	  master_html.c;
	(write_judge_source_view) removed;
	(write_judge_report_view) removed;
	(write_judge_standings) removed;
	(write_judge_teams_view) removed;
	(print_nav_buttons) new function;
	(write_judge_one_team_view) removed;
	(write_team_page) parameters are changed to support the new
	  session model;

	* makefile: libserve_clnt.a: rule uses ${SERVE_CLNT_CFILES} variable.

	* files.make: new userlist_clnt files: `logout.c', 'priv_cookie.c'.
	all serve_clnt files are now defined in a separate variable
	  `SERVE_CLNT_CFILES';
	client_actions.h added.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* clntutil.h: variables `client_pipe_dir', `client_cmd_dir',
	  `form_header_simple_ext', `form_header_multipart_ext' removed;
	(client_puts) removed;
	(client_make_form_header) accepts a parameter `self_url';
	(client_make_pipe) removed;
	(client_packet_name) removed;
	(client_get_reply) removed;
	(client_transaction) removed;
	(client_file_to_str) removed;
	(client_file_to_stdout) removed;
	(client_split) removed.

	* clntutil.c: "client_actions.h" is included;
	global variables `client_pipe_dir', `client_cmd_dir',
	  `form_header_simple_ext', `form_header_multipart_ext' are removed;
	(client_packet_name) removed;
	(client_make_pipe) removed;
	(client_get_reply) removed;
	(client_transaction) removed;
	(client_print_server_status) action codes are printed for
	  administrator's control buttons instead of commands;
	(client_make_form_headers) self_url parameter added;
	  form_header_simple_ext, form_header_multipart_ext are not
	  generated;
	(client_file_to_str) removed;
	(client_file_to_stdout) removed.

	* team.c:
	(initialize) `program_name' global variable is no longer used;
	  `self_url' is passed as an argument to `client_make_form_headers'.

	* prepare.c:
	new global parameters `ignore_compile_errors'. If set, compile
	  errors are not counted as failed runs and does not increase
	  penalty;
	global parameters `pipe_dir', `judge_dir', `judge_cmd_dir',
	  `judge_data_dir' are removed.
	(set_defaults) removed parameters are not handled;
	(create_dirs) removed parameters are not handled.

	* prepare.h:
	new global parameters `ignore_compile_errors'. If set, compile
	  errors are not counted as failed runs and does not increase
	  penalty;
	global parameters `pipe_dir', `judge_dir', `judge_cmd_dir',
	  `judge_data_dir' are removed.

	* protocol.c: new error messages added.

	* protocol.h: many new commands (mostly privileged) are added;
	several new errors added;
	(struct prot_serve_pkt_submit_clar) new fields: `dest_user_id',
	  `ref_clar_id', `dest_login_len', used by privileged message
	  sending;
	(struct prot_serve_pkt_team_page) fields `user_id', `contest_id',
	  `ip', `simple_form_len', `multi_form_len' removed;
	  fields `sid_mode', `self_url_len', `hidden_vars_len' added;
	(struct prot_serve_pkt_master_page) field `sid_mode' added;
	(struct prot_serve_pkt_standings) new packet;
	(struct prot_serve_pkt_view) new packet;
	(struct prot_serve_pkt_simple) new packet;
	(struct prot_serve_pkt_run_info) new packet.

	* runlog.h:
	(run_get_attempts) a new parameter added. If this parameter is 1,
	  all compile error runs are not counted;
	new enumeration for all `run_entry' fields (used in run_set_entry).
	(run_get_entry) new function;
	(run_set_entry) new function.

	* serve.c:
	GLOBAL CHANGE: new UNIX-socket based protocol is implemented
	  for master and judge;
	(struct client_state) `cookie', `ip' are saved;
	(report_to_client) removed;
	(report_error) removed;
	(report_bad_packet) removed;
	(report_ok) removed;
	(check_period) removed;
	(get_peer_local_user) IP-address is requested from the server
	  and saved in the `struct client_state';
	  cookie is saved in `struct client_state';
	(cmd_team_get_archive) team archive directory is created in var_dir
	  for now (since pipe_dir has gone);
	(cmd_team_list_runs) actual action are commented for now, since
	  their parameters changed, and the needed parameters are not
	  directly available. Protocol should be updated.
	(cmd_team_page) packet is changed, so the function is updated;
	(cmd_master_page) `sid_mode' is checked and passed to
	  `write_master_page';
	(cmd_priv_standings) new function;
	(cmd_view) new function;
	(cmd_message) new function;
	(cmd_gen_passwords) new function;
	(cmd_team_submit_clar) error of `generic_write_file' is checked;
	(cmd_priv_command_0) new function - handled many privileged protocol
	  commands;
	(process_judge_reply) removed;
	(judge_stat) removed;
	(judge_standings) removed;
	(judge_update_public_standings) removed;
	(judge_view_clar) removed;
	(judge_view_report) removed;
	(cmd_edit_run) new function;
	(judge_view_src) removed;
	(judge_start) removed;
	(judge_stop) removed;
	(judge_sched) removed;
	(judge_time) removed;
	(judge_change_status) removed;
	(judge_reply) removed;
	(judge_view_teams) removed;
	(judge_view_one_team) removed;
	(judge_change_team_login) removed;
	(judge_change_team_name) removed;
	(judge_change_team_password) removed;
	(judge_change_team_vis) removed;
	(judge_change_team_ban) removed;
	(do_add_team) removed;
	(judge_add_team) removed;
	(judge_message) removed;
	(do_rejudge_all) new function to rejudge all the runs;
	(judge_rejudge_all) removed;
	(do_rejudge_problem) new function to rejudge only particular problem;
	(judge_rejudge_problem) removed;
	(judge_reset_contest) removed;
	(judge_suspend_clients) removed;
	(judge_resume_clients) removed;
	(judge_generate_passwords) removed;
	(judge_cmds) removed;
	(read_judge_packet) removed;
	(packet_handlers) many new packet handlers are added;
	(do_loop) `judge_cmd_dir' is no longer scanned;
	(write_submit_templates) removed, as nobody uses that templates;
	(main) `write_submit_templates' is no longer called.

	* team.c: GLOBAL CHANGE: cookie support is implemented;
	"misctext.h", "client_actions.h" are included;
	<ctype.h> is included;
	new global parameter `enable_session_mode' to enable the dialog
	  about supported session modes. By default dialog is disabled,
	  and cookies are used;
	(setup_locale) new function to set locale;
	(make_self_url) new function to make a self-referencing URL;
	(hyperref) new function to make self-hyperreference;
	(open_serve) new function to open the contest-server connection;
	(set_cookie_if_needed) new function to send the cookie to client;
	(set_defaults) contest-server connection is now opened on demand;
	  self-reference URL is constructed;
	(read_state_params) `form_start_simple', `form_start_multipart'
	  are constructed depending on the current session mode;
	  hidden_vars is also constructed;
	  `client_action' is read from CGI parameters;
	(display_enter_password) rewritten;
	(get_cookie) a new function to parse cookie from the environment;
	(open_userlist_server) a new function to open userlist-server
	  connection;
	(permission_denied) a new function to report error;
	(fatal_server_error) a new function to report error;
	(is_auth_error) a new function, which returns 1, if the given
	  error code is due to failed authentification;
	(get_session_id) a new function, which parses session_id from
	  CGI parameters;
	(client_put_refresh_header) a new function, which generates
	  auto-refresh header;
	(authentificate) a new function to perform the operation;
	(operation_status_page) a new function, which displays (possibly
	  auto-refreshed) page with the status of the current operation;
	(print_refresh_button) rewritten;
	(print_logout_button) new function;
	(send_clar_if_asked) `operation_status_page' is used instead of
	  `error';
	  contest server connection is opened immediately before sending
	  clarification request;
	(submit_if_asked) `operation_status_page' is used instead of `error';
	(action_change_password) renamed from `change_password_if_asked';
	  the old password is also taked from CGI-parameters;
	  `operation_status_page' is used instead of `error';
	  userlist-server connection is opened immediately before operation;
	(show_clar_if_asked) `set_cookie_if_needed' is called before
	  client_put_header;
	  navigation buttons are printed using `print_nav_buttons';
	  contest-server connection is opened immediately before operation;
	(request_source_if_asked) the same as above;
	(request_report_if_asked) the same as above;
	(request_archive_if_asked) redundant check for the new client-serve
	  mode is removed;
	  contest-server connection is opened immediately before operation;
	  `operation_status_page' is used instead of `error';
	(action_change_language) a new function to reload the page
	  (clear POST-submitted vars);
	(action_logout) a new function;
	(display_team_page) contest-server connection is opened immediately
	  before operation;
	  parameters of `serve_clnt_team_page' changed;
	(print_nav_buttons) new function;
	(read_locale_id) new function;
	(main) locale setting code is separated into two functions:
	  `read_locale_id', `setup_locale';
	  `authentificate' is used for authentification;
	  `client_action' variable's value is used to perform the requested
	  action;
	  `set_cookie_if_needed' is called before `client_put_header';
	  `print_nav_buttons' is used instead of `print_refresh_button';
	  old password is requested to change password.

	* userlist-server.c:
	(struct client_state) added fields `cookie', `ip' to save the
	  corresponding parameters of the client;
	(remove_cookie) fixed bug, when all the user's cookies are removed
	  when the last cookie in the list is removed;
	(login_user) user IP-address and cookie are saved;
	(login_team_user) the same as above;
	(cmd_login_priv_user) current privilege level is saved in the cookie;
	  user IP-address and cookie are saved;
	(login_cookie) user IP-address and cookie are saved in
	  `struct client_state';
	(login_team_cookie) cookie with privilege level == 0 and matching
	  contest_id is searched;
	  user IP-address and cookie are saved in `struct client_state';
	(login_priv_cookie) a new function;
	(logout_user) completely rewritten;
	(cmd_get_uid_by_pid) verbosity decreased;
	  cookie and IP-address is returned in the packet;
	(process_packet) `ULS_PRIV_CHECK_COOKIE' is supported.

2002-12-21  Alexander Chernov  <cher@ispras.ru>

	* runlog.c:
	(run_get_attempts) new parameter `skip_ce_flag'. If this parameter
	  is set to non-zero value, runs that have RUN_COMPILE_ERR status
	  are ignored instead of counting compile error as a failed submit
	  and incuring penalties;
	(run_get_entry) new function, which exports the given entry into
	  `struct run_entry' structure;
	(run_set_entry) a new functon, which sets the specified by the mask
	  fields fields uf `struct run_entry'.

	* serve_clnt.h:
	(serve_clnt_team_page) removed parameters: `user_id', `contest_id',
	  `ip', `simple_form', `milti_form';
	  added parameters: sid_mode, self_url, hidden_vars;
	(serve_clnt_standings) new function prototype;
	(serve_clnt_view) new function prototype;
	(serve_clnt_message) new function prototype;
	(serve_clnt_gen_passwords) new function prototype;
	(serve_clnt_simple_cmd) new function prototype;
	(serve_clnt_edit_run) new function prototype.

	* userlist_clnt.h: 
	(userlist_clnt_get_uid_by_pid) parameter `p_ip' added;
	(userlist_clnt_priv_cookie) new function prototype;
	(userlist_clnt_logout) new function prototype.

	* userlist_proto.h:
	(struct userlist_pk_check_cookie) field `priv_level' added;
	(struct userlist_pk_do_logout) fields `origin_ip', `user_id' removed;
	(struct userlist_pk_uid) `ip' field added.

	* client_actions.h: many new client action codes added.

	* teamdb.h: 
	(teamdb_lookup_login) implemented for the client mode;
	(teamdb_scramble_passwd) removed;
	(teamdb_check_scrambled_passwd) removed;
	(teamdb_check_passwd) removed;
	(teamdb_set_scrambled_passwd) removed;
	(teamdb_get_plain_passwd) removed;
	(teamdb_get_write_passwd) removed;
	(teamdb_write_teamdb) removed;
	(teamdb_is_valid_login) removed;
	(teamdb_is_valid_name) removed;
	(teamdb_change_login) removed;
	(teamdb_change_name) removed;
	(teamdb_add_team) removed;
	(teamdb_transaction) removed;
	(teamdb_commit) removed;
	(teamdb_rollback) removed;
	(teamdb_regenerate_passwords) parameter changed: now plain file
	  descriptor is accepted and passed directly to userlist-server;
	(teamdb_get_uid_by_pid) new parameter `p_ip' added;
	(struct teamdb_export) fields `scrambled', `passwd' are removed.

	* teamdb.c: 
	(teamdb_lookup_login) implemented for the client mode;
	(teamdb_scramble_passwd) removed;
	(teamdb_check_scrambled_passwd) removed;
	(teamdb_check_passwd) removed;
	(teamdb_set_scrambled_passwd) removed;
	(teamdb_get_plain_passwd) removed;
	(teamdb_get_write_passwd) removed;
	(teamdb_write_teamdb) removed;
	(teamdb_is_valid_login) removed;
	(teamdb_is_valid_name) removed;
	(teamdb_change_login) removed;
	(teamdb_change_name) removed;
	(teamdb_add_team) removed;
	(teamdb_transaction) removed;
	(teamdb_commit) removed;
	(teamdb_rollback) removed;
	(teamdb_regenerate_passwords) parameter changed: now plain file
	  descriptor is accepted and passed directly to userlist-server;
	(teamdb_get_uid_by_pid) new parameter `p_ip' added.

	* sformat.c:
	(sformat_message) 'Mp' and 'Ms' format specifiers are no longer
	  supported, as this information (plain password and scrambled
	  password) is no longer available to the server.

2002-12-20  Alexander Chernov  <cher@ispras.ru>

	* client_actions.h: Initial revision

2002-12-15  Alexander Chernov  <cher@ispras.ru>

	* serve.c:
	(cmd_master_page) the user is checked to have privilege level
	  at least at PRIV_LEVEL_OBSERVER.

2002-12-14  Alexander Chernov  <cher@ispras.ru>

	* filter_scan.lex: keyword "and" is synonim for "&&";
	keyword "or" is synonim for "||".

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* run.c:
	(run_tests) reverted back previous behavour: output files are
	  created with 0600 (read-write) permissions, as DOS programs
	  otherwise do not work.

	* master_html.c:
	(write_all_runs) "Rejudge problem" and "Rejudge all" buttons
	  only appears in PRIV_LEVEL_ADMIN privileges.

	* master.c:
	(change_status_if_asked) since the number of failed tests and
	  the gained score cannot be edited, the corresponding CGI
	  variables are not parsed, and -1 is always passed to the server.

	* userlist_xml.c: "protocol.h" is included;
	"priv_level" cookie attribute is generally supported
	  (parsed and unparsed);
	(parse_priv_level) a new function to parse the attribute;
	(parse_cookies) "priv_level" attribute is handled;
	(unparse_cookies) "priv_level" attribute is handled.

	* userlist_proto.h: privilege level enumeration is defined;
	new commands `ULS_PRIV_LOGIN', `ULS_PRIV_CHECK_COOKIE' are added;
	"char[0]" is no longer used in all the packet structures, "char[N]" is
	  used, where N is the number of text parameters for the packet;
	(userlist_pk_do_login) new field `priv_level';
	(userlist_pk_login_ok) new field `priv_level';
	(userlist_pk_uid) new field `priv_level'.

	* userlist_clnt.h:
	(userlist_clnt_get_uid_by_pid) new parameter `p_priv_level' added;
	(userlist_clnt_priv_login) new function prototype added.

	* userlist.h: privilege level enumeration is defined;
	new attribute `priv_level' is added;
	(struct userlist_cookie) `priv_level' field is added.

	* userlist-server.c:
	(struct client_state) field `priv_level' is added;
	(cmd_login_priv_user) a new function to handle `ULS_PRIV_LOGIN';
	(cmd_get_uid_by_pid) `priv_level' is returned to the client;
	(process_packet) `ULS_PRIV_LOGIN' request is handled.

	* teamdb.h: 
	(teamdb_get_uid_by_pid) new parameter `p_priv_level' added.

	* teamdb.c:
	(teamdb_get_uid_by_pid) a new parameter `p_priv_level' is accepted
	  and passed directly to the underlying userlist_clnt function.

	* serve_clnt.h:
	(serve_clnt_master_page) `flags' parameter is renamed to `priv_level'.

	* serve.c:
	(struct client_state) new field `priv_level' to store the privilege
	  level for the connected user;
	(get_peer_local_user) `priv_level' is requested;
	  success condition is "r >= 0", not "r > 0";
	(cmd_pass_descriptors) `get_peer_local_user' is commented out;
	(cmd_master_page) new function to display the master page;
	(packet_handlers) reference to `cmd_master_page' is added;
	(check_sockets) when `process_packet' is done, the client state
	  descriptor `p' is checked to be valid, since the connection
	  may be closed during request processing. Only if client state
	  descriptor is valid, its read buffers are cleaned up.

	* protocol.h: new request `SRV_CMD_MASTER_PAGE';
	the privilege level enumeration is defined;
	(struct prot_serve_pkt_master_page) new packet structure;
	(protocol_priv_level_str) new function prototype is added.

	* protocol.c: <reuse/logger.h> is included;
	(protocol_priv_level_str) a new function.

	* master_html.c: "html.h" is included;
	the client state is moved into the structure `struct user_state_info',
	  which is separate for each admin user, the array of references
	  to these structures is `users';
	(parse_error_func) uses `cur_user' user state pointer to append
	  messages;
	(write_all_runs) new parameter `u' - user state information;
	  `mode' parameter is renamed to `priv_level';
	(write_all_clars) new parameter `u' - user state information;
	  `mode' parameter is renamed to `priv_level';
	(allocate_user_info) new function to create a new user state
	  structure, if needed;
	(write_master_page) new parameter `user_id';
	  `mode' parameter is renamed to `priv_level'.

	* master.c:
	GENERAL CHANGE: the `master' utility now uses `userlist-server'
	  authentification, uses socket to pass requests to the contest
	  server (only master_page is currently passed this way);
	new includes: "serve_clnt.h", "contests.h", "protocol.h",
	  "userlist_proto.h", "userlist_clnt.h";
	removed configuration parameters: `contest_name', `password',
	  `problems_submit_file', `standings_url';
	added new configuration parameters: `contest_id', `socket_path',
	  `contests_path', `serve_socket';
	(read_state_params) "view_all_runs", "view_all_clars" CGI parameters
	  are now handled in another function;
	  `login' variable is generated to the hidden variables;
	  `password' is html-armored;
	  previously commented stuff is removed;
	(make_self_url) a new function to make a self-reference URL;
	(display_enter_password) displays login and password text fields;
	(ask_passwd) checks both login and password;
	(check_passwd) uses `userlist-server' for authentification;
	(read_view_params) new function: reads and parses CGI-parameters for
	  filtering and displaying runs and clars;
	(view_teams_if_asked) `priv_level' variable is used instead
	  `judge_mode';
	(view_clar_if_asked) the same;
	(navigate_if_asked) completely removed;
	(clar_navigate_if_asked) completely removed;
	(get_contest_statistics) removed;
	(set_defaults) handling of `password' parameter removed;
	  handling of `problems_submit_file' is removed;
	  `contest_id', `serve_socket' are handled;
	(parse_client_ip) new function to parse the IP to binary form;
	(initialize) `priv_level' variable is set depending on the program
	  name;
	  contest_id is checked to be valid;
	  the client IP-address is parsed;
	  the self-reference URL is prepared;
	(open_serve) a new function, which opens contest server connection;
	(display_master_page) a new function to request the contest server
	  to generate the master page;
	(main) view parameters are parsed with `read_view_params';
	  `priv_level' variable is used instead `judge_mode';
	  previously commented stuff is completely removed;
	  the contest server is requested to generate list of runs and clars,
	  and the socket file descriptor is passed;
	  write message dialog is displayed, if privelege level >= JUDGE.

	* makefile:
	file lists for `master', `serve', `register', `userlist-server',
	  `edit-userlist', `filter_test' utilities changed;
	file list for libserve_clnt.a changed;
	`master' now requires expat.

	* html.h: 
	(write_master_page) a new function prototype is added.

	* files.make: files added: userlist_clnt/priv_login.c, master_html.c,
	  serve_clnt/master_page.c.

	* contests.h:
	new element tags: <privileged_users>, <administrator>, <judge>,
	  <observer>;
	(struct contest_desc) new field `priv_users'.

	* contests.c: 
	(parse_contest) <privileged_users> element is supported.

	* clntutil.c:
	(client_print_server_status) `read_only' function parameter is renamed
	  to `priv_level' function parameter. `priv_level' is checked to
	  be PRIV_LEVEL_ADMIN to display contest parameter change controls.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

2002-12-13  Alexander Chernov  <cher@ispras.ru>

	* run.c:
	(run_tests) the team program output file is created with mode
	  0200 (write-only);
	  the team program output file modes are changed to 0600 after the
	  program is completed.

	* filter_tree.h: 
	(filter_expr_set_string) parameter `errfunc' added;
	(filter_expr_init_parser) parameter `errfunc' added;
	extern variable `filter_expr_nerrs' added;
	extern variable `filter_expr_lval' added.

	* filter_tree.c: YYSTYPE macro is properly defined.

	* filter_test.c:
	`renties' field is renamed to `rentries' field in filter_env;
	(filter_runs) output format is changed;
	(main) call of `filter_expr_set_string' updated;
	  call of `filter_expr_init_parser' updated.

	* filter_scan.lex:
	system includes are moved after the local includes;
	global static variable `scan_err' added;
	all errors are reported using `scan_err' function pointer;
	(local_err_func) new function: default error printing;
	(filter_expr_set_string) new parameter `errfunc'.

	* filter_expr.y: global static variable `parse_err' is defined;
	YYERROR_VERBOSE macro is defined;
	all errors are reported using `parse_err' function pointer;
	(filter_expr_init_parser) an extra parameter `errfunc' added.

	* filter_eval.h:
	(struct filter_env) field `renties' is renamed to `rentries'.

	* filter_eval.c: YYSTYPE macro is properly defined;
	`renties' is renamed to `rentries'.

	* clntutil.c: 
	(client_puts) function removed as nobody now uses it.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* serve_clnt.h:
	(serve_clnt_master_page) a new function prototype is added.

	* teamdb.c:
	(restore_connection) error codes, returned by the userlist_clnt
	  routines are negative;
	(teamdb_get_uid_by_pid) error codes from
	  `userlist_clnt_get_uid_by_pid' are negative;
	  the actual error code is returned.

	* userlist-server.c:
	(cmd_get_uid_by_pid) negative error codes are returned on error;
	(do_work) when `process_packet' finished, the client_state
	  descriptor may be invalid since freed during processing of the
	  request, so the pointer must be revalidated and only after that
	  the structure may be updated.

	* master_html.c: Initial revision

2002-12-11  Alexander Chernov  <cher@ispras.ru>

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* userlist-server.c: 
	(login_team_user) the ban check is fixed;
	(login_team_cookie) the ban check is fixed.

	* runlog.h: `RUN_LOG_READONLY' new constant added;
	(struct run_header) moved here from runlog.c;
	(struct run_entry) moved here from runlog.c;
	(run_get_header) new function prototype;
	(run_get_all_entries) new function prototype.

	* runlog.c:
	structs `run_header' and `run_entry' are moved to runlog.h;
	(run_open) new `RUN_LOG_READONLY' flag is supported;
	(run_get_header) new function to copy the log header to the user's
	  location;
	(run_get_all_entries) new function to copy the whole log to the
	  user's location.

	* prepare.c: 
	(set_defaults) one debugging print is removed.

	* makefile: filter_test added to targets;
	rule for compiling filter_test changed to include all the necessary
	  stuff to lookup the real run database.

	* filter_tree.h, filter_tree.c, filter_test.c: completed.

	* filter_scan.lex: completed

	* filter_expr.y: completed.

	* files.make: filter_eval.[ch] module added.

	* filter_eval.h, filter_eval.c: Initial revision

2002-12-09  Alexander Chernov  <cher@ispras.ru>

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* filter_expr.y: in progress...

	* filter_tree.h: FILTER_ERR_* constants are added;
	(filter_tree_new_dur) function prototype added;
	(filter_tree_eval_node) function prototype added;
	(filter_strerror) function prototype added.

	* filter_tree.c: <errno.h> and <limits.h> included;
	(filter_tree_new_dur) new function;
	(str_to_int) new function;
	(filter_tree_eval_node) new function;
	(filter_strerror) new function.

	* filter_scan.lex: rule for octal literals is fixed.

2002-12-08  Alexander Chernov  <cher@ispras.ru>

	* filter_test.c, filter_tree.h, filter_tree.c, filter_scan.lex, filter_expr.y:
	Initial revision

	* makefile:
	userlist_clnt.c is removed and replaced with libuserlist_clnt.a;
	clean rule is updated;
	deps ruls is removed;
	version.c now depends on OTHERFILES as well;
	libuserlist_clnt.a rule are added;
	experimental rules for filter expression parsing are added.

	* files.make: OTHERFILES variable added.

	* files.make:
	new variable USERLIST_CLNT_CFILES to list all the modules in
	  userlist_clnt subdirectory;
	filter_test.c, filter_tree.[ch] modules are added;
	userlist_clnt.c is removed;
	userlist_clnt/private.h is added.

	* userlist_cfg.h:
	(struct userlist_cfg_user_map) a new structure to store the
	  parsed mapping from the system uids to the local uids;
	(struct userlist_cfg) `user_map' field is added.

	* userlist_cfg.c: new tags: `user_map', `map';
	new attributes `system_user', `local_user';
	(parse_user_map) a new function;
	(userlist_cfg_parse) <map> element is handled;

	* userlist-server.c:
	(detach_contest_extra) `vintage' of the shared data is set to the
	  invalid value just for the client to mention the change;
	(update_userlist_table) BANNED teams are also added to the table;
	  0xffff and 0x0000 vintage values are skipped;
	(build_system_uid_map) a new function, which builds mapping from
	  the system uids to the local uids;
	(remove_from_system_uid_map) a new function to remove the local uid
	  from the mapping;
	(do_remove_user) the user is also removed from system uid mapping;
	(set_user_info) `city' and `country' fields are supported;
	  member's `occupation' field is updated, if changed: bug fixed;
	(do_list_users) `city' and `country' are reported;
	(cmd_get_uid_by_pid) a new function to handle ULS_GET_UID_BY_PID
	  requests from the `serve' process;
	(process_packet) ULS_GET_UID_BY_PID command is handled;
	(main) the mapping from the system uids to the local uids is built.

	* serve.c:
	(get_peer_local_user) a new function to request the connection
	  credentials from the userlist-server;
	(cmd_pass_descriptors) connection credentials are requested;
	(cmd_team_get_archive) connection credentials are requested and
	  checked;
	(cmd_team_list_runs) the same as above;
	(cmd_team_page) the same as above;
	(cmd_team_show_item) the same as above;
	(cmd_team_submit_run) the same as above;
	(cmd_team_submit_clar) the same as above;
	(check_sockets) function returns, if no file descriptors to wait on;
	(do_loop) check for exit condition is performed in the beginning
	  of the main loop;
	(main) old the teamdb files authentification-related code is
	  removed.

	* teamdb.c:
	all the old files-related authentification stuff is removed;
	userlist-server disconnection is now handled properly;
	<signal.h> is included;
	(handler) new function: a temporary handler for user termination
	  signal, installed for the time of reestablishing server connection;
	(restore_connection) a new function to restore the lost connection
	  to the server;
	(lock_userlist_table) server disconnect is handled properly;
	(unlock_userlist_table) semop errors are reported, but otherwise
	  ignored;
	(teamdb_refresh) termination of `lock_userlist_table' due to
	  impossibility to restore connection to server is handled;
	(verify_passwd) removed;
	(read_fields) removed;
	(parse_teamdb_flags) removed;
	(parse_passwd_flags) removed;
	(unparse_passwd_flags) removed;
	(teamdb_open) removed;
	(teamdb_open_client) socket_path is saved for possible reconnection;
	  obsoleted files authentification stuff is removed;
	(teamdb_lookup_client) `cached_map == NULL' size is handled;
	(teamdb_lookup) obsoleted stuff is removed;
	(teamdb_lookup_login) obsoleted stuff is removed;
	(teamdb_get_login) obsoleted stuff is removed;
	(teamdb_get_name) the same;
	(teamdb_scramble_passwd) always reports "Not supported" error;
	(teamdb_check_scrambled_passwd) the same;
	(teamdb_check_passwd) the same;
	(teamdb_set_scrambled_passwd) the same;
	(teamdb_get_plain_password) the same;
	(teamdb_get_flags) BANNED flag may be also returned;
	(teamdb_write_passwd) always reports "Not supported" error;
	(teamdb_write_teamdb) the same;
	(teamdb_get_max_team_id) obsoleted stuff is removed;
	(teamdb_get_total_teams) the same;
	(teamdb_is_valid_login) always reports "Not supported" error;
	(teamdb_is_valid_name) the same;
	(teamdb_change_login) the same;
	(teamdb_change_name) the same;
	(teamdb_toggle_vis) the same;
	(teamdb_toggle_ban) the same;
	(teamdb_add_team) the same;
	(teamdb_transaction) the same;
	(teamdb_commit) the same;
	(teamdb_rollback) the same;
	(save_undo) removed;
	(teamdb_export_team) obsoleted stuff is removed;
	(teamdb_regenerate_passwords) server disconnect is handled;
	(syncronize_team_extra) return immediately, if not connected to server;
	(teamdb_get_archive_time) `server_conn' is asserted;
	(teamdb_set_archive_time) `server_conn' is asserted;
	(teamdb_get_uid_by_pid) a new function to request the local process
	  credentials by is pid.

	* teamdb.h: 
	(teamdb_get_uid_by_pid) prototype added.

	* run.c: <termios.h> is included;
	(generate_team_report) the process exit code is not reported to
	  the user unless global parameter `report_error_code' is set;
	(run_tests) terminal state is saved before starting the program
	  being judged and restored afterwards.

	* register.c:
	new global variables `user_city', `user_country' to store the
	  corresponding fields;
	(field_desc) description of "City", "Country" fields added;
	(read_user_info_from_server) `user_country', `user_city' are read;
	(edit_registration_data) the generated HTML is slightly changed.

	* html.c:
	(do_write_kirov_standings) fully solved problems are printed in bold;
	  an extra column with the total number of fully solved problems
	  is printed for each user.

	* expat_iface.c:
	<reuse/logger.h>, <reuse/xalloc.h> are included this way.

	* edit-userlist.c:
	(print_help) a new function to print a short help in the bottom line;
	(vis_err) help is displayed;
	(okcancel) help is displayed;
	(yesno) help is displayed;
	(display_reg_status_menu) help is displayed;
	(display_role_menu) help is displayed;
	(display_member_status_menu) help is displayed;
	(edit_string) help is displayed;
	(display_user) help is displayed;
	  new fields `city', `country' are supported;
	(display_registered_users) the help is displayed via `print_help';
	(display_contests_menu) help is displayed;
	(display_user_menu) help is displayed;
	(display_main_menu) help is displayed.

	* userlist_xml.c:
	(tag_map) element tags `city', `country' are supported;
	(tag_sizes) the same as above;
	(node_free) `city', `country' fields are freed;
	(do_parse_user) `city', `country' elements are parsed;
	(unparse_user) `city', `country' elements are unparsed.

	* userlist_clnt.h: 
	(userlist_clnt_get_uid_by_pid) new prototype added.

	* userlist.h: new tags: USERLIST_T_CITY, USERLIST_T_COUNTRY;
	new field ids: USERLIST_NN_CITY, USERLIST_NN_COUNTRY;
	(struct userlist_user) fields `city', `country' are added.

	* userlist.c:
	(userlist_get_user_field_str) new fields `city' and `country'
	  are supported;
	(userlist_set_user_field_str) the same as above;
	(userlist_delete_user_field) the same as above.

	* team.c: 
	(main) minor change in the generated HTML text.

	* runlog.c:
	(read_runlog) when runlog is empty the file version in the header
	  is set to 1.

	* protocol.h: new server error SRV_ERR_NO_PERMS.

	* protocol.c: new error message: "permission denied".

	* prepare.h, prepare.c:
	new global parameter `report_error_code' is supported.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* contests.h: new constants CONTEST_F_CITY, CONTEST_F_COUNTRY added.

	* contests.c:
	(field_map) new userlist user fields `city' and `country' are
	  handled.

	* .cvsignore: *** empty log message ***

2002-12-06  Alexander Chernov  <cher@ispras.ru>

	* userlist_clnt.c:
	Removed. All the functions are moved to individual files
	in userlist_clnt directory.

	* userlist_clnt.h: <string.h> is included;
	(userlist_clnt_send_packet) new function prototype. It was
	  previously a static function;
	(userlist_clnt_recv_packet) new function prototype. The same as
	  above;
	(userlist_clnt_do_pass_fd) new function prototype. The same.

	* userlist_proto.h: new request ULS_GET_UID_BY_PID;
	new reply ULS_UID;
	new error code ULS_ERR_DISCONNECT;
	new request structure userlist_pk_get_uid_by_pid;
	new reply structure userlist_pk_uid.

	* userlist_proto.c: new error code verbose message.

2002-12-03  Alexander Chernov  <cher@ispras.ru>

	* .cvsignore, .cvsignore: *** empty log message ***

	* serve.c: 
	(read_run_packet) a minor spelling error is fixed;
	  in `KIROV' score system only RUN_OK, RUN_PARTIAL and
	  RUN_CHECK_FAILED testing results are allowed.

	* run.c:
	(run_tests) in KIROV judging mode when even one test is failed
	  with RUN_CHECK_FAILED, the whole test run is marked as
	  RUN_CHECK_FAILED.

	* makefile:
	added rule `subdirs_all' to recurse to subdirectories and do
	  `make all';
	rule `clean' recurses to subdirectories;
	rules to compile `cdeps' are added;
	all the dependencies are removed from the makefile. They are generated
	  on the fly using `cdeps' utility.

2002-12-02  Alexander Chernov  <cher@ispras.ru>

	* VERSION: *** empty log message ***

	* serve.c: MAJOR CHANGES:
	  team<->serve protocol is changed:
	  o a single UNIX socket is used instead of spool directory;
	  o requests and responses are passed in binary form;
	  o team credentials are passed upon connection (normally, they are
	    credentials of the web server);
	  o to handle reguests, where large amount of html is generated,
	    remote client socket file descriptors are passed via UNIX
	    socket, so the server writes directly to the remote client;
	DETAILED DESCRIPTION:
	"userlist.h", "sha.h" files are included;
	lots of system includes related to the sockets and select are
	  included;
	(struct client_state) a new structure to store the state of the
	  client;
	(client_new_state) a new function to contstruct new client structure;
	(client_disconnect) a new function to destroy client structure;
	(struct remove_queue_item) a new structure to store the list
	  of items pending to removal;
	(remove_queue_add) a new function to add an item to the remove queue;
	(interrupt_signal) a new function - handler for SIGTERM, SIGINT;
	global variable `current_time' is used instead of local `time()' calls
	  in all the functions;
	(update_standings_file) declared `static';
	(update_public_log_file) declared `static';
	(update_status_file) declared `static';
	  `download_interval' field is written;
	(check_team_quota) declared `static';
	  `size_t' type is used;
	(check_clar_qouta) declared `static';
	(report_to_client) declared `static';
	(report_error) declared `static';
	  team_data_dir parameter is now removed;
	(report_bad_packet) declared `static';
	(is_valid_status) declared `static';
	  `RUN_IGNORED' is valid;
	(check_period) declared `static';
	(team_view_clar) function is removed;
	(new_enqueue_reply) a new function to add the packet to send slot
	  for the client;
	(team_send_clar) function is removed;
	(new_send_reply) a new function to send to the client a message
	  without any additional data;
	(new_bad_packet) a new function to report bad packet error and
	  close the connection;
	(cmd_pass_descriptors) a new function to handle SRV_CMD_PASS_FD
	  request;
	(cmd_team_get_archive) a new function to handle SRV_CMD_GET_ARCHIVE
	  request;
	(team_submit) function is removed;
	(cmd_team_list_runs) a new function to handle SRV_CMD_LIST_RUNS;
	(cmd_team_page) a new function to handle SRV_CMD_TEAM_PAGE;
	(team_change_passwd) removed;
	(cmd_team_show_item) a new function to handle SRV_CMD_SHOW_SOURCE,
	  SRV_CMD_SHOW_CLAR and SRV_CMD_SHOW_REPORT requests;
	(team_stat) removed;
	(cmd_team_submit_run) a new function to handle SRV_CMD_SUBMIT_RUN;
	(team_view_report) removed;
	(team_view_source) removed;
	(cmd_team_submit_clar) a new function to handle SRV_CMD_SUBMIT_CLAR;
	(read_team_packet) removed;
	(read_compile_packet) declared `static';
	(read_run_packet) declared `static';
	(process_judge_reply) declared `static';
	(rejudge_run) declared `static';
	  `run_get_record' call is updated;
	(judge_stat) declared `static';
	(judge_standings) declared `static';
	(judge_update_public_standings) declared `static';
	(judge_view_clar) declared `static';
	(judge_view_report) declared `static';
	(judge_view_src) declared `static';
	(judge_start) declared `static';
	(judge_stop) declared `static';
	(judge_sched) declared `static';
	(judge_time) declared `static';
	(judge_change_status) declared `static';
	  `RUN_IGNORED' run status is handled;
	(judge_reply) declared `static';
	(judge_view_teams) declared `static';
	(judge_view_one_team) declared `static';
	(judge_change_team_login) declared `static';
	(judge_change_team_name) declared `static';
	(judge_change_team_password) declared `static';
	(judge_change_team_vis) declared `static';
	(judge_change_team_ban) declared `static';
	(do_add_team) declared `static';
	(judge_add_team) declared `static';
	(judge_message) declared `static';
	(judge_rejudge_all) declared `static';
	  `RUN_IGNORED' runs are not rejudged;
	(judge_rejudge_problem) declared `static';
	  `RUN_IGNORED' runs are not rejudged;
	(judge_reset_contest) declared `static';
	(judge_suspend_clients) declared `static';
	(judge_resume_clients) declared `static';
	(judge_cmds) declared `static';
	(read_judge_packet) declared `static';
	(check_remove_queue) a new function to check the remove queue and
	  unlink pending items;
	(process_packet) a new function to handle packets from UNIX socket;
	(create_socket) a new function to create the socket and initialize
	  the related data structures;
	(check_sockets) a new function, which watch on the icoming file
	  descriptors;
	(may_safely_exit) a new function, which checks whether the server
	  may be exited. All the write buffers must be empty;
	(do_loop) declared `static';
	  signal handler for SIGINT, SIGTERM is installed;
	  SIGPIPE signal is ignored;
	  team spool directory is no longer checked and the corresponding
	  configuration parameters are removed;
	(main) socket file is unlinked when do_loop exits.

	* html.h: <stdio.h>, <time.h> are included;
	(write_team_clar) prototype is removed;
	(write_team_report_view) removed;
	(write_team_source_view) removed;
	(new_write_user_runs) prototype added;
	(new_write_user_clars) prototype added;
	(new_write_user_clar) prototype added;
	(new_write_user_source_view) prototype added;
	(new_write_user_report_view) prototype added;
	(write_team_page) prototype added.

	* html.c: "protocol.h" file is included;
	(write_clar_view) call of `duration_str' is updated due to changes
	  in its parameters;
	(new_write_user_runs) a new function (a part of former
	  `write_team_statistics'), which prints only run log for a user;
	(new_write_user_clars) a new function (a part of former
	  `write_team_statistics'), which prints only clar log for a user;
	(write_team_statistics) split into the two new functions (see above);
	(write_team_clar) removed;
	(new_write_user_clars) a new function (previously write_team_clar),
	  which prints detailed clarification request;
	(do_write_kirov_standings) standings_charset global parameter is
	  used;
	  `run_get_record' call is updated;
	  `duration_str' call is updated;
	(do_write_standings) the same changes as above;
	(write_standings) if `charset' and `standings_charset' does not
	  match, standings are recoded;
	(do_write_public_log) `time_t', `size_t' types are used;
	  `duration_str' call is updated;
	(write_public_log) `time_t', `size_t' types are used;
	  `run_get_record' call is updated;
	  `duration_str' call is updated;
	  printf format specifiers are changed for size_t-typed vars;
	  "Ignore" option is added;
	(write_judge_allclars) `duration_str' call is updated;
	(new_write_user_source_view) this is new name for
	  `write_team_source_view';
	  the user source is generated to the passed stream descriptor;
	  the possible error code is returned from the function;
	(new_write_user_report_view) this is new name for
	  `write_team_report_view';
	  the report is written to the passed stream descriptor;
	  the function returns its error code;
	(write_team_page) a new function, which generates the team main page,
	  including run log, submit dialog, clar log, write new clar dialog.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* team.c: ARCHITECTURE CHANGED:
	  `userlist-server' daemon is used for authentification. The old files
	  method (teamdb, passwd) is no longer supported;
	  team->serve protocol is completely changed. It uses a single UNIX
	  socket. It passes the data in binary format. In some cases the client
	  passes to the server the file descriptors, which may be user to
	  write the HTML code to the remote client directly.
	PARAMETERS CHANGED:
	  o `contest_name' parameter is removed, the contest name is taken
	    from the contests XML database,
	  o `conf_dir' parameter is removed: no longer used;
	  o `teamdb_file' parameter is removed: authentification is performed
	    with `userlist-server' daemon;
	  o `passwd_file' is removed: the same is above;
	  o `languages_file' parameter is removed, the main team page
	    is now generated on the server side, which has all the necessary
	    information;
	  o `problems_submit_file' is removed: the same as above;
	  o `problems_clar_file' is removed: the same as above;
	  o `pipe_dir' is removed: team<->serve interaction is performed
	     through UNIX socket, so no separate directory is necessary;
	  o `team_dir' is removed: the same as above;
	  o `team_cmd_dir' is removed: the same as above;
	  o `team_data_dir' is removed: the same as above;
	  o `serve_socket' new parameter to specify the name of the UNIX
	    socket to communicate with server. Default value `serve' works,
	    if not changed on server;
	"teamdb.h" is removed;
	"protocol.h", "serve_clnt.h" are included;
	<stdarg.h> is included;
	default parameter values of removed parameters are removed;
	(struct section_global_data) fields which corresponds to the
	  removed parameters are removed;
	  new field `serve_socket';
	(error) new function to append messages to the error log;
	(set_defaults) changed substantially;
	(initialize) changed substantially;
	(read_server_templates) no longer used;
	(check_passwd) old files-based method is no longer supported;
	(get_team_statistics) removed;
	(send_clar_if_asked) changed substantially;
	(submit_if_asked) changed substantially;
	(change_passwd_if_asked) changed substantially;
	(show_clar_if_asked) changed substantially;
	(request_source_if_asked) changed substantially;
	(request_report_if_asked) changed substantially;
	(request_archive_if_asked) new function to download the user's
	  submit archive (in tar.gz format);
	(display_team_page) new function to send `team page' request to the
	  server. The remove client socket file descriptor is passed in the
	  request;
	(main) changed substantially.

	* runlog.c:
	MAJOR CHANGE: the database is now stored in the binary format;
	(struct run_header) `time_t' type is used instead of `unsigned long';
	  `version' field is added to store the database file version,
	   version 0 is the text database file, version 1 is the current,
	  `pad' field is added to pad the structure size to 64 bytes;
	(struct run_entry) `time_t', `size_t' types are used where appropriate;
	  `ip' is stored in binary format (ie unsigned long) rather than in
	  textual format;
	  new field `sha1' to store the run hash value;
	  `locale_id', `test' are now `signed char's to save the memory;
	  `language', `status' are now `unsigned char's;
	(run_read_entry) `sscanf' specification is updated since field
	  types are changed;
	  `ip' is parsed from textual to binary representation using
	  `run_parse_ip';
	(is_runlog_version_0) new function, which checks, whether the
	  run database file is in textual format (version 0 format);
	(read_runlog_version_0) new function, which reads the runlog
	  in textual format;
	(save_runlog_backup) new function, which saves the runlog file
	  under the name `runlog.bak';
	(do_write) a new function to write block to file, handing partial
	  writes;
	(do_read) a new function to read block from file, handing partial
	  reads;
	(write_full_runlog_current_version) a new function to write the
	  runlog in the current version format;
	(read_runlog) a new function to read the runlog in binary format;
	(run_open) function is rewritten. It handles different database
	  formats. If the database is in text format, the backup copy is
	  saved;
	(run_make_record) function removed;
	(run_make_header) function removed;
	(run_flush_entry) changed to binary format;
	(run_add_record) `time_t', `size_t' types are used;
	  `ip' is passed in binary format (i.e. `unsigned long') rather
	  than in textual format;
	  new parameter `sha1' to pass the run hash value;
	  `locale_id', `language' are checked to fit into byte;
	  record is zeroed before setting its fields;
	(run_flush_header) changed to binary format;
	(run_change_status) `newstatus', `newtest' are checked to fit into
	  a byte;
	(run_get_record) `time_t', `size_t' types are used;
	  `pip' now is pointer to its binary representation (`unsigned long')
	  rather than textual representation;
	  new parameter `psha1' to return the hash value;
	(run_start_contest) `time_t' type is used;
	(run_stop_contest) the same;
	(run_set_duration) the same;
	(run_sched_contest) the same;
	(run_get_start_time) the same;
	(run_get_stop_time) the same;
	(run_get_times) the same;
	(run_get_team_usage) `size_t' type is used;
	(run_get_attempts) runs with `RUN_IGNORED' status are ignored;
	(run_status_str) `RUN_IGNORED' status is handled;
	(run_get_fog_period) `time_t' type is used;
	(run_unparse_ip) new function to convert the IPv4 address from
	  binary to textual representation;
	(run_parse_ip) new function to convert the IPv4 address from
	  textual to binary representation;
	(run_check_duplicate) new function, which checks whether the
	  given run is a duplicate of some of the previous runs.

	* runlog.h: <time.h> is included;
	<string.h> is included;
	new status RUN_IGNORED added;
	(run_open) prototype changed to use `const' qualifier;
	(run_add_record) `time_t', `size_t' types are used instead of
	  unsigned long;
	  `ip' is passed as unsigned long rather than char;
	  new parameter `sha1' to pass the hash value;
	(run_start_contest,run_get_start_time) `time_t' type is used;
	(run_get_record)  `time_t', `size_t' types are used;
	  `ip' pointer is now `unsigned long *', not `unsigned char*';
	  new parameter to return the sha1 hash value;
	(run_get_times) `time_t' type is used;
	(run_set_duration) the same;
	(run_get_stop_time) the same;
	(run_stop_contest) the same;
	(run_sched_contest) the same;
	(run_get_total) the same;
	(run_get_fog_period) the same;
	(run_get_team_usage) `size_t' type is used;
	(run_unparse_ip) new function prototype;
	(run_parse_ip) new function prototype;
	(run_check_duplicate) new function prototype.

	* run.c:
	(run_tests) empty output file is created even if no_redirect flag
	  is set.

	* run.c: "cr_serialize.h" is included;
	(generate_team_report) `score_buf' variable is initialized on each
	  iteration;
	(run_tests) tester parameter `time_limit_adjustment' is handled. If
	  the parameter is > 0, its value is added to the problem's time limit;
	  if task start failed, it is counted as failed test;
	(do_loop) subprocess run serialization is used. `cr_serialize_init'
	  is called at the start of the function, when a run is to be
	  started `cr_serialize_lock' is called, when the run is completed,
	  `cr_serialize_unlock' is called.

	* register.c:
	(parse_cookies) handing of Internet Explorer (mis?)feature is added.
	  The Internet Explorer passes back all the cookies passed to it
	  in one session instead of the last cookie.

	* protocol.h:
	(struct prot_serve_status) field `download_interval' is added;
	(struct prot_serve_packet) new structure to describe the minimal
	  packet passed through team<->serve socket;
	SRV_CMD_* constants for team->serve requests are defined;
	SRV_RPL_* server replies for team->serve requests are defined;
	SRV_ERR_* error code constants are defined;
	number of prot_serve_pkt_* structure, which describe packets for
	  team->serve commands and serve->team replies are defined;
	(protocol_strerror) prototype added.

	* protocol.c: more error code descriptions are added.

	* prepare.h: "nls.h" is included;
	(struct section_global_data) new field `serve_socket';
	  new internal field `charset_ptr', which contains the reference to
	  the charset functions for the current charset;
	  new field `standings_charset';
	  new internal field `standings_charset_ptr';
	  fields `team_dir', `team_cmd_dir', `team_data_dir' are removed;
	  new field `team_download_time';
	  new field `cr_serialization_key';
	  new field `show_astr_time';
	  new field `ignore_duplicated_runs';
	(struct section_tester_data) new field `time_limit_adjustment'.

	* prepare.c:
	new global parameter `standings_charset' which contains the charset
	  in which static standings are generated;
	new global parameter `serve_socket' which contains the name of UNIX
	  socket for team<->serve communication;
	parameters `team_dir', `team_cmd_dir', `team_data_dir' are removed,
	  since the communication is performed via UNIX socket;
	new global parameter `team_download_time', which is set to the
	  inverval in minutes, after which the user may again download his
	  runs after its downloads. The parameter may be explicitly set to 0,
	  user downloads are then completely disabled;
	new global parameter `cr_serialization_key'. If this parameter is
	  non-zero, it contain the value of SYSV semaphore key, which is used
	  by `compile' and `run' utilities to serialize subprocess execution;
	new global parameter `show_astr_time'. If this parameter is non-zero,
	  the astronomic time of submission is printed instead of duration
	  from the contest start;
	new global parameter `ignore_duplicated_runs'. If this parameter is
	  non-zero, the runs are checked for duplicates. If the previous
	  run of the same user has the same language, problem, ip, size,
	  checksum values, the current run is marked `Ignored';
	new tester parameter `time_limit_adjustment'. If this parameter is
	  non-zero, the time-limit is increased by a given number of seconds;
	default charset is set to "koi8-r";
	(global_init_func) initialization of `team_download_time',
	  `ignore_duplicated_runs' is added;
	(inheritance_info) `time_limit_adjustment' is added;
	(set_defaults) all the new fields are initialized;
	(create_dirs) `team_dir', `team_cmd_dir', `team_data_dir' are not
	  created, since the parameters are removed.

	* nls.h:
	(struct nls_table) new field `is_singlebyte', which is set to 1, if
	  each character in the charset is represented with 1 byte;
	(struct nls_table) new field `unilen', which is reference to function,
	  that returns the length of the given unicode character in bytes
	  in this charset;
	all nls_table_* global variables are added as extern references;
	(str_utf8_to_enc) new function prototype;
	(str_utf8_to_enc_unchecked) new function prototype;
	(str_utf8_to_enc_heap) new function prototype;
	(str_utf8_to_koi8) new function prototype;
	(str_utf8_to_koi8_unchecked) new function prototype;
	(str_utf8_to_koi8_heap) new function prototype;
	(str_koi8_to_enc) new function prototype;
	(str_koi8_to_enc_unchecked) new function prototype;
	(str_koi8_to_enc_heap) new function prototype.

	* misctext.h: 
	(duration_str) prototype is updated.

	* misctext.c: <time.h> is included;
	(duration_str) new parameter `show_astr' is added. If this parameter
	  is non-zero, astronomic time of `cur' is displayed instead of
	  duraction `cur-start';
	  previous parameter `time' is decomposed into two: `cur' and `start',
	  `cur' is the time to convert to string, `start' is the contest start
	  time.

	* master.c:
	(change_status_if_asked) range of valid status constants is extended.

	* makefile: utf8_utils.[ch] module is removed;
	rules for compilation of `libcharsets.a' are added;
	rules for compilation of `libserve_clnt.a' are added;
	rule `clean' is updated to clean subdirectories;
	lists of c files for individual utilities are corrected.

	* files.make: cr_serialize.[ch] module added;
	all charset handling functions are moved to a separate directory
	  (charsets);
	utf8_utils.h is merged to nls.h;
	utf8_utils.c is decomposed into individual functions which are put
	  to `charsets' directory.

	* expat_iface.c: "utf8_utils.h" is no longer included.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* cr_serialize.c: 
	(cr_serialize_lock) debugging output is commented out;
	(cr_serialize_unlock) the same.

	* compile.c: "cr_serialize.h" is included;
	(do_loop) subprocess creation serialization is implemented using the
	  new `cr_serialize' module.

	* clntutil.h:
	`server_download_interval' variable is declared as extern.

	* clntutil.c:
	new server state variable `server_download_interval', which contains
	  the allowed interval (in seconds) between team submit downloads;
	(client_check_server_status) `server_download_interval' variable is
	  read;
	(client_print_server_status) calls of `duration_str' are updated as
	  the function parameters are changed.

2002-12-01  Alexander Chernov  <cher@ispras.ru>

	* serve_clnt.h: (serve_clnt_show_item) new function prototype;
	(serve_clnt_submit_run) new function prototype;
	(serve_clnt_submit_clar) new function prototype;
	(serve_clnt_team_page) new function prototype.

	* userlist-server.c:
	(cmd_admin_process) if there is an admin record for the given user
	  with the path "ANY", the path is not checked.

	* userlist_xml.c: "nls_utils.h" is no longer included;
	(userlist_unparse_ip) this is the new name for `unparse_ip',
	  function became externally visible;
	(unparse_cookies) use of `unparse_ip' is updated.

	* userlist.h: 
	(userlist_unparse_ip) prototype added.

	* .cvsignore: edit-userlist utility added

2002-11-30  Alexander Chernov  <cher@ispras.ru>

	* cr_serialize.h, cr_serialize.c: Initial revision

2002-11-24  Alexander Chernov  <cher@ispras.ru>

	* teamdb.c:
	(struct teamdb_extra) a new structure for each team, this structure
	  contains various temporary information about the team. Currently
	  it contains only the time of the last run archive downloading.
	(teamdb_refresh) team extra information is marked `out of sync';
	(teamdb_lookup_client) a new inline function to check the
	  validity of user_id in case of client-server operation mode;
	(syncronize_team_extra) a new function to syncronize list of
	  users with the current extra information;
	(teamdb_get_archive_time) a new function, which returns the time
	  of the last run archive download for a given team;
	(teamdb_set_archive_time) a new function, which sets the time of the
	  last run archive download for a given team.

	* teamdb.h: <time.h> is included;
	(teamdb_get_archive_time) new prototype;
	(teamdb_set_archive_time) new prototype.

	* serve_clnt.h: Initial revision

2002-11-23  Alexander Chernov  <cher@ispras.ru>

	* protocol.c: Initial revision

2002-11-18  Alexander Chernov  <cher@ispras.ru>

	* run.c:
	(do_loop) the executable file to be tested is removed from the
	  server_exe_dir directory.

	* compile.c:
	(do_loop) source file is removed from server_src_dir when the
	  incomping compile packet is being processed.

	* users.c: "fileutl.h" is included;
	(read_user_id) a new function to parse "user_id" CGI param;
	(put_http_header) a new function to print HTTP header only;
	(main) if CGI parameter "secret_mode" is set, ";"-separated
	  table is to be requested from server;
	  header and footer files are supported;
	  user_id and request_flags are passed to the server;

	* userlist_xml.c: "read_only" attribute is supported;
	(parse_contest) "banned", "invisible", "read_only" attributes are
	  parsed;
	(userlist_parse_str) a new function, which parses the userlist XML
	  from string;
	(userlist_unparse_reg_status) a new function;
	(unparse_contest) a new function to generate XML for a registration
	  entry;
	(unparse_contests) now uses `unparse_contest';
	(unparse_user_short) generates XML with a short user description;
	(unparse_user) "invisible", "banned" attributes are generated only
	  when in USERLIST_MODE_ALL mode;
	  "read_only" attribute is unparsed;
	(userlist_unparse_short) a new function to generate a short XML
	  with user list.

	* userlist_proto.h:
	new request codes: ULS_LIST_ALL_USERS, ULS_EDIT_REGISTRATION,
	  ULS_EDIT_FIELD, ULS_DELETE_FIELD, ULS_ADD_FIELD;
	new error codes: ULS_ERR_NOT_REGISTERED, ULS_ERR_CANNOT_DELETE,
	  ULS_ERR_CANNOT_CHANGE, ULS_ERR_DEADLINE;
	(struct userlist_pk_edit_registration) new packet structure;
	(struct userlist_pk_edit_field) new packet structure.

	* userlist_proto.c: new explanation for new error codes added.

	* userlist_clnt.h: (userlist_clnt_list_all_users) new prototype;
	(userlist_clnt_change_registration) new prototype;
	(userlist_clnt_edit_field) new prototype;
	(userlist_clnt_delete_field) new prototype;
	(userlist_clnt_add_field) new prototype.

	* userlist_clnt.c:
	(userlist_clnt_get_info) error codes from `send_packet' and
	  `receive_packet' are preserved and returned to sender;
	(userlist_clnt_list_all_users) a new function to list all users in
	  the database, or to list all users registered for a particular
	  contest. The result is returned in XML;
	(userlist_clnt_change_registration)  a new function to change
	  registration status of a particular user to a particular contest;
	(userlist_clnt_edit_field) a new function to change the value
	  of the given field;
	(userlist_clnt_delete_field) a new function to reset the value
	  of the given field;
	(userlist_clnt_add_field) a new function to add a new user or
	  a new member into user.

	* userlist.h: new registration status constant USERLIST_REG_LAST;
	new attribute code USERLIST_A_READ_ONLY;
	new USERLIST_NN_* constants for userlist_user field codes;
	new USERLIST_NM_* constants for userlist_member field codes;
	new registration flag constant USERLIST_UC_ALL;
	(struct userlist_user) `read_only' field added;
	new userlist unparse flag USERLIST_MODE_SHORT;
	(userlist_parse_str) new function prototype;
	(userlist_unparse_short) new function prototype;
	(userlist_unparse_reg_status) new function prototype;
	(userlist_member_status_str) new function prototype;
	(userlist_parse_date) new function prototype;
	(userlist_parse_bool) new function prototype;
	(userlist_unparse_bool) new prototype;
	(userlist_unparse_date) new prototype;
	(userlist_get_member_field_str) new prototype;
	(userlist_set_member_field_str) new prototype;
	(userlist_delete_member_field) new prototype;
	(userlist_get_user_field_str) new prototype;
	(userlist_set_member_field_str) new prototype;
	(userlist_delete_user_field) new prototype.

	* userlist.c:
	(userlist_member_status_str) a new function to return string
	  representation of member status;
	(userlist_parse_date) a new function to parse the date in the
	  format 'YYYY/MM/DD HH:MM:SS' to the internal time_t format;
	(userlist_unparse_bool) a new function;
	(userlist_unparse_date) a new function to convert the date
	  in the internal time_t format into the external format;
	(userlist_parse_bool) a new function;
	(userlist_get_member_field_str) a new function, which returns
	  the field's value of userlist_member structure by field code;
	(userlist_delete_member_field) a new function, which resets
	  the field value of userlist_member structure by field code;
	(userlist_set_member_field_str) a new function, which sets the
	  userlist_member field value by field code;
	(userlist_get_user_field_str) a new function, which returns
	  the userlist_user field value by its field code;
	(userlist_set_user_field_str) a new function, which sets
	  the userlist_user field value by its field code;
	(userlist_delete_user_field) a new function, which clears
	  the userlist_user field value by its field code.

	* userlist-server.c:
	constant->string tables for members (singular and plural) and
	member status are added;
	FIRST_COOKIE, NEXT_COOKIE, FIRST_CONTEST, NEXT_CONTEST macros added;
	(passwd_check) if the first password check failed, try it the second
	  time, now ignoring all spaces in the provided password;
	(allocate_new_user) a new function to allocate a new user structure,
	  link it into the tree and add it into the reference table;
	(create_newuser) locale_id is generated after the contest_id in
	  the URL in the e-mail message (because some mail clients add
	  the trailing dot from the message to the URL);
	  `allocate_new_user' function is used;
	(do_remove_user) a function to remove a user from the database,
	  notifying all the contests, in which the user has active
	  registrations;
	(check_all_users) `do_remove_user' is used;
	(get_user_info) contest administrator may get all the information
	  about the user, including the information, which is not send to
	  the user himself;
	(cmd_list_all_users) a new function to generate XML with brief
	  information about the users either all, or registered for a
	  particular contest. This function handles ULS_LIST_ALL_USERS
	  request;
	(set_user_info) some `info' messages replaced to `err';
	  new user XML tree is always freed - memory leak is fixed;
	(register_for_contest) some `info' messages replaced with `err';
	  administrator may register any user to any contest;
	(do_list_users) if passed flag is set to 1, all the user table
	  is exported in ';'-separated plain format (for import to Excel);
	  detailed information for a given user is generated, if
	  requested;
	  references to detailed user information is generated in the
	  general user list information;
	(list_users) user_id and contest_id fields of the incoming packet
	  are verified;
	(cmd_edit_registration) a new function to change registration status.
	  Handles ULS_EDIT_REGISTRATION request;
	(cmd_delete_field) a new function, which resets or removes the
	  given field. Handles ULS_DELETE_FIELD request;
	(cmd_edit_field) a new function, which changes the value of the
	  given field. Handles ULS_EDIT_FIELD request;
	(cmd_add_field) a new function, which adds a new user or new
	  member. Handles ULS_ADD_FIELD request;
	(process_packet) ULS_LIST_ALL_USERS, ULS_EDIT_REGISTRATION,
	  ULS_EDIT_FIELD, ULS_DELETE_FIELD, ULS_ADD_FIELD requests are
	  handled;
	(do_backup) backup file is created with mode 0600;
	(flush_database) the database file is created with mode 0600;

2002-11-17  Alexander Chernov  <cher@ispras.ru>

	* teamdb.c:
	(teamdb_export_team) all information, except passwords, is exported
	  correctly even in client mode.

	* serve.c:
	(update_standings_file) standings header and footer are passed
	  to `write_standings';
	  the second standings are generated, if requested;
	(update_public_log_file) a new function, which periodically updates
	  public log file, if such file is requested by the serve's
	  configuration;
	(do_loop) `update_public_log_file' is called on each iteration.

	* register.c:
	FIRST_COOKIE, NEXT_COOKIE, FIRST_CONTEST, NEXT_CONTEST macros are
	  added;
	(check_contest_eligibility) registration deadline is checked;
	(register_for_contest_page) "Submit solution" column header is
	  generated only if there is atleast one such button in all
	  registered contests;
	  the current locale is preserved when following "Submit solution"
	  button;
	  locale_id is not put into invisible variables since it is passed
	  directly with URL;
	(read_user_info_from_form) `user_registering' variable is also
	  read;
	(read_user_info_from_server) `user_read_only' flag is handled;
	  user_registering flag is set to 1, if the user is not yet
	  registered to the given contest;
	(edit_registration_data) if the given user is not eligible to this
	  contest, `user_registering' flag is reset to 0;
	  the form comment is changed, if in read_only mode;
	  all input forms are generated disabled, if in read_only mode;
	  the main buttons (register for the contest, save the data,
	  back) are reimplemented to be simplier to understand;
	(main) the current time is read.

	* prepare.c, prepare.h:
	new global parameters: `standings_file_name', `stand_header_file',
	  `stand_footer_file', `stand2_file_name', `stand2_header_file',
	  `stand2_footer_file', `plog_file_name', `plog_header_file',
	  `plog_footer_file', `plog_update_time'.

	* html.h: (write_standings) two new parameters are added;
	(write_public_log) a new prototype added.

	* html.c:
	(do_write_kirov_standings) two parameters are added. These parameters
	  are for text to be printed before and after the actual standings;
	(do_write_standings) the same as above;
	(write_standings) the same as above;
	(do_write_public_log) a new function to generate a public contest
	  log;
	(write_public_log) an exported function to the above function.

	* edit-userlist.c:
	russian letters are handled correctly when pressed in various menus;
	(display_role_menu) a new function to display a menu to choose
	  between `Student', `School student', etc;
	(display_user) adding a new team member now works;
	  adding a contest registration now works;
	(display_registered_users) adding a contest registration works;
	(display_user_menu) adding a new user works.

	* clntutil.h: 
	(client_put_copyright) a new function prototype.

	* clntutil.c:
	(client_put_copyright) a new function to print only the copyright
	  notice;
	(client_put_footer) now uses `client_put_copyright'.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

2002-11-14  Alexander Chernov  <cher@ispras.ru>

	* run.c: several standard system include files are added;
	(run_tests) the program output file is created explicitly,
	  because in no-privs mode program is not allowed to create
	  new files.

	* contests.h: new tag CONTEST_REGISTRATION_DEADLINE;
	(struct contest_desc) new field `reg_deadline'.

	* contests.c: "registration_deadline" element is parsed;
	(parse_date) new function to parse dates;
	(parse_contest) "registration_deadline" element is parsed.

	* files.make: `edit_userlist.c' is added.

	* makefile: rule for compilation of `edit-userlist' added;
	several file lists are fixed (.o files were used instead of .c).

	* ejudge.ru_RU.KOI8-R.po: some new translations added

	* edit-userlist.c: completed

2002-11-10  Alexander Chernov  <cher@ispras.ru>

	* userlist_proto.h:
	(struct userlist_pk_login_ok) new `contest_id' field.

	* userlist_clnt.h:
	(userlist_clnt_team_cookie) new parameter `p_contest_id'.

	* userlist_clnt.c:
	(userlist_clnt_lookup_cookie) contest_id is copied from the reply
	  packet to the user's location;
	(userlist_clnt_team_cookie) new parameter `p_contest_id';
	  contest_id is copied from the reply packet to the user's location.

	* userlist-server.c:
	(create_newuser) login url and ejudge email are taken from the contest
	  settings, if the contest is specified;
	(login_user) contest_id of the reply packed is copied from contest_id
	  of the request packet;
	(login_team_user) the same as above;
	(login_cookie) if the contest_id of the request packet is set, it is
	  copied to the cookie structure;
	  contest_id of the reply packet is taken from the cookie structure;
	(login_team_cookie) the same as above.

	* team.c:
	(display_enter_password) the current language is set correctly
	  depending on the value of `locale_id' parameter.

	* register.c: initial number of members for user is handled;
	(register_for_contest_page) a button to proceed to team submit
	  solution page is added, if the registration status is OK;
	(prepare_var_table) initial number of members is initialized;
	(read_user_info_from_form) maximal grade is checked carefully;
	(read_user_info_from_server) initial number of members is handled;
	(edit_registration_data) "General user information" message is
	  translated;
	  a comment is printed for "User Name" field;
	(register_new_user_page) User Login field is marked mandatory;
	  Reset button is removed.

	* makefile: installed binaries are not stripped.

	* contests.h:
	new elements are supported: `register_email', `register_url',
	  `team_url';
	new attributes are supported: `initial'.

	* contests.c:
	new elements are parsed: `register_email', `register_url',
	  `team_url';
	new attributes are parsed: `initial';
	(parse_member) `initial' attribute is parsed;
	(parse_contest) new elements parsed.

	* ejudge.ru_RU.KOI8-R.po: new messages translated

	* edit-userlist.c: Initial revision

2002-11-09  Alexander Chernov  <cher@ispras.ru>

	* users.c: new static variable `self_url';
	(set_locale_by_id) a new function;
	(initialize) self-reference URL is constructed and stored in
	  `self_url';
	(main) the needed locale is set with `set_locale_by_id' call;
	  new parameters passed to `userlist_clnt_list_users'.

	* userlist_xml.c:
	(parse_passwd) all password encoding methods are now supported.

	* userlist_proto.h: new requests: ULS_MAP_CONTEST, ULS_ADMIN_PROCESS,
	  ULS_GENERATE_TEAM_PASSWORDS, ULS_TEAM_LOGIN, ULS_TEAM_CHECK_COOKIE,
	  ULS_GET_CONTEST_NAME, ULS_TEAM_SET_PASSWD;
	new reply: ULS_CONTEST_MAPPED;
	new error codes: ULS_ERR_IPC_FAILURE, ULS_ERR_IP_NOT_ALLOWED,
	  ULS_ERR_CANNOT_PARTICIPATE;
	new enumeration for user invisible and banned status;
	(struct userlist_user_short) a user information to share with `serve';
	(struct userlist_table) a user information structure to share with
	  `serve';
	(struct userlist_pk_list_users) new fields added;
	(struct userlist_pk_map_contest) new request structure;
	(struct userlist_pk_contest_mapped) new reply structure.

	* userlist_proto.c: new error message texts added.

	* userlist_clnt.h: 
	(userlist_clnt_team_login) a new prototype;
	(userlist_clnt_team_cookie) a new prototype;
	(userlist_clnt_team_set_passwd) a new prototype;
	(userlist_clnt_list_users) new parameters added;
	(userlist_clnt_admin_process) a new prototype;
	(userlist_clnt_map_contest) a new prototype;
	(userlist_clnt_generate_team_passwd) a new prototype.

	* userlist_clnt.c: 
	(userlist_clnt_team_login) a new function;
	(userlist_clnt_team_cookie) a new function;
	(userlist_clnt_set_passwd) a new function;
	(userlist_clnt_map_contest) a new function;
	(userlist_clnt_list_users) more parameters added;
	(userlist_clnt_admin_process) a new function;
	(userlist_clnt_generate_team_passwd) a new function.

	* userlist_cfg.h: (struct userlist_cfg_admin_proc) new structure;
	(struct userlist_cfg) new field `admin_processes'.

	* userlist_cfg.c: <pwd.h> is included;
	new tags <admin_processes>, <admin_process> are supported;
	new attributes "user", "path";
	(err_dupl_elem) new function;
	(err_text_not_allowed) new function;
	(err_attr_not_allowed) new function;
	(err_empty_elem) new function;
	(err_nested_not_allowed) new function;
	(err_invalid_elem) new function;
	(err_invalid_attn) new function;
	(handle_final_tag) rewritten with use of the new functions;
	(parse_processes) new function;
	(userlist_cfg_parse) <processes> element is handled.

	* userlist.h:
	enum for invisible and banned user contest status is defined;
	(struct userlist_contest) new field `flags'.

2002-11-08  Alexander Chernov  <cher@ispras.ru>

	* userlist-server.c: IPC-related header files are included;
	"version.h", "sha.h", "misctext.h" are included;
	new static variable "program_name" to store the program name;
	new static variable `contest_extras' to store the extra info about
	  contests;
	support for contest users table sharing between server and client is
	  implemented;
	(attach_contest_extra) a new function;
	(detach_contest_extra) a new function;
	(lock_userlist_table) a new function;
	(unlock_userlist_table) a new function;
	(update_userlist_table) a new function;
	(disconnect_client) contest shared info is detached;
	(graceful_exit) now is a simple function, not a signal handler;
	  it also releases the IPC objects;
	(interrupt_signal) a new function: interrupt signal handler;
	(make_sha1_ascii) a new function;
	(passwd_convert_to_internal) a new function;
	(passwd_check) a new function;
	(login_user) internal representation of the password is used;
	  passwd_check is used instead of strcmp;
	(login_team_user) a new function;
	(login_team_cookie) a new function;
	(set_user_info) all the contests, which are OK for the user, regenerate
	  teamdb tables;
	(set_password) `info' are replaced with `err' in many places;
	  a user-provided password is stored in sha1 format;
	(team_set_password) a new function;
	(do_list_users) arguments are changed;
	  more checking added;
	(cmd_map_contest) a new function;
	(cmd_admin_process) a new function;
	(do_generate_team_passwd) a new function;
	(cmd_generate_team_passwd) a new function;
	(cmd_get_contest_name) a new function;
	(process_packet) many new valid packets are added;
	(do_work) signal disposition is slightly changed;
	  root clients are never detached.

	* teamdb.h: (teamdb_open_client) a new prototype;
	(teamdb_refresh) a new prototype;
	(teamdb_regenerate_passwords) a new prototype.

	* teamdb.c: support for userlist-server mode is implemented;
	"userlist_clnt.h", "userlist_proto.h" are included;
	a number of system headers is included;
	several static variables to hold userlist-server related info;
	(lock_userlist_table) a new function;
	(unlock_userlist_table) a new function;
	(teamdb_refresh) a new function;
	(teamdb_open_client) a new function;
	(teamdb_regenerate_passwords) a new function;
	all the other function are modified to support the new client mode.

	* team.c:
	"contests.h", "userlist_proto.h", "userlist_clnt.h" included;
	new global parameters: contest_id, socket_path, contests_path;
	(fix_string) function to check a string for valid chars;
	(set_defaults) if `contest_id' is set, the program works in the
	  new mode, which includes userlist-server;
	(parse_client_ip) a new function;
	(initialize) if `contest_id' is set, the contests database is parsed;
	(check_passwd) new userlist-server mode is supported;
	(change_passwd_if_asked) new userlist-server mode is supported;
	(main) contest IP limitations are checked;
	  new userlist-server mode is supported.

	* serve.c:
	(judge_generate_passwords) a new function, which generates random
	  team passwords for the current contest;
	GENPASSWD command is handled;
	(do_loop) team database is refreshed from the server on each
	  server cycle;
	(main) if `contest_id' is set, team database is opened in client mode.

	* register.c: new static variable `self_url';
	(initialize) self referenced url is constructed;
	(logout_page) messages are changed to use `self_url';
	(registration_is_complete) `self_url' is used;
	(main) all the environment is printed (in debug mode).

	* prepare.h: "contests.h" is included;
	new global parameters: `contest_id', `socket_path', `contests_path';
	new global variables: `contests', `cur_contest'.

	* prepare.c:
	new global variables: `contests' - the list of all contests;
	  `cur_contest' the current contest;
	global parameters contest_id, socket_path, contests_path handled;
	(set_defaults) if global.contest_id is set (which means new client
	  mode, socket_path and contests_path must be set);
	  if global.contest_id == 0, old compatibility mode is supported.

	* master.c: "misctext.h" is included;
	(print_regenerate_button) a new function to print
	  "Regenerate user password" button;
	(confirm_regenerate_if_asked) a new function to print confirmation
	  dialog;
	(do_generate_passwords_if_asked) a new function;
	(main) support for user passwords regeneration is added.

	* makefile: default installation path changed;
	lists of .c files necessary for compile, serve, submit, clar, run,
	  mkpasswd, team, send-passwords, userlist-server are changed;
	no longer compiled: submit, clar, mkpasswd, make-teamdb,
	  make-teamdb-inet, send-passwords;
	require expat: compile, run, serve, submit, clar, team.

	* ejudge.ru_RU.KOI8-R.po: new messages added.

2002-11-06  Alexander Chernov  <cher@ispras.ru>

	* users.c: (main) the messages are slightly changed.

	* userlist_xml.c: element tag <team_password> is added;
	(userlist_node_alloc) `tag' field of the created node is filled;
	(node_free) freeing of `passwd' removed;
	(parse_passwd) changed to support the new XML tree;
	(do_parse_user) new element tag <team_password> is handled,
	  handling of <password> is updated.

	* userlist_cfg.c: first attribute constant now has number 1.

	* userlist.h: new element <team_password> added;
	new structure `struct userlist_passwd';
	struct `userlist_user' now contains two passwords: register_passwd and
	  team_passwd, which are references to the subnodes.

	* userlist-server.c:
	team participation status strings are now localized;
	(create_newuser) user password XML tree generation changed;
	  e-mail is sent to the user in the requested language;
	(login_user) password checking is updated due to changes in the
	  XML tree structure;
	(set_password) updated due to changes in the XML tree structure;
	(do_list_users) the list of the users is generated in the requested
	  language.

	* register.c:
	"Pending" status is printed in magenta instead of yellow;
	(change_password) invalid closing tag is fixed.

	* makefile: rule `install' added.

	* files.make: users.c file added

	* ejudge.ru_RU.KOI8-R.po: some translations are fixed

2002-11-05  Alexander Chernov  <cher@ispras.ru>

	* userlist_proto.h: ULS_LIST_USERS command is added;
	`struct userlist_pk_list_users' is added.

	* userlist_clnt.h: 
	(userlist_list_users) prototype added.

	* userlist_clnt.c:
	(userlist_list_users) a new function to request the list of users,
	  registered for a particular contest.

	* userlist-server.c:
	(create_newuser) incoming packed is strictly validated for size match;
	  some logging is added;
	  user_map is extended when full;
	(create_cookie) debugging fprintf is removed;
	(do_list_users) a new function to print the list of users, registered
	  for a particular contest;
	(list_users) a new function to handle ULS_LIST_USERS request;
	(process_packet) ULS_LIST_USERS request is handled.

	* makefile: new utility `users' is added;
	`submit' dependency rule is fixed.

	* contests.h: Element tags <header_file>, <footer_file> are added.

	* contests.c:
	Two new element tags: header_file, footer_file are added;
	(handle_final_tag) copied here from userlist_cfg.c;
	(parse_contest) <name> tag is parsed with handle_final_tag;
	  <header_file>, <footer_file> tags are parsed.

	* users.c: Initial revision

	* .cvsignore: *** empty log message ***

2002-11-04  Alexander Chernov  <cher@ispras.ru>

	* userlist_xml.c, userlist_proto.h, userlist_clnt.h, userlist_clnt.c:
	an initial version is completed.

	* userlist_cfg.h: *** empty log message ***

	* userlist_cfg.c, userlist.h, userlist.c:
	an initial version is completed.

	* makefile: `register' file list corrected;
	`userlist-server' file list corrected;
	`register.o' dependencies corrected;
	`userlist-server.o' dependencies corrected;
	`expat_iface.o' dependencies corrected.

	* contests.h, contests.c, userlist-server.c, register.c:
	an initial version is completed.

	* expat_iface.c:
	(xml_unlink_node) a new function to remove an xml_tree node from the
	  tree;
	(xml_link_node_first) a new function to add a new xml_tree node to
	  the front of the other node's children list;
	(xml_link_node_last) a new function to add a new xml_tree node to
	  the back of the other node's children list.

	* expat_iface.h: 
	(xml_unlink_node) new function prototype;
	(xml_link_node_first) new function prototype;
	(xml_link_node_last) new function prototype.

	* files.make: userlist_proto.c is added.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* userlist_proto.c: Initial revision

2002-10-28  Alexander Chernov  <cher@ispras.ru>

	* userlist_clnt.c: in progress...

	* userlist_xml.c: completely rewritten.

	* userlist_proto.h: packet formats are reworked considerably.

	* userlist_clnt.h:
	(userlist_clnt_get_email) a new function prototype.

	* userlist_cfg.c:
	(userlist_cfg_parse) a newly created tree is returned instead of
	  quitting the whole program.

	* userlist.h: completely rewritten.

	* userlist.c: removed all the old stuff (so the file is empty now ;-)

	* userlist-server.c: (generate_random_cookie) a new function;
	(generate_random_password) a new function;
	merged in Victor Matyukhin's stuff;

	* register.c: in progress...

	* makefile: base64.c is added to the list of `userlist-server' files;
	dependencies are regenerated.

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

2002-10-26  Alexander Chernov  <cher@ispras.ru>

	* contests.c, contests.h, register.c, userlist_clnt.c, userlist_proto.h:
	in progress...

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* cgi.c:
	(do_cgi_read) A case, when the first parameter is specified without
	  value is handled correctly (for example, in URL xxx?yyy).

2002-10-25  Alexander Chernov  <cher@ispras.ru>

	* contests.c, contests.h, register.c: in progress...

2002-10-24  Alexander Chernov  <cher@ispras.ru>

	* register.c, userlist_clnt.c, userlist_clnt.h, userlist_proto.h:
	in progress...

2002-10-23  Alexander Chernov  <cher@ispras.ru>

	* contests.c, contests.h: in progress...

	* ejudge.ru_RU.KOI8-R.po: *** empty log message ***

	* makefile: userlist_clnt.c is added to the list of `register' files.

	* register.c, userlist_clnt.c: in progress...

	* userlist_proto.h: Initial revision

2002-10-22  Alexander Chernov  <cher@ispras.ru>

	* register.c: "contests.h" is included;
	(initialize) `contests.xml' file is parsed.

	* makefile: contests.c is added to the list of `register' files.

	* contests.h, contests.c: in progress...

2002-10-21  Alexander Chernov  <cher@ispras.ru>

	* files.make: contests.[ch] is added.

	* contests.h, contests.c: Initial revision

	* register.c: in progress...

2002-10-21  Alexander Chernov  <cher@ispras.ru>

	* userlist_cfg.h: "expat_iface.h" is included;
	(struct userlist_cfg) it is now a subtype of xml_tree.

	* userlist_cfg.c:
	new module `expat_iface' is used instead of direct use of the expat
	  XML parser.

	* register.c: rewritten completely.

	* makefile: `register' files are changed;
	`register' utility needs expat.

	* expat_iface.h: (struct xml_attn) `line', `column' fields are added;
	(struct xml_tree) `line', `column' fields are added;
	(xml_build_tree) `tag_map', `attn_map' are declared `const';
	(xml_build_tree_str) the same as above;
	(xml_unparse_tree) parameters are changed;
	(xml_unparse_tree_str) parameters are changed.

	* expat_iface.c:
	(struct parser_data) `tag_map', `attn_map' fields are defined `const';
	(start_hnd) `tag_map' may be NULL;
	  current line and column is stored in the tree;
	  the root tree node is saved in `parser_data' structure;
	  `attn_map' may be NULL;
	  attribute line and column are saved in the tree;
	(xml_build_tree) `tag_map', `attn_map' are declared `const';
	(xml_build_tree_str) `tag_map', `attn_map' are declared `const';
	(do_xml_unparse_tree) a new function to do XML unparsing;
	(xml_unparse_tree) a new function to do XML unparsing.

	* ejudge.ru_RU.KOI8-R.po: new messages are translated

	* ejudge.fr_FR.ISO8859-1.po: Initial revision

2002-10-19  Alexander Chernov  <cher@ispras.ru>

	* expat_iface.c, expat_iface.h: in progress...

2002-10-19  Alexander Chernov  <cher@ispras.ru>

	* team.c:
	(main) all the action, which require team<->serve interaction are
	  disabled, if `server_clients_suspended' variable is set.

	* serve.c:
	(update_status_file) score_system_val and clients_suspended are
	  written to server status;
	(is_valid_status) SCORE_OLYMPIAD score system is supported;
	(read_compile_packet) SCORE_OLYMPIAD score system is supported
	  if the contest is not over, run packet is generated to have
	  `accept_testing' parameter set;
	(read_run_packet) SCORE_OLYMPIAD score system is supported;
	(judge_rejudge_all) a new function;
	(judge_rejudge_problem) a new function;
	(judge_reset_contest) a new function;
	(judge_suspend_clients) a new function;
	(judge_resume_clients) a new function;
	(judge_cmds) new commands `REJUDGE', `REJUDGEP', `RESET',
	  `SUSPEND', `RESUME' are supported;
	(do_loop) team's packets are not processed, if clients_suspended
	  variable is set.

	* runlog.h:
	`RUN_ACCEPTED', `RUN_MAX_STATUS' are added to testing outcome
	  enumeration;
	(run_reset) a new function prototype is added.

	* runlog.c: <reuse/osdeps.h> is included;
	(run_status_str) a new return code RUN_ACCEPTED is handled;
	(run_reset) a new function to clear the submission log.

	* run.c:
	(generate_report) a new parameter `accept_testing' is accepted, if
	  this parameter is 1, only acceptance testing is performed;
	  new SCORE_OLYMPIAD score system is supported;
	(generate_team_report) a new parameter `accept_testing' is accepted;
	  new SCORE_OLYMPIAD score system is supported;
	(run_tests) a new parameter `accept_testing' is added;
	  new SCORE_OLYMPIAD score system is supported;
	(do_loop) a new parameter is the serve's packet: `accept_testing'
	  is parsed and supported;
	(check_config) number of acceptance tests cannot exceed the total
	  number of tests.

	* protocol.h: score system enumeration is also defined here;
	(struct prot_serve_status) fields `score_system', `clients_suspended'
	  are added.

	* prepare.h:
	score system enumeration definition is protected with conditional
	  compilation, as it also defined in another file (protocol.h);
	(struct section_global_data) `tests_to_accept' parameter is added;
	(struct section_problem_data) `tests_to_accept' parameter is added.

	* prepare.c: new parameter `tests_to_accept' is parsed;
	(global_init_func) `tests_to_accept' parameter is set to -1;
	(problem_init_func) `tests_to_accept' parameter is set to -1;
	(set_defaults) `tests_to_accept' parameter is processed.

	* master.c:
	new configuration parameter `problems_submit_file' to read the list
	  of all the problems;
	(print_reset_button) a new function;
	(print_suspend_button) a new function;
	(print_resume_button) a new function;
	(confirm_reset_if_asked) a new function, which generates the
	  "Confirm reset" dialog;
	(do_contest_reset_if_asked) a new function to perform contest reset;
	(do_suspend_if_asked) a new function to suspend clients;
	(do_resume_if_asked) a new function to resume clients;
	(do_rejudge_all_if_asked) a new function to rejudge all the
	  solutions;
	(do_rejudge_problem_if_asked) a new function to rejudge one particular
	  problem;
	(main) all the new master commands are supported.

	* html.c:
	(write_team_statistics) new SCORE_OLYMPIAD score system is supported;
	(do_write_kirov_standings) the same as above;
	(write_standings) the same as above;
	(write_judge_allruns) the same as above;
	(write_judge_standings) the same as above.

	* makefile: expat_iface is added to the userlist-server files.

	* files.make: expat_iface.[ch] module is added.

	* ejudge.ru_RU.KOI8-R.po: new translations added.

	* clarlog.c:
	(clar_reset) a new function, which clears the clarification log.

	* clarlog.h: (clar_reset) a prototype added.

	* clntutil.c:
	new global variables: server_score_system, server_clients_suspended;
	(client_check_server_status) new server status fields (see above)
	  are read;
	(client_print_server_status) message is printed, if clients are
	  suspended.

	* clntutil.h: new variables are exported: server_score_system,
	server_clients_suspended.

2002-10-18  Alexander Chernov  <cher@ispras.ru>

	* expat_iface.h, expat_iface.c: Initial revision

2002-10-15  Alexander Chernov  <cher@ispras.ru>

	* sformat.c, serve.c:
	the final "Local variables" section is slightly changed.

	* mkpasswd.c:
	(main) "enable-multibute-characters" directive is removed from
	  the generated LaTeX file.

	* clntutil.c, cgi.c:
	the final "Local variables" section is slightly changed.

	* userlist-server.c: (main) help message translation is disabled.

	* team.c: <sys/time.h> is included;
	new parameter `show_generation_time';
	(initialize) error messages, which are written during configuration
	  file parsing are not translatable;
	(main) client page generation time (real time) is measured and
	  displayed, if `show_generation_time' parameter is set;
	  "Submission log" is not displayed until contest is started.

	* serve.c:
	(do_loop) contest_duration == 0 is considered as infinite contest
	  duration;
	  information messages, written to log marked as not translatable.

	* register.c:
	(set_defaults) error messages are marked as not translatable;
	(initialize) error messages for client_not_configured function
	  are also marked as untranslatable.

	* prepare.c:
	(global_init_func) `contest_time' parameter is initialized to -1;
	(set_defaults) unset flag for `contest_time' is now -1.

	* mkpasswd.c: (main) team information is marked as not translatable.

	* master.c:
	(set_defaults) error messages written to the log are not marked
	  as translatable;
	(initialize) "client not configured" messages are also not translated.

	* makefile: `clean' rule is changed slightly.

	* html.c:
	(write_team_statistics) submit buttons for "View report" and
	  "View source" are generated instead of image buttons.
	(write_judge_allruns) the same as above.

	* ejudge.ru_RU.KOI8-R.po: all the messages are translated.

	* clntutil.c:
	(client_print_server_status) server_duration == 0 is considered as
	  unlimited contest and printed as "Unlimited".

	* cgi.c:
	(bad_request) message translation calls are removed, since when
	  this function works, CGI parameters are not yet parsed;
	  added actual email <cher@unicorn.cmc.msu.ru> to the message.
	(request_too_large) message translation calls are removed.

2002-10-14  Alexander Chernov  <cher@ispras.ru>

	* makefile: ejudge.ru_RU.KOI8-R.po is made writable before msgmerge.

	* ejudge.ru_RU.KOI8-R.po: Initial revision

	* .cvsignore: *** empty log message ***

	* clntutil.c: "protocol.h" is included;
	<reuse/osdeps.h> is included;
	new global variables server_clars_disabled, server_team_clars_disabled,
	  server_standings_frozen;
	(client_check_server_status) the server keepalive messages are now
	  in binary format;
	(client_print_server_status) whether the standings are frozen is
	  printed.

	* clntutil.h: copyright notice is updated;
	`server_clars_disabled', `server_team_clars_disabled',
	  `server_standings_frozen' variables are declared as external.

	* compile.c: (do_loop) serve->compile protocol is changed;
	  the loop is rearranged;
	(check_config) `queue_dir' is checked to be writable.

	* files.make: protocol.h is added.

	* html.c:
	(write_team_statistics) a message is marked as not translatable;
	  `run_get_record' now accepts more parameters;
	(do_write_kirov_standings) `run_get_record' signature changed;
	(do_write_standings) `run_get_record' signature changed;
	(write_judge_allruns) `run_get_record' signature changed;
	  run change status menu is rearranged;
	(write_team_source_view) `run_get_record' signature changed;
	(write_team_report_view) `run_get_record' signature changed.

	* makefile: *~ files are removed on `clean' rule;
	ejudge.po is also removed;
	ejudge.ru_RU.KOI8-R.po is processed by merging the previous version
	  and `ejudge.po';
	ejudge.po rule is updated;
	mo rule is added to compile the message translation catalogs.

	* master.c:
	`enable_l10n', `l10n_dir' parameters are added and parsed;
	"refresh" button is renamed to "Refresh".

	* prepare.c:
	(section_global_params) all the new global configuration parameters
	  are added;
	(section_language_params) all the new language configuration parameters
	  are added;
	(section_tester_params) all the new tester parameters are added;
	(global_init_func) a new function, which initializes global section
	  variables;
	(tester_inheritance_info) `queue_dir' is added to the inheritance list;
	(set_defaults) all the new configuration parameters are processed;
	  value `0' of `board_unfog_time' is accepted as unfog right after the
	  contest stops;
	  the upper limit on the contest duration is removed;
	(create_dirs) `queue_dir' parameters are handled;
	(print_tester) new tester parameters are printed.

	* prepare.h:
	new global parameter `autoupdate_standings'. If enabled (the default)
	  the server updates the standing when the contest status or standings
	  change;
	new global flags fog_standings_updated, start_standings_updated,
	  unfog_standings_updated which are not user-settable;
	new global parameter `disable_clars'. If set, the clarification
	  requests are completely disabled;
	new global parameter `disable_team_clars'. If set, teams cannot
	  compose clarification requests, but the judges can.
	new global parameter `enable_l10n'. If set, message translation is
	  enabled;
	new global parameter `l10n_dir', which points to the message catalog
	  directory;
	new global parameter `standings_locale' which contains the locale
	  name for standings displaying. The only supported locale is yet
	  `ru_RU.KOI8-R';
	new global parameter `compile_queue_dir' for the queue of compile
	  commands issued by the serve;
	new global parameter `run_queue_dir' for the queue of run commands
	  issued by the serve;
	new language parameter `server_queue_dir' for the queue of server
	  compile commands;
	language parameter `src_dir' is replaced with language parameter
	  `queue_dir';
	new tester parameter `server_queue_dir' for the queue of server
	  run commands;
	tester parameter `exe_dir' is replaced with tester parameter
	  `queue_dir'.

	* run.c: <locale.h> is included, if localization is enabled;
	(setup_locale) a new function, which sets up the locale by the
	  locale_id;
	(print_by_line) `file is too long' is marked as a translatable message;
	  `line is too long' is marked as a translatable message;
	(generate_report) `OK' is marked as a translatable message;
	  `Score' is marked as a translatable message;
	(generate_team_report) `OK' and `Score' are now translatable messages;
	(run_tests) `locale_id' parameter is accepted;
	  the given locale_id is activated before `generate_team_report' is
	  called, the default locale is activated after the call;
	  removed some previously commented stuff;
	(do_loop) serve->run protocol is changed;
	  loop is generally reorganized;
	(main) message translation catalogs are set up, if the localization is
	  enabled.

	* runlog.c: RUN_RECORD_SIZE increased to 105;
	(struct run_entry) field `locale_id' is added;
	(run_read_entry) `locale_id' field is read;
	(run_make_record) `locale_id' parameter is accepted;
	(run_flush_entry) `locale_id' field is written;
	(run_add_record) `locale_id' parameter is accepted;
	(run_get_param) `plocale_id' parameter is accepted;
	(run_get_record) `plocale_id' parameter is accepted;
	(run_get_fog_period) a new function, which returns:
	  -1, if the contest is not started;
	  0, if the fog perion is not started;
	  1, if the fog perion is effective;
	  2, if the fog perion ended.

	* runlog.h: copyright notice is updated;
	(run_add_record) a new parameter `locale_id' is accepted;
	(run_get_param) a new parameter `plocale_id' is accepted;
	(run_get_record) a new parameter `plocale_id' is accepted;
	(run_get_fog_period) a new function.

	* serve.c: "protocol.h" is included;
	<locale.h> is included if compile-time localization is enabled;
	(setup_locale) a new function, which sets up the current locale by
	  `locale_id' parameter;
	(update_standings_file) function is totally rewritten. It also updates
	  `start_standings_updated', `fog_standings_updated',
	  `unfog_standings_updated' depending on the time period;
	(update_status_file) function is totally rewritten. Status file now
	  has binary format (as defined in protocol.h).
	(team_view_clar) `locale_id' parameter of the command is accepted;
	  error generated, if clarifications are disabled;
	(team_send_clar) `locale_id' parameter of the command is accepted;
	  error generated, if clarifications are disabled;
	(team_submit) `locale_id' parameter of the command is accepted;
	  `locale_id' is saved in the run log;
	  serve->compile protocol is changed by using the explicit command
	  safe directories and the separate source directory;
	(team_change_passwd) `locale_id' parameter of the command is accepted;
	(team_stat) `locale_id' parameter of the command is accepted;
	(team_view_report) `locale_id' parameter of the command is accepted;
	(team_view_source) `locale_id' parameter of the command is accepted;
	(read_team_packet) locale is reset to the default (0), after the
	  function, which executes the command, is completed;
	(read_compile_packet) `locale_id' parameter is requested from the
	  run log with `run_get_param' function;
	  serve->run protocol is changed by using an expilicit command safe
	  directory queue and the separate exe directory;
	(read_run_packet) `run_get_param' now accepts pointer to `locale_id'
	  parameter, so the call is updated;
	(rejudge_run) `locale_id' is requested from run log by using changed
	  `run_get_record' function;
	  serve->compile protocol is changed (see above);
	(judge_start) standings are no longer updated from here;
	(judge_stop) standings are no longer updated from here;
	(do_loop) if the current time is in fog period, let the
	  `fog_standings_updated' variable be set;
	  standings are automatically updated right after the start, right
	  after the fog period started, right after the fog period ended;
	  if compile-time and run-time localization is enabled, program
	  message catalogs are initialized.

	* team.c: <locale.h> is included, if internalization is enabled;
	(struct section_global_data) new parameters `enable_l10n' and
	  `l10n_dir' are added;
	new global variable `client_locale_id';
	(section_global_params) `enable_l10n', `l10n_dir' parameters are
	  parsed;
	(set_defaults) error messages written to log are not localized;
	  new configuration parameters are checked;
	(read_state_params) `locale_id' parameter, which contains the
	  language identifier is passed in forms along with `login' and
	  `password' parameters;
	(display_enter_password) locale selection dialog is added;
	(print_refresh_button) the default label for the button is `Refresh';
	(get_team_statistics) added `locale_id' parameter to `STAT' request;
	(send_clar_if_asked) check that the messages are disabled is added;
	  parameter `locale_id' added to `CLAR' command;
	(submit_if_asked) parameter `locale_id' added to `SUBMIT' command;
	(change_passwd_if_asked) parameter `locale_id' added to `PASSWD'
	  command;
	(show_clar_if_asked) check that the messages are disabled is added;
	  parameter `locale_id' is added to `VIEW' command;
	(request_source_if_asked) parameter `locale_id' added to `SOURCE'
	  command;
	(request_report_if_asked) parameter `locale_id' added to `REPORT'
	  command;
	(main) message translation is set up, if CONF_HAS_LIBINTL compile-time
	  macro is set and `enable_l10n' run-time parameter is set;
	  clarification send dialog is not shown, if team clarifications are
	  disabled;
	  clarification list is now shown, if clarifications are disabled;
	  reference to "Change language" dialog is added to the fast
	  navigation menu;
	  "Change Language" dialog is activated, if localization is enabled.

2002-10-13  Alexander Chernov  <cher@ispras.ru>

	* protocol.h: Initial revision

2002-10-12  Alexander Chernov  <cher@ispras.ru>

	* ejudge.ru-KOI8_R.po: no longer used

2002-10-11  Alexander Chernov  <cher@ispras.ru>

	* prepare.c:
	(set_defaults) maximal contest_time is increased to 100 hours.

	* run.c:
	(run_tests) correct answer files are only used if `use_corr' flag is
	  set for a problem.

	* team.c:
	(main) generated html modified, so "Team standings" and "Problems"
	  open in a new window.

2002-10-09  Alexander Chernov  <cher@ispras.ru>

	* base64.c, cgi.c, clar.c, clarlog.c, clntutil.c, compile.c, html.c, mkpasswd.c, parsecfg.c, prepare.c, revinfo.c, run.c, runlog.c, serve.c, submit.c, teamdb.c:
	redundant message translations (_(...)) are removed

2002-10-08  Alexander Chernov  <cher@ispras.ru>

	* files.make: userlist_clnt.[ch] files added.

	* userlist-server.c: in progress...

	* userlist_xml.c: adapted to use in userlist-server.

	* userlist.c:
	(userlist_validate) a new name of previous `user_data_validate';
	(userlist_free) a new name of previous `user_data_free'.

	* userlist.h: 
	(userlist_free) a prototype added.

	* nls.c: <string.h> is included.

	* makefile: userlist-server file list is changed.

	* userlist_clnt.c, userlist_clnt.h: Initial revision

2002-10-07  Alexander Chernov  <cher@ispras.ru>

	* files.make: userlist-server.c added.

	* userlist_cfg.h, userlist_cfg.c: completed.

	* nls.c: windows-1251 encoding added as alias to cp1251.

	* makefile: userlist-server added to TARGETS;
	UL_CFILES, UL_OBJECTS variables declared;
	rule to compile userlist-server added.

	* userlist-server.c: Initial revision

	* .cvsignore: *** empty log message ***

2002-10-06  Alexander Chernov  <cher@ispras.ru>

	* prepare.c, prepare.h:
	added global properties `sound_player', `*_sound'.

	* run.c:
	(run_tests) playing sound, which depends on outcome of test run
	  is added.

2002-10-05  Alexander Chernov  <cher@ispras.ru>

	* run.c:
	(run_tests) `task_SetMaxRealTime' is called, if `max_real_time'
	  parameter is set.

	* prepare.h:
	(struct section_problem_data) `real_time_limit' field is added.

	* prepare.c:
	(section_problem_params) `real_time_limit' parameter is added;
	(set_defaults) `real_time_limit' problem parameter is processed.

	* clntutil.c: 
	(client_put_footer) copyright information is updated.

2002-10-03  Alexander Chernov  <cher@ispras.ru>

	* makefile: list of files are moved to a separate file `files.make'.

	* files.make: Initial revision

2002-10-02  Alexander Chernov  <cher@ispras.ru>

	* userlist_xml.c: some functions are moved to separate files.

	* nls.h: (nls_lookup_table) a new function is added.

	* userlist_cfg.h, userlist_cfg.c, utf8_utils.h, utf8_utils.c, nls.c:
	Initial revision

2002-09-30  Alexander Chernov  <cher@ispras.ru>

	* sha.h, sha.c: copyright notice is added.

	* nls_iso8859-5.c: added exported reference to translation table.

	* nls.h: #endif is fixed.

	* makefile: file list is updated (NLS files and XML parsing).

	* userlist_xml.c, userlist.h, userlist.c, nls_utf8.c:
	Initial revision

2002-09-24  Alexander Chernov  <cher@ispras.ru>

	* sha.h, sha.c: Initial revision

2002-09-01  Alexander Chernov  <cher@ispras.ru>

	* sformat.c, prepare.c, parsecfg.c: <string.h> is included.

	* mkpasswd.c, misctext.c, make-teamdb.c: copyright notice is updated;
	<string.h> is included.

2002-06-16  Alexander Chernov  <cher@ispras.ru>

	* sformat.c, serve.c, run.c: <reuse/format_io.h> is included.

2002-05-20  Alexander Chernov  <cher@ispras.ru>

	* mkChangeLog.c:
	(read_ChangeLog) internal line length limit is increased to 8192.

2002-03-30  Alexander Chernov  <cher@ispras.ru>

	* prepare.c: added missed `use_corr' problem parameter.

2002-03-22  Alexander Chernov  <cher@ispras.ru>

	* makefile: the files from reuse library are removed;
	configuration section is remade;
	reuse library is used to compile the sources.

	* pathutl.h: copyright notice is updated;
	`pathcpy', `pathcat', `path_add_dir', `path_init' functions are
	  defined `extern inline', only if compiled with gcc.

	* teamdb.c, team.c: copyright notice is updated;
	`osdeps.h', `logger.h', `xalloc.h' are included from reuse library.

	* submit.c: copyright notice is updated;
	`logger.h' is included from reuse library.

	* sformat.c: copyright notice is updated;
	`xalloc.h', `number_io.h' are included from reuse library.

	* serve.c:
	`xalloc.h', `logger.h', `osdeps.h', `number_io.h' are included from
	  reuse library.

	* runlog.c: copyright notice is updated;
	`xalloc.h', `logger.h' are included from reuse library.

	* run.c: copyright notice is updated;
	`osdeps.h', `logger.h', `exec.h', `xalloc.h', `number_io.h'
	  are included from reuse library.

	* revinfo.c: copyright notice is updated;
	(main) removal of file from the database does not cause a fatal error.

	* register.c, prepare.c: copyright notice is updated;
	`xalloc.h', `logger.h', `osdeps.h' are included from reuse library.

	* pathutl.c: copyright notice is updated;
	`osdeps.h', `logger.h' are included from reuse library.

	* parsecfg.c: copyright notice is updated;
	`xalloc.h' is included from reuse library include directory.

	* misctext.c: copyright notice is updated;
	`xalloc.h' is included from reuse library.

	* master.c: copyright notice is updated;
	`osdeps.h', `xalloc.h', `logger.h' are included from reuse library.

	* localdb.c: copyright notice is updated;
	`xalloc.h' is included from reuse library.

	* inetdb.c: copyright notice is updated;
	`xalloc.h' is include from reuse library.

	* idmap.c: copyright notice is updated;
	`xalloc.h' is included from reuse library.

	* html.c: copyright notice is updated;
	`logger.h', `xalloc.h', `osdeps.h' are include from reuse library.

	* compile.c: copyright notice is updated;
	`xalloc.h', `logger.h', `exec.h', `osdeps.h' are included from reuse
	  library.

	* clntutil.c: copyright notice is updated;
	`logger.h', `xalloc.h' are included from reuse library.

	* clarlog.c: copyright notice is updated;
	`logger.h', `xalloc.h', `osdeps.h' are included from reuse library.

	* clar.c: copyright notice is updated;
	`logger.h' is included from reuse library.

	* cgi.c: copyright notice is updated;
	`xalloc.h' is included from reuse library.

	* base64.c: copyright notice is updated;
	`logger.h' is included from reuse library.

2002-01-09  Alexander Chernov  <cher@ispras.ru>

	* sformat.c: copyright notice is updated;
	"number_io.h" is included instead of "osdeps.h" to import os_snprintf.

	* serve.c, run.c: copyright notice is updated;
	"number_io.h" is included to import os_snprintf.

	* makefile: copyright notice is updated;
	number_io.[ch] added to the list of all C and H files;
	-DR_HAS_LONGLONG added to compiler options;
	number_io.c is required to compile most of compiled binaries.

	* number_io.h:
	(os_readdf,os_readdd,os_readdld) prototypes added.

	* number_io.c:
	(os_readhf,os_readhd,os_readhld) only if endptr == 1, format error
	  is reported, if there is a garbage after number;
	(os_readdf,os_readdd,os_readdld) new functions are implemented to
	  convert floating-point number in decimal character notation into
	  internal form for floats, doubles and long doubles respectively.
	  These functions currenly use sscanf, so underflows and overflows
	  are not properly reported.

2002-01-08  Alexander Chernov  <cher@ispras.ru>

	* number_io.h: (os_readint) moved from `reuse/osdeps';
	(os_readdouble) moved from `reuse/osdeps';
	(reuse_strtoll) moved from `reuse/osdeps';
	(reuse_strtoull) moved from `reuse/osdeps';
	(os_readll) moved from `reuse/osdeps';
	(os_readull) moved from `reuse/osdeps';
	(os_writell) moved from `reuse/osdeps';
	(os_writeull) moved from `reuse/osdeps';
	(os_snprintf) moved from `reuse/osdeps';
	(os_vsnprintf) moved from `reuse/osdeps';
	(os_writehf) prototype for this new function added;
	(os_writehd) prototype for this new function added;
	(os_writehld) prototype for this new function added;
	(os_readhf) prototype for this new function added;
	(os_readhd) prototype for this new function added;
	(os_readhld) prototype for this new function added.

	* number_io.c: (os_readint) moved from `reuse/osdeps';
	(os_readdouble) moved from `reuse/osdeps';
	(reuse_strtoll) moved from `reuse/osdeps';
	(reuse_strtoull) moved from `reuse/osdeps';
	(os_readll) moved from `reuse/osdeps';
	(os_readull) moved from `reuse/osdeps';
	(os_writell) moved from `reuse/osdeps';
	(os_writeull) moved from `reuse/osdeps';
	(os_snprintf) moved from `reuse/osdeps';
	(os_vsnprintf) moved from `reuse/osdeps';
	(copy_to_buf) a new static helper function to work with limited
	  buffers;
	(os_writehf) a new function to convert `float' values to hex strings;
	(os_writehd) a new function to convert `double' values to hex strings;
	(os_writehld) a new function to convert `long double' values to hex;
	(os_readhf) a new function to parse `float' hex strings;
	(os_readhd) a new function to parse `double' hex strings;
	(os_readhld) a new function to parse `long double' hex strings.

	* osdeps.h: copyright notice is updated;
	(os_readint) moved to `reuse/number_io';
	(os_readdouble) moved to `reuse/number_io';
	(reuse_strtoll) moved to `reuse/number_io';
	(reuse_strtoull) moved to `reuse/number_io';
	(os_readll) moved to `reuse/number_io';
	(os_readull) moved to `reuse/number_io';
	(os_writell) moved to `reuse/number_io';
	(os_writeull) moved to `reuse/number_io';
	(os_snprintf) moved to `reuse/number_io';
	(os_vsnprintf) moved to `reuse/number_io'.

2002-01-07  Alexander Chernov  <cher@ispras.ru>

	* number_io.h, number_io.c: Initial revision

2001-12-26  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h:
	Prototypes for new functions `os_writell', `os_writeull' added.

2001-12-09  Alexander Chernov  <cher@ispras.ru>

	* makefile: added rule `log' to generate ChangeLog;
	added compilation of mkChangeLog utility.

	* AUTHORS: initial revision

2001-12-08  Alexander Chernov  <cher@ispras.ru>

	* makefile: compilation of run.exe enabled on win32;
	-O2 insteand of -O3 on win32;
	-s during linking on win32.

	* run.c:
	(result2str) os_GetSignalString is used instead of strsignal.

2001-12-04  Alexander Chernov  <cher@ispras.ru>

	* NEWS: set the date of 1.4.0 release

2001-12-04  Alexander Chernov  <cher@ispras.ru>

	* makefile: compilation of run.exe for Windows is disabled fow now.

	* sformat.c:
	(sformat_message) os_snprintf is used instead of snprintf, this
	  allows compilation on Windows platform.

2001-12-04  Alexander Chernov  <cher@ispras.ru>

	* NEWS: Many additions for version 1.4.

	* pathutl.c, submit.c:
	meaningless change in order to normalize revision number.

	* parsecfg.c:
	(copy_param) new parameter type "x" is supported: this type means,
	  that string values to be added to extendable string array;
	(sarray_len) new function, which returns the number of strings
	  in an extendable string array;
	(sarray_free) new function, which frees memory from an extendable
	  string array;
	(sarray_merge_pf) new function, which merges two extendable string
	  arrays, freeing the second argument and preserving the first;
	(sarray_merge_arr) new function, which merges an array of extendable
	  string arrays.

	* parsecfg.h: 
	(sarray_len) new function prototype;
	(sarray_merge_pf) new function prototype;
	(sarray_free) new function prototype;
	(sarray_merge_arr) new function prototype.

	* prepare.c:
	(section_tester_params) type of `super' field changed to "x";
	  new field `clear_env' of type "d";
	  new field `start_env' of type "x";
	(tester_get_name) new function, which returns name of tester;
	(struct inheritance_info) new structure to specify inheritable fields;
	(inherit_fields) new function, which processes inheritance
	  specifications;
	(inh_isdef_int) new function;
	(inh_isdef_int2) new function;
	(inh_copy_int) new function;
	(inh_isdef_path) new function;
	(inh_isdef_path2) new function;
	(inh_copy_path) new function;
	(tester_inheritance_info) new table, which specifies, which fields
	  may be inherited for testers;
	(process_abstract_tester) new function to handle abstract testers;
	(set_defaults) `start_env' is processed: the values of supertester
	  and concrete tester are merged;
	  `errorcode_file' is checked properly for being undefined;
	  `clear_env' variable is handled;
	  single inheritance for concrete testers is allowed;
	  handling of abstract testers is moved into a separate function;
	(print_global) new function;
	(print_problem) new function;
	(print_all_problems) new function;
	(print_language) new function;
	(print_all_languages) new function;
	(print_tester) new function;
	(print_all_testers) new function;
	(print_configuration) new function, which prints all the configuration
	  variables.

	* exec.h: 
	(task_PutEnv) new function prototype;
	(task_ClearEnv) new function prototype.

2001-12-03  Alexander Chernov  <cher@ispras.ru>

	* prepare.h: include of <stdio.h> is added;
	(struct section_tester_data) type of `super' field is changed to
	  enable multiple inheritance;
	  new field `is_processed' (which may not be set from configuration
	  file). It is set to 1, when the tester is processed, i.e. fields are
	  inherited from its supertesters. Used to prevent circular
	  inheritance;
	  new field `clear_env';
	  new field `start_env';
	(print_problem) new prototype;
	(print_language) new prototype;
	(print_tester) new prototype;
	(print_global) new prototype;
	(print_all_languages) new prototype;
	(print_all_problems) new prototype;
	(print_all_testers) new prototype;
	(print_configuration) new prototype.

	* run.c:
	(run_tests) configuration variables `clear_env' and `start_env'
	  are honored when the testee program is started;
	(main) support for new option '-T' added. If this option is specified,
	  all the configuration settings are printed to stdout
	  (using print_configuration() function) and the program exits
	  with code 0.

	* compile.c, serve.c:
	(main) support for new option '-T' added. If this option is specified,
	  all the configuration settings are printed to stdout
	  (using print_configuration() function) and the program exits
	  with code 0.

2001-11-29  Alexander Chernov  <cher@ispras.ru>

	* NEWS: all the changes from 1.3.1 are documented

2001-11-08  Alexander Chernov  <cher@ispras.ru>

	* run.c:
	(struct testinfo) added field termsig to hold the termination signal;
	(result2str) 2 extra parameters added to verbosely print the
	  description of the terminating signal;
	(generate_report) updated to use the new result2str prototype;
	(generate_team_report) updated to use the new result2str prototype;
	(run_tests) added support for the new parameters:
	  `kill_signal', `no_core_dump', `max_stack_size', `max_data_size',
	  `max_vm_size';
	(run_tests) if the program is terminated due to a signal, its number
	  is saved in struct testinfo.

	* prepare.c:
	support for the new parameters `no_core_dump', `kill_signal',
	  `max_stack_size', `max_data_size', `max_vm_size' added.

	* prepare.h: new checker parameters: `no_core_dump', `kill_signal',
	  `max_stack_size', `max_data_size', `max_vm_size'.

	* exec.h: prototypes for new functions `task_SetKillSignal',
	  `task_SetStackSize', `task_SetDataSize', `task_SetVMSize',
	  `task_DisableCoreDump' added.

2001-11-07  Alexander Chernov  <cher@ispras.ru>

	* prepare.c:
	new static variables `abstr_probs', `abstr_testers', `max_abstr_prob',
	  `max_abstr_tester';
	new problem parameters `abstract', `super';
	(set_initial_values) removed since never used;
	(problem_init_func) new function, which initializes some fields in
	  a new problem data structure to a special `uninitialized' value;
	(tester_init_func) new function;
	(set_defaults)
	  1) added code to check goodness of abstract problem specification
	    (must have `short_name' field filled, cannot define `id',
	    `long_name', `super');
	  2) if the problem specification has `super' field, the corresponding
	    abstract problem is looked up;
	  3) any problem now must have `short_name' field defined;
	  4) if `long_name' is not defined, it is composed from `short_name';
	  5) for fields: `enable_rep_view', `full_score', `test_score',
	    `run_penalty', `use_stdin', `use_stdout', `time_limit',
	    `test_score_list', `test_sfx', `corr_sfx', `test_dir' (*),
	    `corr_dir' (*), `input_file', `output_file':
	    if a field is not defined in problem specification, but defined
	    in a superproblem for this problem, the field value is copied
	    from the superproblem, for fields marked (*) sformat_message
	    substitution is performed;
	  6) `test_sfx', `corr_sfx' are properly inherited from global, if
	    necessary;
	  6) added code to check abstract tester specification
	    (must define `name' field, cannot define `id', `super', `problem',
	    `problem_name');
	  7) for the following tester fields: `arch', `key', `tester_dir' (*),
	     `tmp_dir' (*), `work_dir' (*), `server_root_dir', `exe_dir' (*),
	     `is_dos', `no_redirect', `error_file' (*), `errorcode_file' (*),
	     `start_cmd', `prepare_cmd':
	    if a field is not defined in tester specification, but defined
	    in a supertester, the field value is copied
	    from the supertester, for fields marked (*) sformat_message
	    substitution is performed;
	(collect_sections)
	  1) abstract problems are collected to `abstr_probs' array;
	  2) abstract testers are collected to `abstr_testers' array;
	(prepare)
	  1) removed call of `set_initial_values';
	  2) fixed invalid usage of the 4th argument of parse_param function
	    call.

	* prepare.h:
	problem.abstract - new parameter, which is set to 1, if the problem
	  is the abstract problem specification;
	problem.use_corr - new parameter, which is set to 1, if the correct
	  answers for tests are provided. The initialization code contains
	  some heuristics to set it, if it was not set. For example, if the
	  correct answer directory was provided, this parameter is set to 1.
	problem.super - is the name of the superproblem specification
	  (which must be an abstract problem).
	  Most of the field values may be inherited from this abstract
	  problem's values.
	tester.abstract - new parameter, which is set to 1, if the tester
	  specification is abstract;
	tester.super - is the name of the supertester specification
	  (which must be an abstract tester).

	* teamdb.c:
	(teamdb_export_team) new function, which fills up a structure,
	  containing all the information about a team.

	* teamdb.h:
	(struct teamdb_export) a new structure is defined just to export
	  all the information about a team in one place. This structure
	  is then passed further to sformat_message function;
	(teamdb_export_team) a new function, which fills up this structure.

	* sformat.c: some debugging

	* run.c:
	(check_config) new tester parameter use_corr is used to decide
	  whether the correct answer files to be used.

	* pathutl.h:
	added GNU C specific function attributes to perform printf format
	checking on function calls of err and warn.

	* parsecfg.c:
	(read_variable) if only the variable name is provided, without the
	  value, "1" is assumed (like in C preprocessor -D option);
	(parse_param) section initialization function is called right
	  after xcalloc;
	(parse_param) stdout is flushed in order to not lost debugging output.

	* parsecfg.h:
	(struct config_section_info) added field `init_func' --- the initialize
	  function, which is called right after the memory for the new section
	  is allocated.

	* team.c, master.c:
	(initialize) configurable data directory is implemented --
	  CGI_DATA_PATH variable is used.

	* makefile:
	new variable CGI_DATA_PATH_FLAG allows setting of CGI scripts data dir;
	sformat.[ch] files added.

	* html.c:
	(sformat_url) function is removed, since it is superseded by a new
	  function `sformat_message' from sformat.c;
	(do_write_kirov_standings) changed to use `sformat_message';
	(do_write_standings) changed to use `sformat_message'.

	* clarlog.c: (clar_open) minor printf format warning is fixed.

	* sformat.h, sformat.c: Initial revision

2001-10-08  Alexander Chernov  <cher@ispras.ru>

	* html.c:
	(write_clar_view) team name is printed instead of team login;
	(do_write_kirov_standings) invalid <a> tag generation fixed;
	(write_judge_allclars) team name is printed instead of team login.

	* localdb.c:
	(localdb_selection_team) The team participates in selection tour,
	  if it does not participate in the training tour.

	* prepare.c:
	(create_dirs) correctly handled situation, when checker ids are
	  not successive (if testers[i] == null, it is skipped).

2001-10-05  Alexander Chernov  <cher@ispras.ru>

	* makefile: new files added

	* html.c:
	(sformat_url) new function, which formats the URL template from
	  the configuration file;
	(do_write_kirov_standings) new global parameters `prob_info_url',
	  `team_info_url' are supported;
	(do_write_standings) the same as above.

	* prepare.c: new global parameters `team_info_url', `prob_info_url'.

	* prepare.h: new parameters `team_info_url' and `prob_info_url'.

	* make-teamdb-inet.c, send-passwords.c: compilation command changed

	* teamdb.c:
	(teamdb_get_plain_password) new function, which returns the password
	  from the database in the plain text.

	* teamdb.h: new function teamdb_get_plain_password.

	* .cvsignore: new files added

	* make-teamdb.c: compilation command fixed

	* make-teamdb-inet.c, make-teamdb.c, send-passwords.c, inetdb.c, inetdb.h, localdb.c, localdb.h:
	initial revision

	* idmap.c: compilation command fixed

	* idmap.h, idmap.c: initial revision

2001-06-16  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h: 1) added prototypes for os_readll, os_readull;
	2) added prototypes for reuse_strtoll, reuse_strtoull,
	   these are activated only if __REUSE_FORCE_STRTOLL macro
	   is set.

2001-05-19  Alexander Chernov  <cher@ispras.ru>

	* html.c: write_judge_allruns: new score textfield
	should not be shown not in KIROV mode

2001-05-14  Alexander Chernov  <cher@ispras.ru>

	* VERSION: boosted to 1.4

	* html.c: 1) new `write_judge_teams_view' to write to the client the
	information about all the registered teams;
	2) new `write_judge_one_team_view' to write to the client
	(detailed?) information about a particular team.

	* html.h: prototypes for new functions `write_judge_teams_view'
	and `write_judge_one_team_view' added.

	* makefile: added new `register' dependencies.

	* master.c: 1) added support for viewing and editing team information;
	2) new `add_team_if_asked' to generate NEWTEAM command to server,
	   if correspoding parameter is set;
	3) new `do_team_action_if_asked' to perform various team editing
	   actions (CHGNAME, CHGLOGIN, CHGPASSWD, CHGBAN, CHGVIS),
	   if correspoding parameters are set;
	4) new `view_one_team_if_asked' to send VTEAM command to server
	   and display the results;
	5) new `view_teams_if_asked' to sent MTEAMS or JTEAMS command
	   and display the received list of all the teams;
	6) new `print_teamview_button' to print `view teams' button.

	* prepare.c:
	new integer parameters `max_line_length', `max_file_length'
	to limit the length of line and the size of file to be inserted
	into run report generaten in `run' module.
	Default values are 4096 and 65535 bytes.

	* prepare.h:
	new integer parameters `max_line_length', `max_file_length'
	to limit the length of line and the size of file to be inserted
	into run report generaten in `run' module.

	* register.c:
	some code added (from master), but still not yet completed.

	* run.c: 1) new `print_by_line' to cut excessively long files and
	excessively long lines of program output streams;
	2) in `generate_report' all tested program output is passed
	through `print_by_line' function.

	* serve.c: 1) new judge's commands added:
	        MTEAMS          - view all the teams (master's mode);
	        JTEAMS          - view all the teams (judge's mode);
	        VTEAM           - view a particular team;
	        CHGLOGIN        - change the team's login;
	        CHGNAME         - change the team's name;
	        CHGBAN          - change the team's banned status;
	        CHGVIS          - change the team's visibility status;
	        CHGPASSWD       - change the team's password;
	        NEWTEAM         - add a new team;
	2) new function `judge_add_team' implements `NEWTEAM' command;
	3) new function `do_add_team' parses data passed by the master program
	   to prepare call of `teamdb_add_team';
	4) new function `judge_change_team_ban' implements `CHGBAN' command;
	5) new function `judge_change_team_vis' implements `CHGVIS' command;
	6) new `judge_change_team_password' implements `CHGPASSWD' command;
	7) new `judge_change_team_name' implements `CHGNAME' command;
	8) new `judge_change_team_login' implements `CHGLOGIN' command;
	9) new `judge_view_one_team' implements `VTEAM' command;
	10) new `judge_view_teams' implemets `MTEAMS' and `JTEAMS' commands;
	11) some rearrangements in error reporting code
	(report_bad_packet, report_error - new function).

	* teamdb.c: 1) transaction mode is supported for functions which update
	teamdb base. In transaction mode previous state of base
	is saved, so undo operation is possible. Transaction mode
	is entered by calling `teamdb_transaction'. Function
	`teamdb_rollback' rolls back the changes, function
	`teamdb_commit' leaves transaction mode with all changes
	performed;
	2) new function `teamdb_add_team' to add new team to database.
	The function performs all the necessary range checkings;
	3) new function `teamdb_toggle_vis' toggles visibility
	flag from normal to TEAM_INVISIBLE and back;
	4) new function `teamdb_toggle_ban' toggles availability flag
	from normal to TEAM_BANNED and back;
	5) new function `teamdb_change_login' changes login field for
	the given team;
	6) new function `teamdb_change_name' changes name field for
	the given team;
	7) new function `teamdb_is_valid_login' checks that the given
	string does not contain characters, invalid for team login;
	8) new function `teamdb_is_valid_name' checks that the given
	string may be team's name (does not contain invalid chars);
	9) new function `teamdb_get_total_teams' returns the total number
	of registered teams;
	10) new function `teamdb_write_teamdb' saves teamdb file to disk.

	* teamdb.h: new functions prototypes: teamdb_write_teamdb,
	teamdb_get_total_teams, teamdb_is_valid_login, teamdb_is_valid_name,
	teamdb_change_login, teamdb_change_name, teamdb_toggle_ban,
	teamdb_toggle_vis, teamdb_transaction, teamdb_commit, teamdb_rollback,
	teamdb_add_team.

2001-05-13  Alexander Chernov  <cher@ispras.ru>

	* TODO: put reference to html/index.html instead of previous content.

2001-05-09  Alexander Chernov  <cher@ispras.ru>

	* parsecfg.c: '%' and ';' made comment characters

2001-05-07  Alexander Chernov  <cher@ispras.ru>

	* makefile: basic compilation rules for `register' added.

2001-05-06  Alexander Chernov  <cher@ispras.ru>

	* register.c: initial revision

2001-05-02  Alexander Chernov  <cher@ispras.ru>

	* VERSION: boosted to 1.3

	* team.c, master.c:
	fixed charset passing to `client_not_configured': before `global'
	is initialized we cannot use it, so pass NULL.

	* html.c:
	1) write_team_statistics: information about scores gained for runs
	   is now showed in run statistics (only in KIROV scoring system);
	2) do_write_kirov_standings updated to use `score' field of run
	   database (scores gained for the run not counting penalties);
	3) write_judge_allruns: information about scores gained for runs
	   is now showed in run statistics (only in KIROV scoring system);
	4) write_team_source_view: run_get_record now has one more parameter.

	* run.c: 1) `struct testinfo' has two more fields: score, max_score;
	2) generate_report accepts two more parameters:
	   scores: score gained for this run, max_score: full score for this
	   problem;
	3) run report is extended both for judges and teams: it includes
	   information about scores gained for each test and for the run as
	   the whole (only in KIROV scoring system);
	4) generate_team_report accepts two more parameters:
	   scores, max_score (see above);
	5) run report packed now has three parameters instead of 2:
	   gained score included, so it is calculated in run_tests;
	6) ntests and tscores fields are filled up during initalization
	   for each problem;
	7) implemeted parsing of test_score_list and some sanity checking.

	* serve.c:
	1) updated calls to `run_change_status': new parameter newscore
	   passed as -1 where it is not relevant;
	2) run result packet now has 3 parameters instead of 2:
	   gained score is passed (used only in KIROV scoring system);
	   function `read_run_packet' updated accordingly;
	3) updated calls to `run_get_record': new parameter pscore passed
	   as NULL;
	4) `CHGSTAT' master judge command now has 4 parameters instead of 3:
	   new score is passed (used only in KIROV scoring system);
	   function `judge_change_status' is updated.

	* prepare.h: 1) new [problem] section parameter: test_score_list;
	2) added private (non-configurable) fields to
	   `struct section_problem_data':
	   ntests  - number of tests;
	   tscores - array of scores for tests.

	* prepare.c: 1) new parameter in [problem] section: test_score_list;
	2) start_cmd is concatenated with script_dir only if
	start_cmd is defined for the [tester] section;

	* master.c: 1) change_status_if_asked: support to change run score
	(if specified), applicable only to KIROV score system;
	2) command `CHGSTAT' now has 4 parameters (new parameter `score');
	3) view_report_if_asked: corrected header;

	* runlog.c:
	1) implemented function run_get_attempts, that return the number
	of attepts to solve the same problem by the same team before
	the given runid. The current implementation is dumb: it scans
	all the previous runs, it should be fixed;
	2) run_get_record accept one more parameter: pointer to variable
	to fill with score gained for this run (used only in KIROV
	score system). The pointer might be NULL, in this case nothing
	happens;
	3) run_change_status accept one more parameter: newscore: score
	for the run;
	4) record and header length increased to 99 to accomodate new
	field;
	5) new field is stored in the table: score for run, this parameter
	used in KIROV score system only, though; `struct run_entry',
	function `run_read_entry', function `run_make_record' updated
	accordingly.

	* runlog.h:
	1) run_change_status got one more parameter: score for the run;
	2) run_get_record got one more parameter: pointer to fill with score
	   for the run;
	3) new function run_get_attempts(int runid, int *pattempts)
	   this function returns the number of attempts to solve
	   the same problem by the same team, as given runid;

2001-04-28  Alexander Chernov  <cher@ispras.ru>

	* serve.c:
	fixed: judge_update_public_standings did not respond to the client,
	so it hung

	* mkpasswd.c: added option to generate tex password report

2001-04-20  Alexander Chernov  <cher@ispras.ru>

	* master.c, serve.c:
	added support for master's UPDATE command: force update
	of public standings

2001-03-31  Alexander Chernov  <cher@ispras.ru>

	* makefile: tweaks...

	* master.c: new configuration parameter conf_dir added
	partially.

	* prepare.c: bugs fixed

	* run.c: uninitialized local variable bug fixed

	* team.c: references to problems and standings are shown when
	the contest is started

	* prepare.c: Preprocessor is invoked with cpp command

	* team.c: 1) removed previously commented stuff;
	2) implemented "View Source" and "View Report";
	3) added 'charset' configuration parameter;
	4) all html headers now use this parameter.

	* serve.c: added two team commands: SOURCE, REPORT.
	added support for "KIROV" score system.

	* runlog.c, runlog.h: added RUN_PARTIAL run result.

	* run.c: 1) added support for "KIROV" score system;
	2) added support for generation of team_log;

	* prepare.h, prepare.c: new parameters:
	global:
	  team_enable_src_view
	  team_enable_rep_view
	  charset
	  team_report_archive_dir
	  run_team_report_dir
	problem:
	  team_enable_rep_view
	  full_score
	  test_score
	  run_penalty
	tester:
	  run_team_report_dir

	* master.c: 1) added 'charset' configuration parameter;
	2) all generated html headers use this parameter;
	3) removed old commented out stuff;

	* html.h: added write_team_source_view, write_team_report_view

	* html.c: 1) added "View source" and "View report" options to
	team's page, this depends on config parameters;
	2) added support for "KIROV" score system;
	3) implemeted write_team_source_view;
	4) implemeted write_team_report_view;

	* clntutil.h: charset argument added to cgi_read.

	* clntutil.c: 1) removed previously commented stuff;
	2) added charset parameter where html headers are printed;
	3) charset parameter is added to some functions.

	* cgi.h: charset argument added to cgi_read.

	* cgi.c: 1) removed previously commented stuff;
	2) added charset parameter where html headers are printed;
	3) charset parameter is added to some functions.

2001-03-25  Alexander Chernov  <cher@ispras.ru>

	* unix/unix_fileutl.h, unix/osdeps.c, unix/logger.c, unix/fileutl.c, unix/exec.c, win32/osdeps.c, win32/logger.c, win32/fileutl.c, win32/exec.c, xalloc.h, xalloc.c, version.h, teamdb.h, runlog.h, parsecfg.h, osdeps.h, misctext.h, logger.h, html.h, fileutl.h, exec.h, clntutil.h, clarlog.h, cgi.h, base64.h:
	copyright notice updated

	* makefile: 1) -D_GNU_SOURCE added for Linux;
	2) copyright notice updated.

	* clntutil.c: asprintf usage fixed

	* run.c: tTask added to c-types

	* team.c, submit.c, serve.c, runlog.c, run.c, pathutl.c, parsecfg.c, mkpasswd.c, misctext.c, master.c, html.c, compile.c, clntutil.c, clarlog.c:
	copyright notice updated

	* revinfo.c: copyright notice updated

	* prepare.h, prepare.c: 1) added global score_system parameter;
	2) copyright notice updated.

	* clar.c, cgi.c, base64.c, pathutl.h: copyright notice updated

	* teamdb.c: copyright notice updated

2000-11-05  Alexander Chernov  <cher@ispras.ru>

	* makefile 1.12: removal of revinfo added to clean rule

	* TODO 6.2: .

	* makefile 1.11: added rule force

	* prepare.h 1.9, revinfo.c 1.2, run.c 1.9, runlog.c 1.3, runlog.h 1.2, serve.c 1.10, submit.c 1.6, team.c 1.6, teamdb.c 1.6, teamdb.h 1.5, version.h 1.2, base64.c 1.3, base64.h 1.2, cgi.c 1.6, cgi.h 1.3, clar.c 1.4, clarlog.c 1.5, clarlog.h 1.4, clntutil.c 1.7, clntutil.h 1.5, compile.c 1.9, html.c 1.7, html.h 1.7, master.c 1.9, misctext.c 1.2, misctext.h 1.2, mkpasswd.c 1.4, parsecfg.c 1.5, parsecfg.h 1.5, prepare.c 1.11:
	copying conditions changed: LGPL -> GPL

	* clntutil.c 1.6:
	Copyright notice added at the bottom of the generated html page.

	* makefile 1.10: added version number tracking

	* COPYING.GPL 1.1: New file.

	* .cvsignore 6.2: x

	* TODO 6.1: new todo

	* VERSION 1.1, revinfo.c 1.1, version.h 1.1: New file.

2000-11-04  Alexander Chernov  <cher@ispras.ru>

	* makefile 1.9: dependencies regenerated;
	some other changes;

	* team.c 1.5: 1) new configuration parameters;
	2) write_log(...) is replaced with err(...) or info(...);
	3) other changes.

	* submit.c 1.5: 1) added preprocessor-related options (-D, -E);
	2) other changes.

	* run.c 1.8: many changes.

	* master.c 1.8, serve.c 1.9: many changes

	* compile.c 1.8: 1) some documentation added;
	2) write_log(...) is replaced with err(...) or info(...);
	3) added preprocessor-related (-E, -D) options;
	4) MAX_LANGUAGE is replaced with max_lang;
	5) some more changes.

	* clar.c 1.3: 1) preprocessor-related options added (-E -D);
	2) message-related functions from misctext.h
	   are used;
	3) some more changes.

	* clntutil.c 1.5:
	1) const removed from the first param of client_transaction function;
	2) sf_* function used to do checked syscalls.

	* clntutil.h 1.4:
	const removed from the first param of client_transaction function;

	* clarlog.c 1.4:
	1) write_log(...) is replaced with err(...) or info(...);
	2) macro ERR_R introduced to further simplify error reporting;
	3) sf_* read/write functions used to do checked i/o;

	* runlog.c 1.2: 1) sf_* functions from unix/fileutl are used to do
	   checked i/o;
	2) write_log(...) is replaced with err(...) or info(...) calls.

	* teamdb.c 1.5: write_log(...) is replaced with err or info calls;

	* html.c 1.6:
	1) write_log(...) mostly replaced with calls of info and err;
	2) sf_fopen function implemented to do checked fopen;
	3) many configuration parameters renamed due to changes
	   in prepare.[ch];
	4) old write_standings is split into write_standings and
	   do_write_standings, the latter is used in write_judge_standings;
	5) implemented write_judge_source_view;
	6) implemented write_judge_report_view;
	7) implemented write_judge_standings.

	* html.h 1.6: added prototypes for write_judge_source_view,
	write_judge_report_view, write_judge_standings.

	* pathutl.h 1.6: added prototypes for err and info.

	* pathutl.c 1.5:
	1) pathmake2 does not alter the path, if it starts from "./";
	2) added functions err and info;
	3) added outlined implementation of path_add_dir and path_init.

	* parsecfg.c 1.4: implemented reading from the gived file descriptor

	* parsecfg.h 1.4: added new param to function parse_param
	to read from the given FILE.

	* prepare.c 1.10: 1) many parameter names changed;
	2) new parameters added;
	3) added support for preprocessing of configuration file;
	4) other changes (don't remember which...);

	* prepare.h 1.8:
	too many changes to list, most notably, the configuration
	params names changed.

2000-11-03  Alexander Chernov  <cher@ispras.ru>

	* fileutl.h 1.7:
	added prototypes for check_executable, check_readable_dir,
	  check_writable_dir, check_writable_spool, relaxed_remove.

	* osdeps.h 6.13: 1) copyright notice updated;
	2) added proto for os_ErrorMsg;
	3) char * -> const char * for many functions.

	* logger.h 6.5: 1) copyright notice updated;
	2) char * -> const char * for write_log, vwrite_log.

	* exec.h 6.8: 1) copyright notice updated;
	2) added prototypes for task_ErrorCode, task_GetRunningTime.

	* cgi.c 1.5: 1) MAX_VALUE_SIZE increased to 128K;
	2) added function documentation.

	* base64.c 1.2: 1) added function descriptions;
	2) write_log(0, LOG_ERR ...) is replaced with err;
	3) added include for pathutl to import err();
	4) removed previously commented out debugging stuff.

2000-10-30  Alexander Chernov  <cher@ispras.ru>

	* .cvsignore 6.1: initial revision

2000-10-25  Alexander Chernov  <cher@ispras.ru>

	* master.c 1.7, team.c 1.4: 1) macro GLOBAL_PARAM is used;
	2) certain configuration parameters are renamed;
	3) initialization rewritten using path_init and path_add_dir.

	* prepare.c 1.9:
	macros GLOBAL_PARAM, PROBLEM_PARAM, LANGUAGE_PARAM, CHECKER_PARAM
	are used.

	* pathutl.h 1.5: added functions path_add_dir and path_init.

	* run.c 1.7: added support for correct answer files

	* prepare.c 1.8: directory permissions fixed for checker->exe_dir.

	* master.c 1.6: added parameter standings_url;

	* makefile 1.8: added misctext

	* html.h 1.5: prototype of write_standings changed.

	* html.c 1.5: 1) added include for misctext.h;
	2) contestlog is renamed to runlog;
	3) dur2str moved to misctext under the name duration_str;
	4) status2str moved to runlog under run_status_str;
	5) write_runs_table removed;
	6) html_armored_*, html_armor_* moved to misctext;
	7) clar_flags_to_str moved to clar under the name clar_flags_str;
	8) write_clars_table removed;

	* clntutil.h 1.3: removed prototype of client_duration_to_str.

	* clntutil.c 1.4: 1) added include directive for "misctext.h";
	2) no-cache option is added to header;
	3) client_duration_to_str moved to misctext under the name
	duration_str;

	* serve.c 1.8: 1) removed outdated "theory of operation";
	2) contestlog.h renamed to runlog.h;
	3) added include directive for misctext.h;
	4) two standings are generated: judge's and public;
	5) log_ prefix systematically replaced with run_ prefix;
	6) get_quoted_message_size moved to misctext.h under
	the name message_quoted_size;
	7) quote_message moved to misctext.h under the name
	message_quote;
	8) make_reply_subj moved to misctext.h under the name
	message_reply_subj;
	9) process_judge_reply is updated to work with new
	functions with slightly changed API;
	10) RUNSTAT, GETSTAT, CLARSTAT, CLARSTAT2 commands are
	removed.

	* z.cfg 6.7: moved to conf/server.cfg

2000-10-24  Alexander Chernov  <cher@ispras.ru>

	* clarlog.h 1.3: added proto for clar_flags_html.

	* clarlog.c 1.3: 1) CLAR_RECORD_SIZE increased to 79;
	2) implemented function clar_flags_html.

	* cgi.c 1.4: added include of cgi.h

	* contestlog.c 1.5, contestlog.h 1.5: renamed to runlog

	* TODO 1.4: most items are done.

	* misctext.c 1.1, misctext.h 1.1, runlog.c 1.1, runlog.h 1.1: New file.

2000-10-20  Alexander Chernov  <cher@ispras.ru>

	* z.cfg 6.6: corrections

	* html.h 1.4: added proto for write_judge_allstat.

	* team.c 1.3: added quick navigation with anchors

	* serve.c 1.7: 1) standings are updated more correctly;
	2) server supports JSTAT and MSTAT commands;
	3) server now sleeps for global.serve_sleep time.

	* run.c 1.6: 1) checkers are now stored in checks array;
	2) program return code can be read from a file;
	3) some new configuration parameters;

	* prepare.h 1.7: new parameters

	* prepare.c 1.7: 1) new parameters;
	2) all checkers are collected in checks table;

	* mkpasswd.c 1.3: more verbose printing of generated passwords.

	* master.c 1.5: changed navigation

	* html.c 1.4: 1) fixed bugs in standings calculation;
	2) implemented new scheme of judge status reporting.

	* fileutl.h 1.6: added prototype for make_writable.

	* exec.h 6.7: added prototype for task_Kill.

	* compile.c 1.7: added support for language specific spool directories

	* clntutil.h 1.2, clntutil.c 1.3: 1) added function client_split;
	2) added support for quick navigation (with anchors).

2000-10-18  Alexander Chernov  <cher@ispras.ru>

	* serve.c 1.6:
	prepare and create_dirs take extra argument: initialization mode

	* z.cfg 6.5: added language bc

	* submit.c 1.4, run.c 1.5:
	prepare and create_dirs take extra argument: initialization mode

	* prepare.h 1.6, prepare.c 1.6:
	added three initialization modes: PREPARE_SERVE,
	PREPARE_COMPILE, PREPARE_RUN.

	* pathutl.h 1.4: added proto of pathmake4

	* pathutl.c 1.4: added implementation of pathmake4

	* osdeps.h 6.12: fixed prototype of os_rGetBasename

	* makefile 1.7: fixes for win32

	* compile.c 1.6: 1) prepare() takes extra argument: prepare mode;
	2) create_dirs() is called with mode PREPARE_COMPILE.

	* clar.c 1.2: prepare() takes extra argument: prepare mode

2000-10-17  Alexander Chernov  <cher@ispras.ru>

	* z.cfg 6.4: *** empty log message ***

	* xalloc.h 6.5: added XALLOCA macro

	* teamdb.h 1.4: added definitions of TEAM_INVISIBLE and TEAM_BANNED

	* teamdb.c 1.4:
	implemented support for team flags (invisible and banned)

	* team.c 1.2: 1) added check that team is banned;
	2) corrections in client_put_header usage.

	* serve.c 1.5: 1) added update of standings file;
	2) maximal number of runs and clars for a team
	is checked;
	3) original message is quoted when replied by a judge;
	4) rejudge run option implemented.

	* run.c 1.4: 1) memory leak plugged;
	2) output files not attached to report if their size > 64K

	* prepare.h 1.5, prepare.c 1.5: new parameters

	* mkpasswd.c 1.2: added ability to change a team's password

	* master.c 1.4: 1) corrections in usage of client_put_header;
	2) added "YES" and "NO" buttons to judge's reply dialog.

	* html.h 1.3, html.c 1.3: implemented write_standings

	* contestlog.h 1.4: log_get_total_size rewritten as log_get_team_usage.

	* contestlog.c 1.4: 1) problem and language swapped in log_add_record;
	2) log_get_total_size rewritten as log_get_team_usage;
	3) log_get_times checks for null pointers before write to them.

	* clntutil.c 1.2: corrections is client_put_header usage

	* clarlog.h 1.2, clarlog.c 1.2:
	clar_get_from_size rewritten as clar_get_team_usage

	* TODO 1.3: progress...

	* z.cfg 6.3: changes

	* teamdb.h 1.3, teamdb.c 1.3: actually implemented

	* submit.c 1.3: added new IP-address parameter to SUBMIT directive.

	* serve.c 1.4: mostly implemented

	* run.c 1.3: 1) added initial configuration checking;
	2) bug fixes.

	* prepare.h 1.4, prepare.c 1.4: new configuration parameters

	* osdeps.h 6.11:
	added os_rDirName, os_GetWorkingDir, os_rGetWorkingDir,
	os_IsAbsolutePath.

	* master.c 1.3: 1) some stuff moved to clntutil;
	2) added reading of configuration file;
	3) added support for sending messages.

	* makefile 1.6: progress...

	* html.h 1.2, html.c 1.2: massive additions

	* fileutl.h 1.5: added permission bits to make_dir, make_all_dir

	* exec.h 6.6: added support for time-limited execution

	* contestlog.h 1.3: added IP-address

	* contestlog.c 1.3: added ip address to the record

	* compile.c 1.5: added initial configuration checking to spot
	nonexisting scripts, etc

	* cgi.c 1.3: added handling of multipart/form-data

	* TODO 1.2: progress...

	* team.c 1.1, clar.c 1.1, mkpasswd.c 1.1, clarlog.c 1.1, clarlog.h 1.1, base64.c 1.1, base64.h 1.1, clntutil.h 1.1, clntutil.c 1.1:
	New file.

2000-10-11  Alexander Chernov  <cher@ispras.ru>

	* teamdb.c 1.2, teamdb.h 1.2: added teamdb_get_login, teamdb_get_name

	* serve.c 1.3: in progress... interaction with judge client
	mostly implemented

	* run.c 1.2: major progress. still not tested though

	* prepare.c 1.3, prepare.h 1.3: new parameters

	* master.c 1.2: mostly implemented

	* makefile 1.5: added rules for master executable

	* fileutl.h 1.4: added PIPE flag

	* contestlog.c 1.2: many new functions;
	format of header and records changed;
	record size increased to 64 bytes

	* contestlog.h 1.2:
	many new functions; format of header and records changed

	* cgi.c 1.2: implemented cgi_nparam and cgi_nname

	* cgi.h 1.2: added prototypes for cgi_nparam and cgi_nname

	* z.cfg 6.2: added mandatory parameter checker.check_cmd.

	* html.h 1.1, html.c 1.1, TODO 1.1: New file.

2000-10-10  Alexander Chernov  <cher@ispras.ru>

	* master.c 1.1, cgi.h 1.1, cgi.c 1.1: New file.

	* submit.c 1.2: changes according to changes in fileutl module.

	* serve.c 1.2: in progress

	* prepare.h 1.2, prepare.c 1.2: lots of new parameters

	* pathutl.h 1.3: added proto for pathmake3 and chop.

	* pathutl.c 1.3: implemented functions pathmake3 and chop.

	* parsecfg.h 1.3: quiet_flag parameter added to function parse_param.

	* parsecfg.c 1.3: lots of new options

	* osdeps.h 6.10: 1) os_GetBasename_r renamed to os_rGetBasename;
	2) added proto for os_GetWorkingDir;
	3) added proto for os_rGetWorkingDir;
	4) added proto for os_IsAbsolutePath.

	* makefile 1.4: new utility "run" added

	* logger.h 6.4: prototype for logger_set_level added;

	* fileutl.h 1.3: major rewritings

	* exec.h 6.5: added platform-independent file open flags and
	file open modes.

	* compile.c 1.4: changes due to changes in fileutl (generic_*_file)
	and in osdeps.

	* run.c 1.1: New file.

2000-10-07  Alexander Chernov  <cher@ispras.ru>

	* r.cfg 6.2: Removed

	* t.cfg 1.2: Removed.

	* contestlog.c 1.1, teamdb.h 1.1, teamdb.c 1.1, submit.c 1.1, serve.c 1.1, prepare.h 1.1, prepare.c 1.1, contestlog.h 1.1:
	New file.

	* pathutl.h 1.2, pathutl.c 1.2: pathmake2 function added

	* parsecfg.h 1.2, parsecfg.c 1.2: enhanced

	* osdeps.h 6.9: os_GetBasename_r function added

	* makefile 1.3: in progress

	* fileutl.h 1.2: lots of functions added

	* compile.c 1.3: massive rewritings

	* z.cfg 6.1: initial revision

2000-10-03  Alexander Chernov  <cher@ispras.ru>

	* compile.c 1.2: Fixed bug in pathmake call.

	* r.cfg 6.1: New file.

	* makefile 1.2: Added dependencies for .o files;
	fixed compilation flags for win32.

2000-10-01  Alexander Chernov  <cher@ispras.ru>

	* xalloc.c 6.6: REUSE fancy stuff ("lconfig.h", "reuse/..." includes)
	is used only if __REUSE__ symbol defined.

	* exec.h 6.4: added function task_SetWorkingDir

	* osdeps.h 6.8: added function os_Sleep.

	* logger.h 6.3: 1) added proto of function logger_init_ex;
	2) removed old prototypes of fd_printf, etc.

	* pathutl.h 1.1, pathutl.c 1.1, t.cfg 1.1, parsecfg.h 1.1, parsecfg.c 1.1, fileutl.h 1.1, compile.c 1.1:
	initial revision

	* makefile 1.1: New file.

1999-08-30  Alexander Chernov  <cher@ispras.ru>

	* xalloc.c 6.5: "reuse_version.h" is included using CONF_DEPFILE macro.

1999-08-16  Alexander Chernov  <cher@ispras.ru>

	* exec.h 6.3, logger.h 6.2, osdeps.h 6.7, xalloc.c 6.4, xalloc.h 6.4:
	Copyright notice added (GNU LGPL).

	* COPYING.LGPL 6.1: *** empty log message ***

1999-08-04  Alexander Chernov  <cher@ispras.ru>

	* xalloc.h 6.3: XOFFSET, XDEREF, XPDEREF macros added.

1999-07-30  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h 6.6:
	prototypes for os_AttachFILE, os_snprintf, os_vsnprintf added.

1999-07-24  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h 6.5: REUSE_F_OK constant added

	* osdeps.h 6.4:   os_CheckAccess.

1999-06-02  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h 6.3: added functions get_PRJ_HOME_name, get_PRJ_HOME,
	get_PRJ_CONFIG_name, get_PRJ_CONFIG

1999-05-31  Alexander Chernov  <cher@ispras.ru>

	* logger.h 6.1: copyright notice updated;
	merged with the UniCad's version of the file.

	* xalloc.h 6.2, xalloc.c 6.3:
	 const    xstrmerge*

	* osdeps.h 6.2, xalloc.c 6.2, xalloc.h 6.1: copyright notice updated;
	merged with the UniCad's version of the file.

	* exec.h 6.2: copyright notice updated;
	protection against c++ added

1999-05-30  Alexander Chernov  <cher@ispras.ru>

	* osdeps.h 6.1, exec.h 6.1: tabulation converted to spaces

	* xalloc.c 6.1:     .

	* exec.h 6.0, logger.h 6.0, osdeps.h 6.0, xalloc.h 6.0, xalloc.c 6.0:
	New file.

END

	$Id$
