<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
<meta http-equiv="Content-type" content="text/html; charset=<s:config name="charset" />"/>
<script type="text/javascript" src="<s:config name="style-prefix" />dojo/dojo.js" djConfig="isDebug: false, parseOnLoad: true, dojoIframeHistoryUrl:'<s:config name="style-prefix" />dojo/resources/iframe_history.html'"></script>
<script type="text/javascript" src="<s:config name="style-prefix" />unpriv.js"></script>
<script type="text/javascript">
  var SID="<s:v value="phr->session_id" />";
  var NEW_SRV_ACTION_JSON_USER_STATE=<s:ac ac="json-user-state" />;
  var NEW_SRV_ACTION_VIEW_PROBLEM_SUMMARY=<s:ac ac="view-problem-summary" />;
  var self_url="<s:v value="phr->self_url" escape="false" />";
  var script_name="<s:v value="phr->script_name" escape="false" />";
  dojo.require("dojo.parser");
<%
#if defined CONF_ENABLE_AJAX && CONF_ENABLE_AJAX
  if (cs && phr->user_id > 0) {
%>  var jsonState = <%
    do_json_user_state(out_f, extra->serve_state, phr->user_id, 0);
%>;
<% }
#endif
%>  var updateFailedMessage = "<s:tr>STATUS UPDATE FAILED!</s:tr>";
  var testingInProgressMessage = "<s:tr>TESTING IN PROGRESS...</s:tr>";
  var testingCompleted = "<s:tr>TESTING COMPLETED</s:tr>";
  var waitingTooLong = "<s:tr>REFRESH PAGE MANUALLY!</s:tr>";
</script>
<link rel="stylesheet" href="<s:config name="style-prefix" />unpriv.css" type="text/css"/>
<title><s:v value="title" escape="false" /></title></head>
<body<%
#if defined CONF_ENABLE_AJAX && CONF_ENABLE_AJAX
%> onload="startClock()"<%
#endif
%>><div id="container"><div id="l12">
<div class="main_phrase"><s:v value="title" escape="false" /></div>

<div class="user_actions">
<table class="menu"><tr><% unpriv_page_header_1(out_f, phr, cnts, extra, start_time, stop_time); %></tr></table>
</div>
<div class="white_empty_block">&nbsp;</div>
<div class="contest_actions">
<table class="menu"><tr><% unpriv_page_header_2(out_f, phr, cnts, extra, start_time, stop_time); %></tr></table>
</div>
</div>
<div id="l11"><img src="<s:config name="style-prefix" />logo.gif" alt="logo"/></div>
<div id="l13">
<% unpriv_page_header_4(out_f, phr, cnts, extra, start_time, stop_time); %>

<%
  run_get_times(cs->runlog_state, 0, &sched_time, &duration, 0, 0);
  if (duration > 0 && start_time && !stop_time
      && global->board_fog_time > 0)
    fog_start_time = start_time + duration - global->board_fog_time;
  if (fog_start_time < 0) fog_start_time = 0;
  if (!cs->global->disable_clars || !cs->global->disable_team_clars)
    unread_clars = serve_count_unread_clars(cs, phr->user_id, start_time);
%><div class=<%
  if (cs->clients_suspended) {
%>"server_status_off"<%
  } else if (unread_clars > 0) {
%>"server_status_alarm"<%
  } else {
%>"server_status_on"<%
  }
%> id="statusLine">
<div id="currentTime"><s:v value="brief_time(time_buf, sizeof(time_buf), cs->current_time)" escape="false" /></div><%
  if (unread_clars > 0) {
    fprintf(fout, _(" / <b>%d unread message(s)</b>"),
            unread_clars);
  }
%> / <b><%
  if (stop_time > 0) {
    if (duration > 0 && global->board_fog_time > 0
        && global->board_unfog_time > 0
        && cs->current_time < stop_time + global->board_unfog_time
        && !cs->standings_updated) {
%><s:tr>OVER (frozen)</s:tr><%
    } else {
%><s:tr>OVER</s:tr><%
    }
  } else if (start_time > 0) {
    if (fog_start_time > 0 && cs->current_time >= fog_start_time) {
      if (cnts->exam_mode) {
%><s:tr>EXAM IS RUNNING (frozen)</s:tr><%
      } else {
%><s:tr>RUNNING (frozen)</s:tr><%
      }
    } else {
      if (cnts->exam_mode) {
%>EXAM IS RUNNING<%
      } else {
%>RUNNING<%
      }
    }
  } else {
%>NOT STARTED<%
  }
%></b> / <b><%
  if (start_time > 0) {
    if (global->score_system == SCORE_OLYMPIAD && !global->is_virtual) {
      if (cs->accepting_mode) {
%><s:tr>accepting</s:tr><%
      } else if (!cs->testing_finished) {
%><s:tr>judging</s:tr><%
      } else {
%><s:tr>judged</s:tr><%
      }
%></b><%
    }
  }
%><%
  if (cs->upsolving_mode) {
%> / <b><s:tr>UPSOLVING</s:tr></b><%
  }
%><%
  if (cs->clients_suspended) {
%> / <b><font color="red"><s:tr>clients suspended</s:tr></font></b><%
  }
%><%
  if (start_time > 0) {
    if (cs->testing_suspended) {
%> / <b><font color="red"><s:tr>testing suspended</s:tr></font></b><%
    }
    if (cs->printing_suspended) {
%> / <b><font color="red"><s:tr>printing suspended</s:tr></font></b><%
    }
  }
%><%
  if (!global->is_virtual && start_time <= 0 && sched_time > 0) {
%> / <s:tr>Start at</s:tr>: <s:v value="brief_time(time_buf, sizeof(time_buf), sched_time)" escape="false" /><%
  }
%><%
  if (start_time > 0 && stop_time <= 0 && duration > 0) {
    duration_str(0, start_time + duration - cs->current_time, 0,
                 time_buf, 0);
%> / <s:tr>Remaining</s:tr>: <div id="remainingTime"><s:v value="time_buf" escape="false" /></div><%
  }
%><div id="reloadButton" style="visibility: <%
  if (global->disable_auto_refresh > 0) {
%>visible<%
  } else {
%>hidden<%
  }
%>">/ <a class="menu" onclick="reloadPage()"><b>[ <s:tr>REFRESH</s:tr> ]</b></a></div><div id="statusString" style="visibility: hidden"></div></div>
