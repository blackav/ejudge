/* === string pool === */

static const unsigned char csp_str0[51] = "\n<script language=\"javascript\">\n    var self_url=\'";
static const unsigned char csp_str1[17] = "\';\n    var SID=\'";
static const unsigned char csp_str2[27] = "\';\n</script>\n<ul>\n    <li>";
static const unsigned char csp_str3[15] = "</li>\n    <li>";
static const unsigned char csp_str4[11] = "</li>\n    ";
static const unsigned char csp_str5[14] = "\n        <li>";
static const unsigned char csp_str6[10] = "\n    <li>";
static const unsigned char csp_str7[15] = "</li>\n        ";
static const unsigned char csp_str8[18] = "\n            <li>";
static const unsigned char csp_str9[6] = "\n    ";
static const unsigned char csp_str10[19] = "</li>\n        <li>";
static const unsigned char csp_str11[23] = "\n        <li><a href=\'";
static const unsigned char csp_str12[19] = "\' target=\"_blank\">";
static const unsigned char csp_str13[10] = "</a>\n    ";
static const unsigned char csp_str14[45] = "</li>\n</ul>\n\n<hr /><a name=\"status\"></a><h2>";
static const unsigned char csp_str15[8] = "</h2>\n\n";
static const unsigned char csp_str16[14] = "\n\n<p><big><b>";
static const unsigned char csp_str17[17] = "</b></big></p>\n\n";
static const unsigned char csp_str18[13] = "\n<p><big><b>";
static const unsigned char csp_str19[16] = "</b></big></p>\n";
static const unsigned char csp_str20[3] = "\n\n";
static const unsigned char csp_str21[2] = "\n";
static const unsigned char csp_str22[3] = ": ";
static const unsigned char csp_str23[3] = ", ";
static const unsigned char csp_str24[8] = "\n<p><b>";
static const unsigned char csp_str25[29] = "</b></p>\n<table class=\"b1\">\n";
static const unsigned char csp_str26[21] = "\n<tr><td class=\"b1\">";
static const unsigned char csp_str27[21] = "</td><td class=\"b1\">";
static const unsigned char csp_str28[22] = "</td><td  class=\"b1\">";
static const unsigned char csp_str29[22] = "</td><td class=\"b1\">\n";
static const unsigned char csp_str30[9] = "\n&nbsp;\n";
static const unsigned char csp_str31[13] = "\n</td></tr>\n";
static const unsigned char csp_str32[11] = "\n</table>\n";
static const unsigned char csp_str33[29] = "\n<table border=\"0\">\n<tr><td>";
static const unsigned char csp_str34[11] = ":</td><td>";
static const unsigned char csp_str35[42] = "</td><td>&nbsp;</td><td>&nbsp;</td></tr>\n";
static const unsigned char csp_str36[25] = "\n<tr><td colspan=\"2\"><b>";
static const unsigned char csp_str37[29] = "</b></td><td>&nbsp;</td><td>";
static const unsigned char csp_str38[12] = "</td></tr>\n";
static const unsigned char csp_str39[10] = "\n<tr><td>";
static const unsigned char csp_str40[22] = "</td><td>&nbsp;</td>\n";
static const unsigned char csp_str41[6] = "\n<td>";
static const unsigned char csp_str42[12] = ":</td><td>\n";
static const unsigned char csp_str43[68] = "\n</td><td><input type=\"text\" name=\"sched_time\" size=\"16\"/></td><td>";
static const unsigned char csp_str44[7] = "</td>\n";
static const unsigned char csp_str45[56] = "\n<td><input type=\"text\" name=\"dur\" size=\"16\"/></td><td>";
static const unsigned char csp_str46[38] = "\n<td>&nbsp;</td><td>&nbsp;</td></tr>\n";
static const unsigned char csp_str47[85] = ":</td><td>&nbsp;</td><td><input type=\"text\" name=\"finish_time\" size=\"16\" /></td><td>";
static const unsigned char csp_str48[69] = "</td><td><input type=\"text\" name=\"finish_time\" size=\"16\" /></td><td>";
static const unsigned char csp_str49[10] = "</td><td>";
static const unsigned char csp_str50[20] = "</td></tr>\n<tr><td>";
static const unsigned char csp_str51[20] = "</td></tr>\n</table>";
static const unsigned char csp_str52[11] = "\n\n<hr />\n\n";
static const unsigned char csp_str53[16] = "</b></td></tr>\n";
static const unsigned char csp_str54[32] = "\n<hr/><a name=\"submit\"></a><h2>";
static const unsigned char csp_str55[7] = "</h2>\n";
static const unsigned char csp_str56[18] = "\n<table>\n<tr><td>";
static const unsigned char csp_str57[35] = ":</td><td><select name=\"problem\">\n";
static const unsigned char csp_str58[17] = "\n<option value=\'";
static const unsigned char csp_str59[3] = "\'>";
static const unsigned char csp_str60[4] = " - ";
static const unsigned char csp_str61[11] = "</option>\n";
static const unsigned char csp_str62[20] = "\n</select></td><td>";
static const unsigned char csp_str63[19] = "</td></tr></table>";
static const unsigned char csp_str64[34] = "\n<hr /><a name=\"submit\"></a>\n<h2>";
static const unsigned char csp_str65[2] = " ";
static const unsigned char csp_str66[2] = "-";
static const unsigned char csp_str67[3] = " (";
static const unsigned char csp_str68[8] = ")</h2>\n";
static const unsigned char csp_str69[45] = "\n<input type=\"hidden\" name=\"problem\" value=\'";
static const unsigned char csp_str70[6] = "\' />\n";
static const unsigned char csp_str71[2] = "_";
static const unsigned char csp_str72[10] = "\n<table>\n";
static const unsigned char csp_str73[53] = ":</td><td>\n<select name=\"lang_id\"><option value=\"\">\n";
static const unsigned char csp_str74[22] = "\n</select></td></tr>\n";
static const unsigned char csp_str75[193] = "\n<tr><td>EOLN Type:</td><td><select name=\"eoln_type\">\n<option value=\"0\"></option>\n<option value=\"1\">LF (Unix/MacOS)</option>\n<option value=\"2\">CRLF (Windows/DOS)</option>\n</select></td></tr>\n\n";
static const unsigned char csp_str76[53] = "</td><td><input type=\"file\" name=\"file\"/></td></tr>\n";
static const unsigned char csp_str77[53] = "</td><td><input type=\"text\" name=\"file\"/></td></tr>\n";
static const unsigned char csp_str78[86] = "\n<tr><td colspan=\"2\"><textarea name=\"file\" rows=\"20\" cols=\"60\"></textarea></td></tr>\n";
static const unsigned char csp_str79[49] = "</td><td><input type=\"radio\" name=\"file\" value=\'";
static const unsigned char csp_str80[13] = "\'/></td><td>";
static const unsigned char csp_str81[43] = "</td><td><input type=\"checkbox\" name=\'ans_";
static const unsigned char csp_str82[14] = "\' /></td><td>";
static const unsigned char csp_str83[14] = "%s</td></tr>\n";
static const unsigned char csp_str84[39] = "\n     \n<hr/><a name=\"submit\"></a>\n<h2>";
static const unsigned char csp_str85[34] = "</td><td><select name=\"problem\">\n";
static const unsigned char csp_str86[27] = "</td></tr></table></form>\n";
static const unsigned char csp_str87[12] = "\n<hr /><h2>";
static const unsigned char csp_str88[79] = ":</td><td><input type=\"text\" size=\"16\" name=\"msg_dest_id\"/></td></tr>\n<tr><td>";
static const unsigned char csp_str89[82] = ":</td><td><input type=\"text\" size=\"32\" name=\"msg_dest_login\"/></td></tr>\n<tr><td>";
static const unsigned char csp_str90[68] = ":</td><td><input type=\"text\" size=\"64\" name=\"msg_subj\"/></td></tr>\n";
static const unsigned char csp_str91[118] = "</td><td><select name=\"msg_hide_flag\"><option value=\"0\">NO</option><option value=\"1\">YES</option></select></td></tr>\n";
static const unsigned char csp_str92[79] = "\n</table>\n<p><textarea name=\"msg_text\" rows=\"20\" cols=\"60\"></textarea></p>\n<p>";
static const unsigned char csp_str93[5] = "</p>";
static const unsigned char csp_str94[37] = "\n\n<hr/><a name=\"chgpasswd\"></a>\n<h2>";
static const unsigned char csp_str95[81] = ":</td><td><input type=\"password\" name=\"oldpasswd\" size=\"16\"/></td></tr>\n<tr><td>";
static const unsigned char csp_str96[82] = ":</td><td><input type=\"password\" name=\"newpasswd1\" size=\"16\"/></td></tr>\n<tr><td>";
static const unsigned char csp_str97[94] = ":</td><td><input type=\"password\" name=\"newpasswd2\" size=\"16\"/></td></tr>\n<tr><td colspan=\"2\">";
static const unsigned char csp_str98[34] = "\n\n<hr /><a name=\"chglanguage\" /><";
static const unsigned char csp_str99[2] = ">";
static const unsigned char csp_str100[3] = "</";
static const unsigned char csp_str101[4] = ">\n\n";
static const unsigned char csp_str102[17] = "\n<table><tr><td>";
static const unsigned char csp_str103[11] = "</td><td>\n";
static const unsigned char csp_str104[11] = "\n</td><td>";
static const unsigned char csp_str105[25] = "\n\n<div class=\"dotted\"><p";
static const unsigned char csp_str106[13] = "</p></div>\n\n";


#line 2 "priv_main_page.csp"
/* $Id$ */
#include "new-server.h"
#include "contests.h"
#include "prepare.h"
#include "mischtml.h"
#include "misctext.h"
#include "l10n.h"
#include "xml_utils.h"
#include "runlog.h"
#include "external_action.h"

#include "reuse/xalloc.h"

#include <stdio.h>

#include <libintl.h>
#define _(x) gettext(x)

int csp_view_priv_main_page(PageInterface *pg, FILE *log_f, FILE *out_f, struct http_request_info *phr);

static PageInterfaceOps priv_main_page_ops =
{
    NULL, // destroy
    NULL, // execute
    csp_view_priv_main_page, // render
};

static PageInterface priv_main_page_iface =
{
    &priv_main_page_ops,
};

PageInterface *
csp_get_priv_main_page(void)
{
    return &priv_main_page_iface;
}
int csp_view_priv_main_page(PageInterface *pg, FILE *log_f, FILE *out_f, struct http_request_info *phr)
{

#line 43 "priv_main_page.csp"
const struct contest_desc *cnts = phr->cnts;
  struct contest_extra *extra = phr->extra;
  int need_examiners = 0;
  time_t start_time = 0;
  time_t stop_time = 0;
  time_t sched_time = 0;
  time_t fog_start_time = 0;
  time_t finish_time = 0;
  serve_state_t cs = extra->serve_state;
  struct section_global_data *global = cs->global;
  time_t duration = 0;
  const unsigned char *s;
  int online_users = 0;
  int i;
  struct last_access_info *pa;
  int job_count = 0;
  unsigned char duration_buf[64];
  time_t tmpt = 0;
  int action = 0;
  int filter_first_run = 0, filter_last_run = 0, filter_mode_clar = 0;
  int filter_first_run_set = 0, filter_last_run_set = 0;
  const unsigned char *filter_expr = 0;
  const struct section_problem_data *prob = 0;
  int x;
  struct html_armor_buffer ab = HTML_ARMOR_INITIALIZER;
  int variant = 0;
  int skip_start_form = 0;
  int y, n;
  const unsigned char *filter_first_clar_str = 0;
  const unsigned char *filter_last_clar_str = 0;
  long long tdiff = 0;
  unsigned char hbuf[1024];
  struct server_framework_job *job;
  time_t server_start_time = nsf_get_server_start_time(phr->fw_state);

#line 78 "priv_main_page.csp"
if (ns_cgi_param(phr, "filter_expr", &s) > 0) filter_expr = s;

  ns_cgi_param_int_opt_2(phr, "filter_first_run", &filter_first_run, &filter_first_run_set);
  ns_cgi_param_int_opt_2(phr, "filter_last_run", &filter_last_run, &filter_last_run_set);

  if (ns_cgi_param(phr, "filter_first_clar", &s) > 0 && s)
    filter_first_clar_str = s;
  if (ns_cgi_param(phr, "filter_last_clar", &s) > 0 && s)
    filter_last_clar_str = s;
  if (ns_cgi_param(phr, "filter_mode_clar", &s) > 0
      && sscanf(s, "%d%n", &x, &n) == 1 && !s[n] && x >= 1 && x <= 2)
    filter_mode_clar = x;
  if (ns_cgi_param(phr, "problem", &s) > 0) {
    if (sscanf(s, "%d_%d%n", &x, &y, &n) == 2 && !s[n]
        && x > 0 && x <= cs->max_prob && cs->probs[x]
        && cs->probs[x]->variant_num > 0 && y > 0
        && y <= cs->probs[x]->variant_num) {
      prob = cs->probs[x];
      variant = y;
    } else if (sscanf(s, "%d%n", &x, &n) == 1 && !s[n]
               && x > 0 && x <= cs->max_prob && cs->probs[x]
               && cs->probs[x]->variant_num <= 0) {
      prob = cs->probs[x];
    }
  }

  run_get_times(cs->runlog_state, &start_time, &sched_time, &duration,
                &stop_time, &finish_time);
  if (duration > 0 && start_time && !stop_time && global->board_fog_time > 0)
    fog_start_time = start_time + duration - global->board_fog_time;
  if (fog_start_time < 0) fog_start_time = 0;

  for (i = 1; i <= cs->max_prob; i++)
    if (cs->probs[i] && cs->probs[i]->manual_checking)
      need_examiners = 1;

  ns_header(out_f, extra->header_txt, 0, 0, 0, 0, phr->locale_id, cnts,
            phr->client_key,
            "%s [%s, %d, %s]: %s", ns_unparse_role(phr->role),
            phr->name_arm, phr->contest_id, extra->contest_arm, _("Main page"));
fwrite(csp_str0, 1, 50, out_f);
fputs((phr->self_url), out_f);
fwrite(csp_str1, 1, 16, out_f);
fprintf(out_f, "%016llx", (phr->session_id));
fwrite(csp_str2, 1, 26, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_USERS, 0), out_f);
fputs(_("View regular users"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_PRIV_USERS_VIEW, 0), out_f);
fputs(_("View privileged users"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_ONLINE_USERS, 0), out_f);
fputs(_("View who is currently online"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_EXAM_INFO, 0), out_f);
fputs(_("View examination information"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 128 "priv_main_page.csp"
if (need_examiners) {
fwrite(csp_str5, 1, 13, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_EXAMINERS_PAGE, 0), out_f);
fputs(_("Examiners assignments"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 130 "priv_main_page.csp"
}
fwrite(csp_str6, 1, 9, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_STANDINGS, 0), out_f);
fputs(_("View standings"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 132 "priv_main_page.csp"
if (phr->role >= USER_ROLE_JUDGE && opcaps_check(phr->caps, OPCAP_EDIT_PASSWD) >= 0) {
fwrite(csp_str5, 1, 13, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_REG_PWDS, 0), out_f);
fputs(_("View registration passwords"), out_f);
fputs("</a>", out_f);
fwrite(csp_str7, 1, 14, out_f);

#line 134 "priv_main_page.csp"
if (!cnts->disable_team_password) {
fwrite(csp_str8, 1, 17, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_CNTS_PWDS, 0), out_f);
fputs(_("View contest passwords"), out_f);
fputs("</a>", out_f);
fwrite(csp_str7, 1, 14, out_f);

#line 136 "priv_main_page.csp"
}
fwrite(csp_str9, 1, 5, out_f);

#line 137 "priv_main_page.csp"
}
fwrite(csp_str9, 1, 5, out_f);

#line 138 "priv_main_page.csp"
if (phr->role >= USER_ROLE_JUDGE && opcaps_check(phr->caps, OPCAP_DUMP_USERS) >= 0) {
fwrite(csp_str5, 1, 13, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_USER_DUMP, 0), out_f);
fputs(_("Dump users in CSV format"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 140 "priv_main_page.csp"
}
fwrite(csp_str9, 1, 5, out_f);

#line 141 "priv_main_page.csp"
if (phr->role >= USER_ROLE_JUDGE && opcaps_check(phr->caps, OPCAP_DUMP_RUNS) >= 0) {
fwrite(csp_str5, 1, 13, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_RUNS_DUMP, 0), out_f);
fputs(_("Dump runs in CSV format"), out_f);
fputs("</a>", out_f);
fwrite(csp_str10, 1, 18, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_EXPORT_XML_RUNS, 0), out_f);
fputs(_("Export runs in XML external format"), out_f);
fputs("</a>", out_f);
fwrite(csp_str10, 1, 18, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_WRITE_XML_RUNS, 0), out_f);
fputs(_("Write runs in XML internal format"), out_f);
fputs("</a>", out_f);
fwrite(csp_str10, 1, 18, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_WRITE_XML_RUNS_WITH_SRC, 0), out_f);
fputs(_("Write runs in XML internal format with source"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 146 "priv_main_page.csp"
}
fwrite(csp_str6, 1, 9, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_ASSIGN_CYPHERS_1, 0), out_f);
fputs(_("Assign random cyphers"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_IP_USERS, 0), out_f);
fputs(_("View users for IP addresses"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_USER_IPS, 0), out_f);
fputs(_("View IP addresses for users"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_VIEW_TESTING_QUEUE, 0), out_f);
fputs(_("View testing queue"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 151 "priv_main_page.csp"
if (phr->role >= USER_ROLE_ADMIN) {
fwrite(csp_str5, 1, 13, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_ADMIN_CONTEST_SETTINGS, 0), out_f);
fputs(_("Contest settings"), out_f);
fputs("</a>", out_f);
fwrite(csp_str4, 1, 10, out_f);

#line 153 "priv_main_page.csp"
}
fwrite(csp_str9, 1, 5, out_f);

#line 154 "priv_main_page.csp"
if (cnts->problems_url) {
fwrite(csp_str11, 1, 22, out_f);
fputs((cnts->problems_url), out_f);
fwrite(csp_str12, 1, 18, out_f);
fputs(_("Problems"), out_f);
fwrite(csp_str13, 1, 9, out_f);

#line 156 "priv_main_page.csp"
}
fwrite(csp_str6, 1, 9, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_PRIV_SUBMIT_PAGE, 0), out_f);
fputs(_("Submit a solution"), out_f);
fputs("</a>", out_f);
fwrite(csp_str3, 1, 14, out_f);
fputs(ns_aref(hbuf, sizeof(hbuf), phr, NEW_SRV_ACTION_LOGOUT, 0), out_f);
fputs(_("Logout"), out_f);
fputs("</a>", out_f);
fwrite(csp_str14, 1, 44, out_f);
fputs(_("Server status"), out_f);
fwrite(csp_str15, 1, 7, out_f);

#line 163 "priv_main_page.csp"
if (stop_time > 0 && !global->is_virtual) {
    if (duration > 0 && global->board_fog_time > 0
        && global->board_unfog_time > 0
        && cs->current_time < stop_time + global->board_unfog_time
        && !cs->standings_updated) {
      s = _("The contest is over (standings are frozen)");
    } else {
      s = _("The contest is over");
    }
  } else if (start_time > 0) {
    if (fog_start_time > 0 && cs->current_time >= fog_start_time)
      s = _("The contest is in progress (standings are frozen)");
    else
      s = _("The contest is in progress");
  } else {
    s = _("The contest is not started");
  }
fwrite(csp_str16, 1, 13, out_f);
fputs((s), out_f);
fwrite(csp_str17, 1, 16, out_f);

#line 184 "priv_main_page.csp"
if (global->score_system == SCORE_OLYMPIAD && !global->is_virtual) {
    if (cs->accepting_mode)
      s = _("Participants' solutions are being accepted");
    else if (!cs->testing_finished)
      s = _("Participants' solutions are being judged");
    else
      s = _("Participants' solutions are judged");
fwrite(csp_str18, 1, 12, out_f);
fputs((s), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 193 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 195 "priv_main_page.csp"
if (cs->upsolving_mode) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Upsolving mode"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 197 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 199 "priv_main_page.csp"
if (cs->clients_suspended) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Participants\' requests are suspended"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 201 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 203 "priv_main_page.csp"
if (cs->testing_suspended) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Testing of participants\' submits is suspended"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 205 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 206 "priv_main_page.csp"
if (cs->printing_suspended) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Print requests are suspended"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 208 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 209 "priv_main_page.csp"
if (cs->online_view_source < 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Source code is closed"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 211 "priv_main_page.csp"
} else if (cs->online_view_source > 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Source code is open"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 213 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 214 "priv_main_page.csp"
if (cs->online_view_report < 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Testing reports are closed"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 216 "priv_main_page.csp"
} else if (cs->online_view_report > 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Testing reports are open"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 218 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 219 "priv_main_page.csp"
if (cs->online_view_judge_score > 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Judge scores are opened"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 221 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 222 "priv_main_page.csp"
if (cs->online_final_visibility > 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Final visibility rules are active"), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 224 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 227 "priv_main_page.csp"
// count online users
  online_users = 0;
  for (i = 0; i < extra->user_access[USER_ROLE_CONTESTANT].u; i++) {
    pa = &extra->user_access[USER_ROLE_CONTESTANT].v[i];
    if (pa->time + 65 >= cs->current_time) online_users++;
  }
fwrite(csp_str18, 1, 12, out_f);
fputs(_("On-line users in this contest"), out_f);
fwrite(csp_str22, 1, 2, out_f);
fprintf(out_f, "%d", (int)(online_users));
fwrite(csp_str19, 1, 15, out_f);

#line 235 "priv_main_page.csp"
if (cs->max_online_count > 0) {
fwrite(csp_str18, 1, 12, out_f);
fputs(_("Max number of users was"), out_f);
fwrite(csp_str22, 1, 2, out_f);
fprintf(out_f, "%d", (int)(cs->max_online_count));
fwrite(csp_str23, 1, 2, out_f);
fputs(xml_unparse_date((cs->max_online_time)), out_f);
fwrite(csp_str19, 1, 15, out_f);

#line 237 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 239 "priv_main_page.csp"
if (job_count > 0) {
fwrite(csp_str24, 1, 7, out_f);
fputs(_("Background jobs"), out_f);
fwrite(csp_str22, 1, 2, out_f);
fprintf(out_f, "%d", (int)(job_count));
fwrite(csp_str25, 1, 28, out_f);

#line 242 "priv_main_page.csp"
for (job = nsf_get_first_job(phr->fw_state); job; job = job->next) {
fwrite(csp_str26, 1, 20, out_f);
fprintf(out_f, "%d", (int)(job->id));
fwrite(csp_str27, 1, 20, out_f);
fputs(xml_unparse_date((job->start_time)), out_f);
fwrite(csp_str28, 1, 21, out_f);
fputs((job->title), out_f);
fwrite(csp_str29, 1, 21, out_f);

#line 244 "priv_main_page.csp"
if (job->vt->get_status) {
        unsigned char *str = job->vt->get_status(job);
        if (str && *str) {
fwrite(csp_str21, 1, 1, out_f);
fputs((s), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 248 "priv_main_page.csp"
} else {
fwrite(csp_str30, 1, 8, out_f);

#line 250 "priv_main_page.csp"
}
        xfree(str);
      } else {
fwrite(csp_str30, 1, 8, out_f);

#line 254 "priv_main_page.csp"
}
fwrite(csp_str31, 1, 12, out_f);

#line 256 "priv_main_page.csp"
}
fwrite(csp_str32, 1, 10, out_f);

#line 258 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 260 "priv_main_page.csp"
if (phr->role == USER_ROLE_ADMIN && opcaps_check(phr->caps, OPCAP_CONTROL_CONTEST) >= 0) {
fwrite(csp_str21, 1, 1, out_f);
fputs("<form method=\"post\" enctype=\"application/x-www-form-urlencoded\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str33, 1, 28, out_f);
fputs(_("Server time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((cs->current_time)), out_f);
fwrite(csp_str35, 1, 41, out_f);

#line 264 "priv_main_page.csp"
if (start_time <= 0) {
fwrite(csp_str36, 1, 24, out_f);
fputs(_("Contest is not started"), out_f);
fwrite(csp_str37, 1, 28, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_START_CONTEST, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 266 "priv_main_page.csp"
} else {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Contest start time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((start_time)), out_f);
fwrite(csp_str40, 1, 21, out_f);

#line 268 "priv_main_page.csp"
if (stop_time <= 0) {
fwrite(csp_str41, 1, 5, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_STOP_CONTEST, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 270 "priv_main_page.csp"
} else if (global->enable_continue
                 && (!duration || stop_time < start_time + duration)) {
fwrite(csp_str41, 1, 5, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CONTINUE_CONTEST, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 273 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 274 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 276 "priv_main_page.csp"
if (!global->is_virtual && start_time <= 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Planned start time"), out_f);
fwrite(csp_str42, 1, 11, out_f);

#line 278 "priv_main_page.csp"
if (sched_time <= 0) {
fputs(_("Not set"), out_f);

#line 278 "priv_main_page.csp"
} else {
fputs(xml_unparse_date((sched_time)), out_f);

#line 278 "priv_main_page.csp"
}
fwrite(csp_str43, 1, 67, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_SCHEDULE, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 280 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 283 "priv_main_page.csp"
if (finish_time <= 0) {
      if (duration > 0) {
        duration_str(0, duration, 0, duration_buf, 0);
      } else {
        snprintf(duration_buf, sizeof(duration_buf), "%s", _("Unlimited"));
      }
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Duration"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str44, 1, 6, out_f);

#line 291 "priv_main_page.csp"
if ((stop_time <= 0 || global->enable_continue) && !global->is_virtual) {
fwrite(csp_str45, 1, 55, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CHANGE_DURATION, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 293 "priv_main_page.csp"
} else {
fwrite(csp_str46, 1, 37, out_f);

#line 295 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 297 "priv_main_page.csp"
if (duration <= 0 && (stop_time <= 0 || global->enable_continue)
          && !global->is_virtual) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Finish time"), out_f);
fwrite(csp_str47, 1, 84, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CHANGE_FINISH_TIME, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 300 "priv_main_page.csp"
}
    }
fwrite(csp_str20, 1, 2, out_f);

#line 304 "priv_main_page.csp"
if (!global->is_virtual) {
      if (start_time > 0 && stop_time <= 0 && duration > 0) {
        tmpt = start_time + duration;
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Scheduled end time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((tmpt)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 308 "priv_main_page.csp"
} else if (start_time > 0 && stop_time <= 0 && duration <= 0
                 && finish_time > 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Scheduled end time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((finish_time)), out_f);
fwrite(csp_str48, 1, 68, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CHANGE_FINISH_TIME, NULL), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 311 "priv_main_page.csp"
} else if (stop_time) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("End time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((stop_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 313 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 314 "priv_main_page.csp"
if (start_time > 0 && stop_time <= 0 && fog_start_time > 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Standings freeze time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((fog_start_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 316 "priv_main_page.csp"
} else if (stop_time > 0 && duration > 0 && global->board_fog_time > 0
                 && global->board_unfog_time > 0 && !cs->standings_updated
                 && cs->current_time < stop_time + global->board_unfog_time) {
        tmpt = stop_time + global->board_unfog_time;
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Standings unfreeze time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((tmpt)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 321 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 323 "priv_main_page.csp"
if (start_time > 0 && stop_time <= 0 && duration > 0) {
        duration_str(0, cs->current_time, start_time, duration_buf, 0);
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Elapsed time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 326 "priv_main_page.csp"
duration_str(0, start_time + duration - cs->current_time, 0,
                     duration_buf, 0);
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Remaining time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 330 "priv_main_page.csp"
}
    }
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Contest load time"), out_f);
fwrite(csp_str49, 1, 9, out_f);
fputs(xml_unparse_date((cs->load_time)), out_f);
fwrite(csp_str50, 1, 19, out_f);
fputs(_("Server start time"), out_f);
fwrite(csp_str49, 1, 9, out_f);
fputs(xml_unparse_date((server_start_time)), out_f);
fwrite(csp_str51, 1, 19, out_f);
fputs("</form>", out_f);
fwrite(csp_str52, 1, 10, out_f);
fputs("<form method=\"post\" enctype=\"application/x-www-form-urlencoded\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_UPDATE_STANDINGS_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_RESET_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 341 "priv_main_page.csp"
action = NEW_SRV_ACTION_SUSPEND;
    if (cs->clients_suspended) action = NEW_SRV_ACTION_RESUME;
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, (action), NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 344 "priv_main_page.csp"
action = NEW_SRV_ACTION_TEST_SUSPEND;
    if (cs->testing_suspended) action = NEW_SRV_ACTION_TEST_RESUME;
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, (action), NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 348 "priv_main_page.csp"
if (global->enable_printing) {
      action = NEW_SRV_ACTION_PRINT_SUSPEND;
      if (cs->printing_suspended) action = NEW_SRV_ACTION_PRINT_RESUME;
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, (action), NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 352 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 353 "priv_main_page.csp"
if (global->score_system == SCORE_OLYMPIAD && !global->is_virtual) {
      action = NEW_SRV_ACTION_SET_JUDGING_MODE;
      if (!cs->accepting_mode) action = NEW_SRV_ACTION_SET_ACCEPTING_MODE;
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, (action), NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 357 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 358 "priv_main_page.csp"
if (global->score_system == SCORE_OLYMPIAD
        && ((!global->is_virtual && !cs->accepting_mode)
            || (global->is_virtual && global->disable_virtual_auto_judge >0))) {
      action = NEW_SRV_ACTION_SET_TESTING_FINISHED_FLAG;
      if (cs->testing_finished)
        action = NEW_SRV_ACTION_CLEAR_TESTING_FINISHED_FLAG;
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, (action), NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 365 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 366 "priv_main_page.csp"
if (!cnts->disable_team_password) {
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_GENERATE_PASSWORDS_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CLEAR_PASSWORDS_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 369 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_GENERATE_REG_PASSWORDS_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_UPSOLVING_CONFIG_1, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_RELOAD_SERVER, NULL), out_f);
fwrite(csp_str21, 1, 1, out_f);
fputs("</form>", out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 374 "priv_main_page.csp"
} else {
fwrite(csp_str33, 1, 28, out_f);
fputs(_("Server time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((cs->current_time)), out_f);
fwrite(csp_str35, 1, 41, out_f);

#line 377 "priv_main_page.csp"
if (start_time <= 0) {
fwrite(csp_str36, 1, 24, out_f);
fputs(_("Contest is not started"), out_f);
fwrite(csp_str53, 1, 15, out_f);

#line 379 "priv_main_page.csp"
} else {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Contest start time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((start_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 381 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 383 "priv_main_page.csp"
if (!global->is_virtual && start_time <= 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Planned start time"), out_f);
fwrite(csp_str42, 1, 11, out_f);

#line 385 "priv_main_page.csp"
if (sched_time <= 0) {
fputs(_("Not set"), out_f);

#line 385 "priv_main_page.csp"
} else {
fputs(xml_unparse_date((sched_time)), out_f);

#line 385 "priv_main_page.csp"
}
fwrite(csp_str31, 1, 12, out_f);

#line 387 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 389 "priv_main_page.csp"
if (finish_time <= 0) {
      if (duration > 0) {
        duration_str(0, duration, 0, duration_buf, 0);
      } else {
        snprintf(duration_buf, sizeof(duration_buf), "%s", _("Unlimited"));
      }
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Duration"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 397 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 399 "priv_main_page.csp"
if (!global->is_virtual) {
      if (start_time > 0 && stop_time <= 0 && duration > 0) {
        tmpt = start_time + duration;
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Scheduled end time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((tmpt)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 403 "priv_main_page.csp"
} else if (start_time > 0 && stop_time <= 0 && duration <= 0
                 && finish_time > 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Scheduled end time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((finish_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 406 "priv_main_page.csp"
} else if (stop_time) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("End time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((stop_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 408 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 410 "priv_main_page.csp"
if (start_time > 0 && stop_time <= 0 && fog_start_time > 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Standings freeze time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((fog_start_time)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 412 "priv_main_page.csp"
} else if (stop_time > 0 && duration > 0 && global->board_fog_time > 0
                 && global->board_unfog_time > 0 && !cs->standings_updated
                 && cs->current_time < stop_time + global->board_unfog_time) {
        tmpt = stop_time + global->board_unfog_time;
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Standings unfreeze time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs(xml_unparse_date((tmpt)), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 417 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 419 "priv_main_page.csp"
if (start_time > 0 && stop_time <= 0 && duration > 0) {
        duration_str(0, cs->current_time, start_time, duration_buf, 0);
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Elapsed time"), out_f);
fwrite(csp_str34, 1, 10, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 422 "priv_main_page.csp"
duration_str(0, start_time + duration - cs->current_time, 0,
                     duration_buf, 0);
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Remaining time"), out_f);
fwrite(csp_str49, 1, 9, out_f);
fputs((duration_buf), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 425 "priv_main_page.csp"
}
    }
fwrite(csp_str32, 1, 10, out_f);

#line 428 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 430 "priv_main_page.csp"
ns_write_priv_all_runs(out_f, phr, cnts, extra,
                         filter_first_run_set, filter_first_run,
                         filter_last_run_set, filter_last_run,
                         filter_expr);
fwrite(csp_str20, 1, 2, out_f);

#line 436 "priv_main_page.csp"
if (opcaps_check(phr->caps, OPCAP_SUBMIT_RUN) >= 0) {
    if (!prob) {
      // no problem is selected yet
fwrite(csp_str54, 1, 31, out_f);
fputs(_("View the problem statement and send a submission"), out_f);
fwrite(csp_str55, 1, 6, out_f);
fputs("<form method=\"get\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str56, 1, 17, out_f);
fputs(_("Problem"), out_f);
fwrite(csp_str57, 1, 34, out_f);

#line 444 "priv_main_page.csp"
for (x = 1; x <= cs->max_prob; x++) {
        if (!(prob = cs->probs[x])) continue;
fwrite(csp_str58, 1, 16, out_f);
fprintf(out_f, "%d", (int)(x));
fwrite(csp_str59, 1, 2, out_f);
fputs((prob->short_name), out_f);
fwrite(csp_str60, 1, 3, out_f);
fputs(html_armor_buf(&ab, (prob->long_name)), out_f);
fwrite(csp_str61, 1, 10, out_f);

#line 447 "priv_main_page.csp"
}
fwrite(csp_str62, 1, 19, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_PRIV_SUBMIT_PAGE, _("Select problem")), out_f);
fwrite(csp_str63, 1, 18, out_f);
fputs("</form>", out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 450 "priv_main_page.csp"
prob = 0;
    } else {
      // a problem is already selected
      // prob and variant have correct values
      if (variant > 0) {
fwrite(csp_str64, 1, 33, out_f);
fputs(_("Submit a solution for"), out_f);
fwrite(csp_str65, 1, 1, out_f);
fputs((prob->short_name), out_f);
fwrite(csp_str66, 1, 1, out_f);
fputs(html_armor_buf(&ab, (prob->long_name)), out_f);
fwrite(csp_str67, 1, 2, out_f);
fputs(_("Variant"), out_f);
fwrite(csp_str65, 1, 1, out_f);
fprintf(out_f, "%d", (int)(variant));
fwrite(csp_str68, 1, 7, out_f);

#line 458 "priv_main_page.csp"
} else {
fwrite(csp_str64, 1, 33, out_f);
fputs(_("Submit a solution for"), out_f);
fwrite(csp_str65, 1, 1, out_f);
fputs((prob->short_name), out_f);
fwrite(csp_str66, 1, 1, out_f);
fputs(html_armor_buf(&ab, (prob->long_name)), out_f);
fwrite(csp_str55, 1, 6, out_f);

#line 461 "priv_main_page.csp"
}
fwrite(csp_str20, 1, 2, out_f);

#line 463 "priv_main_page.csp"
if (!skip_start_form) {
fwrite(csp_str21, 1, 1, out_f);
fputs("<form method=\"post\" enctype=\"multipart/form-data\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 465 "priv_main_page.csp"
}
fwrite(csp_str21, 1, 1, out_f);

#line 466 "priv_main_page.csp"
if (variant <= 0) {
fwrite(csp_str69, 1, 44, out_f);
fprintf(out_f, "%d", (int)(prob->id));
fwrite(csp_str70, 1, 5, out_f);

#line 468 "priv_main_page.csp"
} else {
fwrite(csp_str69, 1, 44, out_f);
fprintf(out_f, "%d", (int)(prob->id));
fwrite(csp_str71, 1, 1, out_f);
fprintf(out_f, "%d", (int)(variant));
fwrite(csp_str70, 1, 5, out_f);

#line 470 "priv_main_page.csp"
}
fwrite(csp_str72, 1, 9, out_f);

#line 472 "priv_main_page.csp"
if (!prob->type) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Language"), out_f);
fwrite(csp_str73, 1, 52, out_f);

#line 475 "priv_main_page.csp"
for (i = 1; i <= cs->max_lang; i++) {
          if (!cs->langs[i]) continue;
fwrite(csp_str58, 1, 16, out_f);
fprintf(out_f, "%d", (int)(i));
fwrite(csp_str59, 1, 2, out_f);
fputs((cs->langs[i]->short_name), out_f);
fwrite(csp_str60, 1, 3, out_f);
fputs(html_armor_buf(&ab, (cs->langs[i]->long_name)), out_f);
fwrite(csp_str61, 1, 10, out_f);

#line 478 "priv_main_page.csp"
}
fwrite(csp_str74, 1, 21, out_f);

#line 480 "priv_main_page.csp"
if (global->enable_eoln_select > 0) {
fwrite(csp_str75, 1, 192, out_f);

#line 487 "priv_main_page.csp"
}
      }

      switch (prob->type) {
      case PROB_TYPE_STANDARD:
      case PROB_TYPE_OUTPUT_ONLY:
      case PROB_TYPE_TESTS:
fwrite(csp_str39, 1, 9, out_f);
fputs(_("File"), out_f);
fwrite(csp_str76, 1, 52, out_f);

#line 495 "priv_main_page.csp"
break;
      case PROB_TYPE_SHORT_ANSWER:
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Answer"), out_f);
fwrite(csp_str77, 1, 52, out_f);

#line 498 "priv_main_page.csp"
break;
      case PROB_TYPE_TEXT_ANSWER:
fwrite(csp_str78, 1, 85, out_f);

#line 501 "priv_main_page.csp"
break;
      case PROB_TYPE_SELECT_ONE:
        /* FIXME: handle problem XML */
        if (prob->alternative) {
          for (i = 0; prob->alternative[i]; i++) {
fwrite(csp_str39, 1, 9, out_f);
fprintf(out_f, "%d", (int)(i + 1));
fwrite(csp_str79, 1, 48, out_f);
fprintf(out_f, "%d", (int)(i + 1));
fwrite(csp_str80, 1, 12, out_f);
fputs((prob->alternative[i]), out_f);
fwrite(csp_str38, 1, 11, out_f);

#line 507 "priv_main_page.csp"
}
        }
        break;
      case PROB_TYPE_SELECT_MANY:
        if (prob->alternative) {
          for (i = 0; prob->alternative[i]; i++) {
fwrite(csp_str39, 1, 9, out_f);
fprintf(out_f, "%d", (int)(i + 1));
fwrite(csp_str81, 1, 42, out_f);
fprintf(out_f, "%d", (int)(i + 1));
fwrite(csp_str82, 1, 13, out_f);
fputs((prob->alternative[i]), out_f);
fwrite(csp_str83, 1, 13, out_f);

#line 514 "priv_main_page.csp"
}
        }
        break;
      case PROB_TYPE_CUSTOM:    /* form is a part of problem statement */
        break;
      }
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Send!"), out_f);
fwrite(csp_str49, 1, 9, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_SUBMIT_RUN, NULL), out_f);
fwrite(csp_str63, 1, 18, out_f);
fputs("</form>", out_f);
fwrite(csp_str84, 1, 38, out_f);
fputs(_("Select another problem"), out_f);
fwrite(csp_str55, 1, 6, out_f);
fputs("<form method=\"get\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str56, 1, 17, out_f);
fputs(_("Problem"), out_f);
fwrite(csp_str85, 1, 33, out_f);

#line 527 "priv_main_page.csp"
for (x = 1; x <= cs->max_prob; x++) {
        if (!(prob = cs->probs[x])) continue;
        if (prob->variant_num <= 0) {
fwrite(csp_str58, 1, 16, out_f);
fprintf(out_f, "%d", (int)(x));
fwrite(csp_str59, 1, 2, out_f);
fputs((prob->short_name), out_f);
fwrite(csp_str60, 1, 3, out_f);
fputs(html_armor_buf(&ab, (prob->long_name)), out_f);
fwrite(csp_str61, 1, 10, out_f);

#line 531 "priv_main_page.csp"
} else {
          for (y = 1; y <= prob->variant_num; y++) {
fwrite(csp_str58, 1, 16, out_f);
fprintf(out_f, "%d", (int)(x));
fwrite(csp_str71, 1, 1, out_f);
fprintf(out_f, "%d", (int)(y));
fwrite(csp_str59, 1, 2, out_f);
fputs((prob->short_name), out_f);
fwrite(csp_str60, 1, 3, out_f);
fputs(html_armor_buf(&ab, (prob->long_name)), out_f);
fwrite(csp_str23, 1, 2, out_f);
fputs(_("Variant"), out_f);
fwrite(csp_str65, 1, 1, out_f);
fprintf(out_f, "%d", (int)(y));
fwrite(csp_str61, 1, 10, out_f);

#line 534 "priv_main_page.csp"
}
        }
      }
fwrite(csp_str62, 1, 19, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_MAIN_PAGE, _("Select problem")), out_f);
fwrite(csp_str86, 1, 26, out_f);

#line 539 "priv_main_page.csp"
prob = 0;
    }
  }
fwrite(csp_str20, 1, 2, out_f);

#line 545 "priv_main_page.csp"
if (opcaps_check(phr->caps, OPCAP_VIEW_CLAR) >= 0) {
    ns_write_all_clars(out_f, phr, cnts, extra, filter_mode_clar,
                       filter_first_clar_str, filter_last_clar_str);
  }
fwrite(csp_str20, 1, 2, out_f);

#line 551 "priv_main_page.csp"
if (opcaps_check(phr->caps, OPCAP_NEW_MESSAGE) >= 0) {
fwrite(csp_str87, 1, 11, out_f);
fputs(_("Compose a message to all participants"), out_f);
fwrite(csp_str55, 1, 6, out_f);
fputs("<form method=\"post\" enctype=\"application/x-www-form-urlencoded\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str56, 1, 17, out_f);
fputs(_("To user id"), out_f);
fwrite(csp_str88, 1, 78, out_f);
fputs(_("To user login"), out_f);
fwrite(csp_str89, 1, 81, out_f);
fputs(_("Subject"), out_f);
fwrite(csp_str90, 1, 67, out_f);

#line 558 "priv_main_page.csp"
if (start_time <= 0) {
fwrite(csp_str39, 1, 9, out_f);
fputs(_("Do not show before the contest starts?"), out_f);
fwrite(csp_str91, 1, 117, out_f);

#line 560 "priv_main_page.csp"
}
fwrite(csp_str92, 1, 78, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_PRIV_SUBMIT_CLAR, NULL), out_f);
fwrite(csp_str93, 1, 4, out_f);
fputs("</form>", out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 564 "priv_main_page.csp"
}
fwrite(csp_str94, 1, 36, out_f);
fputs(_("Change password"), out_f);
fwrite(csp_str55, 1, 6, out_f);
fputs("<form method=\"post\" enctype=\"application/x-www-form-urlencoded\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str56, 1, 17, out_f);
fputs(_("Old password"), out_f);
fwrite(csp_str95, 1, 80, out_f);
fputs(_("New password"), out_f);
fwrite(csp_str96, 1, 81, out_f);
fputs(_("Retype new password"), out_f);
fwrite(csp_str97, 1, 93, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CHANGE_PASSWORD, NULL), out_f);
fwrite(csp_str51, 1, 19, out_f);
fputs("</form>", out_f);
fwrite(csp_str20, 1, 2, out_f);

#line 577 "priv_main_page.csp"
#if CONF_HAS_LIBINTL - 0 == 1
  if (cs->global->enable_l10n) {
fwrite(csp_str98, 1, 33, out_f);
fputs((cnts->team_head_style), out_f);
fwrite(csp_str99, 1, 1, out_f);
fputs(_("Change language"), out_f);
fwrite(csp_str100, 1, 2, out_f);
fputs((cnts->team_head_style), out_f);
fwrite(csp_str101, 1, 3, out_f);
fputs("<form method=\"post\" enctype=\"application/x-www-form-urlencoded\" action=\"", out_f);
fputs(phr->self_url, out_f);
fputs("\">", out_f);
fputs(phr->hidden_vars, out_f);
fwrite(csp_str102, 1, 16, out_f);
fputs(_("Change language"), out_f);
fwrite(csp_str103, 1, 10, out_f);

#line 585 "priv_main_page.csp"
l10n_html_locale_select(out_f, phr->locale_id);
fwrite(csp_str104, 1, 10, out_f);
fputs(ns_submit_button(hbuf, sizeof(hbuf), 0, NEW_SRV_ACTION_CHANGE_LANGUAGE, NULL), out_f);
fwrite(csp_str63, 1, 18, out_f);
fputs("</form>", out_f);
fwrite(csp_str21, 1, 1, out_f);

#line 588 "priv_main_page.csp"
}
#endif /* CONF_HAS_LIBINTL */
fwrite(csp_str20, 1, 2, out_f);

#line 593 "priv_main_page.csp"
gettimeofday(&phr->timestamp2, 0);
  tdiff = ((long long) phr->timestamp2.tv_sec) * 1000000;
  tdiff += phr->timestamp2.tv_usec;
  tdiff -= ((long long) phr->timestamp1.tv_sec) * 1000000;
  tdiff -= phr->timestamp1.tv_usec;
fwrite(csp_str105, 1, 24, out_f);
fputs((cnts->team_par_style), out_f);
fwrite(csp_str99, 1, 1, out_f);
fputs(_("Page generation time"), out_f);
fwrite(csp_str22, 1, 2, out_f);
fprintf(out_f, "%lld", (long long)(tdiff / 1000));
fwrite(csp_str65, 1, 1, out_f);
fputs(_("msec"), out_f);
fwrite(csp_str106, 1, 12, out_f);

#line 603 "priv_main_page.csp"
html_armor_free(&ab);
fwrite(csp_str21, 1, 1, out_f);
  return 0;
}
