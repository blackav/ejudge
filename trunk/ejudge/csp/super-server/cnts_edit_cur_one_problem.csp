<%
/* $Id$ */
%>

<!--
  unsigned char name_buf[1024];
  int i, sel_num;
  struct section_problem_data *prob, *sup_prob = 0;
  unsigned char *s, *ss, *checker_env;
  unsigned char prob_hidden_vars[4096];
  unsigned char *extra_msg = 0;
  struct section_problem_data *tmp_prob = 0;
  unsigned char msg_buf[1024];
  int flags, show_adv = 0, show_details = 0;;
  unsigned char num_buf[1024];
  struct section_global_data *global = sstate->global;
  unsigned char hbuf[1024];
  int row = 1, problem_type_flag = 0;
  struct html_armor_buffer ab = HTML_ARMOR_INITIALIZER;
-->

<%
  int show_details = 0, show_adv = 0;
  if ((flags & SID_STATE_SHOW_HIDDEN)) show_details = 1;
  if ((flags & SID_STATE_SHOW_CLOSED)) show_adv = 1;
  struct section_problem_data *tmp_prob = prepare_copy_problem(prob);
%>
<s:form>
    <s:hidden name="prob_id" check="false" />
    <tr bgcolor="#b0b0b0">
        <td colspan="2" align="center"><%
  if (is_abstract) {
%><s:v value="prob->short_name" /><%
  } else if (!prob->short_name[0]) {
%>Problem <s:v value="prob->id" /><%
  } else if (!prob->long_name[0]) {
%><s:v value="prob->short_name" /><%
  } else {
%><s:v value="prob->short_name" />: <s:v value="prob->long_name" /><%
  }
%></td>
        <td colspan="2"><%
  if (!show_details) {
%><s:submit ac="prob-show-details" label="Show details" /><%
  } else {
%><s:submit ac="prob-hide-details" label="Hide details" /><%
    if (!show_adv) {
%><s:submit ac="prob-show-advanced" label="Show advanced" /><%
    } else {
%><s:submit ac="prob-hide-advanced" label="Hide advanced" /><%
    }
  }
%><s:submit ac="prob-delete" label="Delete!" /></td>
    </tr>
</s:form>
<%
  if (show_details) {
    const struct section_problem_data *sup_prob = 0;
    int sup_id = 0;
    int j;
    if (!is_abstract && prob->super && prob->super[0]) {
      for (j = 0; j < phr->ss->aprob_u; ++j) {
        if (!strcmp(prob->super, phr->ss->aprobs[j]->short_name)) {
          sup_prob = phr->ss->aprobs[j];
          sup_id = j + 1;
          break;
        }
      }
    }
    row = 1;
    (void) sup_prob;
%><%
    if (!is_abstract) {
%>
<s:htr attr="form_row_attrs[row ^= 1]">
    <td>Problem ID:</td>
    <td><s:v value="prob->id" /></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
</s:htr>

<s:form>
    <s:hidden name="prob_id" check="false" />
    <s:htr attr="form_row_attrs[row ^= 1]">
        <td>Problem short name:</td>
        <td><s:textfield name="param" value="prob->short_name" size="48" maxlength="1024" check="no" /></td>
        <td><s:submit ac="prob-change-short-name" label="Change" /><s:submit ac="prob-clear-short-name" label="Clear" /></td>
        <td><s:help ac="prob-change-short-name" /></td>
    </s:htr>
</s:form>

<%
      if (show_adv) {
%>
<s:form>
    <s:hidden name="prob_id" check="false" />
    <s:htr attr="form_row_attrs[row ^= 1]">
        <td>Internal name:</td>
        <td><s:textfield name="param" value="prob->internal_name" size="48" maxlength="1024" check="no" /></td>
        <td><s:submit ac="prob-change-internal-name" label="Change" /><s:submit ac="prob-clear-internal-name" label="Clear" /></td>
        <td><s:help ac="prob-change-internal-name" /></td>
    </s:htr>
</s:form>
<%
      }
%>


<s:form>
    <s:hidden name="prob_id" check="false" />
    <s:htr attr="form_row_attrs[row ^= 1]">
        <td>Problem long name:</td>
        <td><s:textfield name="param" value="prob->long_name" size="48" maxlength="1024" check="no" /></td>
        <td><s:submit ac="prob-change-long-name" label="Change" /><s:submit ac="prob-clear-long-name" label="Clear" /></td>
        <td><s:help ac="prob-change-long-name" /></td>
    </s:htr>
</s:form>

<s:form>
    <s:hidden name="prob_id" check="false" />
    <s:htr attr="form_row_attrs[row ^= 1]">
        <td>Base abstract problem:</td>
        <td><select name="param"><option value="0"></option><%
    for (j = 0; j < phr->ss->aprob_u; ++j) {
%><s:option value="j + 1" selectedExpr="j + 1 == sup_id"><s:v value="phr->ss->aprobs[j]->short_name" /></s:option><%
    }
%></select></td>
        <td><s:submit ac="prob-change-super" label="Change" /></td>
        <td><s:help ac="prob-change-super" /></td>
    </s:htr>
</s:form>
<%
    } else {
%>
<s:htr attr="form_row_attrs[row ^= 1]">
    <td>Problem Name:</td>
    <td><s:v value="prob->short_name" /></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
</s:htr>
<%
    }
%>

<s:form>
    <s:hidden name="prob_id" check="false" />
    <s:htr attr="form_row_attrs[row ^= 1]">
        <td>Problem type:</td>
        <td><select name="param"><%
    if (is_abstract) {
%><%
    } else {
%>
<!--
  //PROBLEM_PARAM(type, "s")
  if (prob->type < -1 || prob->type >= PROB_TYPE_LAST)
    prob->type = -1;
  extra_msg = 0;
  problem_type_flag = prob->type;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_type, tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
             problem_unparse_type(tmp_prob->type));
    extra_msg = msg_buf;
    problem_type_flag = tmp_prob->type;
  } else {
    if (prob->type < 0) prob->type = 0;
  }
  if (problem_type_flag < 0) problem_type_flag = 0;
  fprintf(f, "<td>");
  fprintf(f, "<select name=\"param\">");
  if (!prob->abstract) {
    s = "";
    if (prob->type < 0) s = " selected=\"1\"";
    fprintf(f, "<option value=\"-1\"%s>Default</option>\n", s);
  }
  for (i = 0; i < PROB_TYPE_LAST; i++) {
    s = "";
    if (prob->type == i) s = " selected=\"1\"";
    fprintf(f, "<option value=\"%d\"%s>%s</option>\n",
            i, s, problem_unparse_type(i));
  }
  fprintf(f, "</select></td>");
-->
<%
    }
%></select></td>
        <td><s:submit ac="prob-change-type" label="Change" /></td>
        <td><s:help ac="prob-change-type" /></td>
    </s:htr>
</s:form>


<!--
  //PROBLEM_PARAM(stand_name, "s")
  if (!prob->abstract && show_adv) {
    print_string_editing_row(f, "Title for the standings column:",
                             prob->stand_name,
                             SSERV_CMD_PROB_CHANGE_STAND_NAME,
                             SSERV_CMD_PROB_CLEAR_STAND_NAME,
                             0,
                             session_id,
                             form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);
  }
  //PROBLEM_PARAM(stand_column, "s")
  if (!prob->abstract && show_adv) {
    print_string_editing_row(f, "Collate this problem with the specified one:",
                             prob->stand_column,
                             SSERV_CMD_PROB_CHANGE_STAND_COLUMN,
                             SSERV_CMD_PROB_CLEAR_STAND_COLUMN,
                             0,
                             session_id,
                             form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);
  }
  //PROBLEM_PARAM(manual_checking, "d")
  if ((prob->abstract && prob->type)
      || (!prob->abstract && tmp_prob->type > 0)) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_manual_checking,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->manual_checking?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Problem is checked manually",
                               prob->manual_checking,
                               SSERV_CMD_PROB_CHANGE_MANUAL_CHECKING,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(examinator_num, "d")
  if ((prob->abstract && prob->type)
      || (!prob->abstract && tmp_prob->type > 0)) {
    extra_msg = "";

    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_examinator_num,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
               tmp_prob->examinator_num);
      extra_msg = msg_buf;
    } else {
      if (prob->examinator_num < 0) prob->examinator_num = 0;
    }
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
            "Number of examinators:");
    fprintf(f, "<select name=\"param\">");
    s = "";
    if (prob->examinator_num == 0) s = " selected=\"1\"";
    ss = "Default";
    if (prob->abstract) ss = "0";
    fprintf(f, "<option value=\"0\"%s>%s</option>", s, ss);
    for (i = 1; i <= 3; i++) {
      s = "";
      if (i == prob->examinator_num) s = " selected=\"1\"";
      fprintf(f, "<option value=\"%d\"%s>%d</option>", i, s, i);
    }
    fprintf(f, "</select>%s</td><td>", extra_msg);
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_EXAMINATOR_NUM, "Change");
    fprintf(f, "</td>");
    print_help_url(f, SSERV_CMD_PROB_CHANGE_EXAMINATOR_NUM);
    fprintf(f, "</tr></form>\n");
  }

  //PROBLEM_PARAM(check_presentation, "d")
  if ((prob->abstract && prob->type > 0 && prob->manual_checking > 0)
      || (!prob->abstract && tmp_prob->type > 0
          && tmp_prob->manual_checking > 0)) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_check_presentation,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->check_presentation?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Check output presentation anyway?",
                               prob->check_presentation,
                               SSERV_CMD_PROB_CHANGE_CHECK_PRESENTATION,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(use_stdin, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_use_stdin,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->use_stdin?"Yes":"No");
    extra_msg = msg_buf;
  }
  if (!problem_type_flag) {
    print_boolean_3_select_row(f, "Use standard input", prob->use_stdin,
                               SSERV_CMD_PROB_CHANGE_USE_STDIN,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(input_file, "s"),
  extra_msg = 0;
  if (prob->abstract && !prob->use_stdin) extra_msg = "";
  if (!prob->abstract && !tmp_prob->use_stdin) {
    extra_msg = "";
    prepare_set_prob_value(CNTSPROB_input_file,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->input_file[0]) {
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->input_file));
      extra_msg = msg_buf;
    }
  }
  if (!problem_type_flag && extra_msg) {
    print_string_editing_row_2(f, "Input file name:", prob->input_file,
                               SSERV_CMD_PROB_CHANGE_INPUT_FILE,
                               SSERV_CMD_PROB_CLEAR_INPUT_FILE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
                               
  }

  //PROBLEM_PARAM(combined_stdin, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_combined_stdin,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->combined_stdin?"Yes":"No");
    extra_msg = msg_buf;
  }
  if (!problem_type_flag) {
    print_boolean_3_select_row(f, "Combined standard/file input", prob->combined_stdin,
                               SSERV_CMD_PROB_CHANGE_COMBINED_STDIN,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(use_stdout, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_use_stdout,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->use_stdout?"Yes":"No");
    extra_msg = msg_buf;
  }
  if (!problem_type_flag) {
    print_boolean_3_select_row(f, "Use standard output", prob->use_stdout,
                               SSERV_CMD_PROB_CHANGE_USE_STDOUT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(output_file, "s"),
  extra_msg = 0;
  if (prob->abstract && !prob->use_stdout) extra_msg = "";
  if (!prob->abstract && !tmp_prob->use_stdout) {
    extra_msg = "";
    prepare_set_prob_value(CNTSPROB_output_file,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->output_file[0]) {
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->output_file));
      extra_msg = msg_buf;
    }
  }
  if (!problem_type_flag && extra_msg) {
    print_string_editing_row_2(f, "Output file name:", prob->output_file,
                               SSERV_CMD_PROB_CHANGE_OUTPUT_FILE,
                               SSERV_CMD_PROB_CLEAR_OUTPUT_FILE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
                               
  }

  //PROBLEM_PARAM(combined_stdout, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_combined_stdout,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->combined_stdout?"Yes":"No");
    extra_msg = msg_buf;
  }
  if (!problem_type_flag) {
    print_boolean_3_select_row(f, "Combined standard/file output", prob->combined_stdout,
                               SSERV_CMD_PROB_CHANGE_COMBINED_STDOUT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(disable_stderr, "d"),
    extra_msg = "Undefined";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_stderr,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_stderr?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f,"Consider output to stderr as PE:",
                               prob->disable_stderr,
                               SSERV_CMD_PROB_CHANGE_DISABLE_STDERR,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(binary_input, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_binary_input,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->binary_input?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Input data is binary", prob->binary_input,
                               SSERV_CMD_PROB_CHANGE_BINARY_INPUT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv && tmp_prob->binary_input <= 0) {
    //PROBLEM_PARAM(normalization, "s"),
    msg_buf[0] = 0;
    if (prob->abstract > 0 && !prob->normalization[0]) {
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default)</i>");
    } else if (prob->abstract > 0) {
      // nothing
    } else if (prob->abstract <= 0 && !prob->normalization[0]) {
      if (!tmp_prob->normalization[0]) {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default)</i>");
      } else {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %s)</i>", ARMOR(tmp_prob->normalization));
      }
    }
    extra_msg = msg_buf;
    print_string_editing_row_3(f,
                               "Test normalization mode:",
                               prob->normalization,
                               SSERV_CMD_PROB_CHANGE_NORMALIZATION,
                               SSERV_CMD_PROB_CLEAR_NORMALIZATION,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(binary, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_binary,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->binary?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Submit is binary", prob->binary,
                               SSERV_CMD_PROB_CHANGE_BINARY,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(xml_file, "s"),
  extra_msg = 0;
  if (prob->abstract && !prob->xml_file[0]) extra_msg="<i>(Undefined)</i>";
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_xml_file,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->xml_file[0])
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->xml_file));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->xml_file));
    extra_msg = msg_buf;
  }
  print_string_editing_row_2(f, "XML File with problem statement:",
                             prob->xml_file,
                             SSERV_CMD_PROB_CHANGE_XML_FILE,
                             SSERV_CMD_PROB_CLEAR_XML_FILE,
                             extra_msg,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(alternatives_file, "s"),
  if (prob->abstract) i = prob->type;
  else i = tmp_prob->type;
  if (i == PROB_TYPE_SELECT_MANY || i == PROB_TYPE_SELECT_ONE) {
    extra_msg = 0;
    if (prob->abstract && !prob->alternatives_file[0])
      extra_msg="<i>(Undefined)</i>";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_alternatives_file,
                             tmp_prob, sup_prob, sstate->global);
      if (!prob->alternatives_file[0])
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
                 ARMOR(tmp_prob->alternatives_file));
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
                 ARMOR(tmp_prob->alternatives_file));
      extra_msg = msg_buf;
    }
    print_string_editing_row_2(f, "File with answer alternatives:",
                               prob->alternatives_file,
                               SSERV_CMD_PROB_CHANGE_ALTERNATIVES_FILE,
                               SSERV_CMD_PROB_CLEAR_ALTERNATIVES_FILE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(plugin_file, "s"),
  extra_msg = 0;
  if (prob->abstract && !prob->plugin_file[0])extra_msg="<i>(Undefined)</i>";
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_plugin_file,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->plugin_file[0])
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->plugin_file));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->plugin_file));
    extra_msg = msg_buf;
  }
  print_string_editing_row_2(f, "Problem handling plugin file:",
                             prob->plugin_file,
                             SSERV_CMD_PROB_CHANGE_PLUGIN_FILE,
                             SSERV_CMD_PROB_CLEAR_PLUGIN_FILE,
                             extra_msg,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(test_dir, "s"),
  extra_msg = 0;
  if (prob->abstract && !prob->test_dir[0]) extra_msg = "<i>(Undefined)</i>";
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_test_dir,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->test_dir[0])
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->test_dir));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->test_dir));
    extra_msg = msg_buf;
  }
  print_string_editing_row_2(f, "Directory with tests:", prob->test_dir,
                             SSERV_CMD_PROB_CHANGE_TEST_DIR,
                             SSERV_CMD_PROB_CLEAR_TEST_DIR,
                             extra_msg,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_test_sfx,
                           tmp_prob, sup_prob, sstate->global);
    prepare_set_prob_value(CNTSPROB_test_pat,
                           tmp_prob, sup_prob, sstate->global);
  }

  //PROBLEM_PARAM(test_sfx, "s"),
  extra_msg = 0;
  if (prob->abstract && (!prob->test_pat[0] || prob->test_pat[0] == 1)) extra_msg = "";
  if (!prob->abstract && !tmp_prob->test_pat[0]) {
    if (prob->test_sfx[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->test_sfx));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->test_sfx));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Suffix of test files:", prob->test_sfx,
                               SSERV_CMD_PROB_CHANGE_TEST_SFX,
                               SSERV_CMD_PROB_CLEAR_TEST_SFX,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(test_pat, "s"),
  extra_msg = 0;
  if (show_adv && prob->abstract) extra_msg = "";
  if (!prob->abstract && (show_adv || tmp_prob->test_pat[0])) {
    extra_msg = "";
    if (prob->test_pat[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->test_pat));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->test_pat));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f,
                               "Pattern for test file names (overrides test_suffix):",
                               prob->test_pat,
                               SSERV_CMD_PROB_CHANGE_TEST_PAT,
                               SSERV_CMD_PROB_CLEAR_TEST_PAT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(use_corr, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_use_corr,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->use_corr?"Yes":"No");
    extra_msg = msg_buf;
  }
  print_boolean_3_select_row(f, "Use \"correct answer\" files for check:",
                             prob->use_corr,
                             SSERV_CMD_PROB_CHANGE_USE_CORR,
                             extra_msg,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(corr_dir, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_corr == 1) {
    extra_msg = "";
    if (prob->abstract && !prob->corr_dir[0]) extra_msg = "<i>(Undefined)</i>";
  }
  if (!prob->abstract && tmp_prob->use_corr) {
    prepare_set_prob_value(CNTSPROB_corr_dir,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->corr_dir[0])
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->corr_dir));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->corr_dir));
    extra_msg = msg_buf;
  }
  if (extra_msg) {
    print_string_editing_row_2(f, "Directory with \"correct answer\" files:",
                               prob->corr_dir,
                               SSERV_CMD_PROB_CHANGE_CORR_DIR,
                               SSERV_CMD_PROB_CLEAR_CORR_DIR,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_corr_sfx,
                           tmp_prob, sup_prob, sstate->global);
    prepare_set_prob_value(CNTSPROB_corr_pat,
                           tmp_prob, sup_prob, sstate->global);
  }

  //PROBLEM_PARAM(corr_sfx, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_corr == 1
      && (!prob->corr_pat[0] || prob->corr_pat[0] == 1)) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_corr && !tmp_prob->corr_pat[0]) {
    if (prob->corr_sfx[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->corr_sfx));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->corr_sfx));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Suffix of \"correct answer\" files:", prob->corr_sfx,
                               SSERV_CMD_PROB_CHANGE_CORR_SFX,
                               SSERV_CMD_PROB_CLEAR_CORR_SFX,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(corr_pat, "s"),
  extra_msg = 0;
  if (show_adv && prob->abstract && prob->use_corr == 1) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_corr
      && (show_adv || tmp_prob->corr_pat[0])) {
    extra_msg = "";
    if (prob->corr_pat[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->corr_pat));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->corr_pat));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f,
                               "Pattern for \"correct answer\" file names (overrides corr_suffix):",
                               prob->corr_pat,
                               SSERV_CMD_PROB_CHANGE_CORR_PAT,
                               SSERV_CMD_PROB_CLEAR_CORR_PAT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(use_info, "d"),
  extra_msg = 0;
  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_use_info,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "Default (%s)", tmp_prob->use_info?"Yes":"No");
    extra_msg = msg_buf;
  }
  print_boolean_3_select_row(f, "Use test info files for check:",
                             prob->use_info,
                             SSERV_CMD_PROB_CHANGE_USE_INFO,
                             extra_msg,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(info_dir, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_info == 1) {
    extra_msg = "";
    if (prob->abstract && !prob->info_dir[0]) extra_msg = "<i>(Undefined)</i>";
  }
  if (!prob->abstract && tmp_prob->use_info) {
    prepare_set_prob_value(CNTSPROB_info_dir,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->info_dir[0])
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->info_dir));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->info_dir));
    extra_msg = msg_buf;
  }
  if (extra_msg) {
    print_string_editing_row_2(f, "Directory with test info files:",
                               prob->info_dir,
                               SSERV_CMD_PROB_CHANGE_INFO_DIR,
                               SSERV_CMD_PROB_CLEAR_INFO_DIR,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (!prob->abstract) {
    prepare_set_prob_value(CNTSPROB_info_sfx,
                           tmp_prob, sup_prob, sstate->global);
    prepare_set_prob_value(CNTSPROB_info_pat,
                           tmp_prob, sup_prob, sstate->global);
  }

  //PROBLEM_PARAM(info_sfx, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_info == 1
      && (!prob->info_pat[0] || prob->info_pat[0] == 1)) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info && !tmp_prob->info_pat[0]) {
    if (prob->info_sfx[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->info_sfx));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->info_sfx));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Suffix of test info:", prob->info_sfx,
                               SSERV_CMD_PROB_CHANGE_INFO_SFX,
                               SSERV_CMD_PROB_CLEAR_INFO_SFX,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(info_pat, "s"),
  extra_msg = 0;
  if (show_adv && prob->abstract && prob->use_info == 1) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info
      && (show_adv || tmp_prob->info_pat[0])) {
    extra_msg = "";
    if (prob->info_pat[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->info_pat));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->info_pat));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f,
                               "Pattern for test info file names (overrides info_suffix):",
                               prob->info_pat,
                               SSERV_CMD_PROB_CHANGE_INFO_PAT,
                               SSERV_CMD_PROB_CLEAR_INFO_PAT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(tgz_sfx, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_info == 1
      && (!prob->tgz_pat[0] || prob->tgz_pat[0] == 1)) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info && !tmp_prob->tgz_pat[0]) {
    if (prob->tgz_sfx[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->tgz_sfx));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->tgz_sfx));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Suffix of working dir archives:", prob->tgz_sfx,
                               SSERV_CMD_PROB_CHANGE_TGZ_SFX,
                               SSERV_CMD_PROB_CLEAR_TGZ_SFX,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(tgz_pat, "s"),
  extra_msg = 0;
  if (show_adv && prob->abstract && prob->use_info == 1) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info
      && (show_adv || tmp_prob->tgz_pat[0])) {
    extra_msg = "";
    if (prob->tgz_pat[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->tgz_pat));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->tgz_pat));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f,
                               "Pattern for working dir archives (overrides tgz_sfx):",
                               prob->tgz_pat,
                               SSERV_CMD_PROB_CHANGE_TGZ_PAT,
                               SSERV_CMD_PROB_CLEAR_TGZ_PAT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(tgzdir_sfx, "s"),
  extra_msg = 0;
  if (prob->abstract && prob->use_info == 1
      && (!prob->tgzdir_pat[0] || prob->tgzdir_pat[0] == 1)) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info && !tmp_prob->tgzdir_pat[0]) {
    if (prob->tgzdir_sfx[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->tgzdir_sfx));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->tgzdir_sfx));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Suffix of master working dirs:", prob->tgzdir_sfx,
                               SSERV_CMD_PROB_CHANGE_TGZDIR_SFX,
                               SSERV_CMD_PROB_CLEAR_TGZDIR_SFX,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(tgzdir_pat, "s"),
  extra_msg = 0;
  if (show_adv && prob->abstract && prob->use_info == 1) extra_msg = "";
  if (!prob->abstract && tmp_prob->use_info
      && (show_adv || tmp_prob->tgzdir_pat[0])) {
    extra_msg = "";
    if (prob->tgzdir_pat[0] == 1)
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->tgzdir_pat));
    else
      snprintf(msg_buf, sizeof(msg_buf), "<i>(\"%s\")</i>",
               ARMOR(tmp_prob->tgzdir_pat));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f,
                               "Pattern for master working dirs (overrides tgzdir_sfx):",
                               prob->tgzdir_pat,
                               SSERV_CMD_PROB_CHANGE_TGZDIR_PAT,
                               SSERV_CMD_PROB_CLEAR_TGZDIR_PAT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(time_limit, "d"),
  extra_msg = "";
  if (prob->abstract) {
    if (prob->time_limit == -1) extra_msg = "<i>(Undefined)</i>";
    else if (!prob->time_limit) extra_msg = "<i>(Unlimited)</i>";
  } else {
    if (prob->time_limit == -1) {
      prepare_set_prob_value(CNTSPROB_time_limit,
                             tmp_prob, sup_prob, sstate->global);
      if (!tmp_prob->time_limit)
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - Unlimited)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->time_limit);
      extra_msg = msg_buf;
    } else if (!prob->time_limit) extra_msg = "<i>(Unlimited)</i>";
  }
  if (!problem_type_flag) {
    print_int_editing_row(f, "Processor time limit (sec):",
                          prob->time_limit, extra_msg,
                          SSERV_CMD_PROB_CHANGE_TIME_LIMIT,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(time_limit_millis, "d"),
  extra_msg = "";
  if (prob->abstract) {
    if (prob->time_limit_millis == -1) extra_msg = "<i>(Undefined)</i>";
    else if (!prob->time_limit_millis) extra_msg = "<i>(Unlimited)</i>";
  } else {
    if (prob->time_limit_millis == -1) {
      prepare_set_prob_value(CNTSPROB_time_limit_millis,
                             tmp_prob, sup_prob, sstate->global);
      if (!tmp_prob->time_limit_millis)
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - Unlimited)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->time_limit_millis);
      extra_msg = msg_buf;
    } else if (!prob->time_limit_millis) extra_msg = "<i>(Unlimited)</i>";
  }
  if (!problem_type_flag) {
    print_int_editing_row(f, "Processor time limit (ms, ovverides prev. limit):",
                          prob->time_limit_millis, extra_msg,
                          SSERV_CMD_PROB_CHANGE_TIME_LIMIT_MILLIS,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(real_time_limit, "d"),
  extra_msg = "";
  if (prob->abstract) {
    if (prob->real_time_limit == -1) extra_msg = "<i>(Undefined)</i>";
    else if (!prob->real_time_limit) extra_msg = "<i>(Unlimited)</i>";
  } else {
    if (prob->real_time_limit == -1) {
      prepare_set_prob_value(CNTSPROB_real_time_limit,
                             tmp_prob, sup_prob, sstate->global);
      if (!tmp_prob->real_time_limit)
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - Unlimited)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->real_time_limit);
      extra_msg = msg_buf;
    } else if (!prob->real_time_limit) extra_msg = "<i>(Unlimited)</i>";
  }
  if (!problem_type_flag) {
    print_int_editing_row(f, "Real time limit (sec):",
                          prob->real_time_limit, extra_msg,
                          SSERV_CMD_PROB_CHANGE_REAL_TIME_LIMIT,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(max_vm_size, "d"),
  extra_msg = "";
  if (prob->abstract) {
    /*
    if (prob->max_vm_size == -1L) extra_msg = "<i>(Undefined)</i>";
    else if (!prob->max_vm_size) extra_msg = "<i>(OS Limit)</i>";
    */
    if (prob->max_vm_size == -1L || !prob->max_vm_size)
      extra_msg = "<i>(OS Limit)</i>";
  } else {
    if (prob->max_vm_size == -1L) {
      prepare_set_prob_value(CNTSPROB_max_vm_size,
                             tmp_prob, sup_prob, sstate->global);
      if (tmp_prob->max_vm_size == -1L || !tmp_prob->max_vm_size)
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %s)</i>",
                 size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_vm_size));
      extra_msg = msg_buf;
    } else if (!prob->max_vm_size) extra_msg = "<i>(OS Limit)</i>";
  }
  if (prob->max_vm_size == -1L) {
    snprintf(num_buf, sizeof(num_buf), "-1");
  } else {
    size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_vm_size);
  }
  if (!problem_type_flag) {
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
            "Maximum virtual memory size:");
    html_edit_text_form(f, 0, 0, "param", num_buf);
    fprintf(f, "%s</td><td>", extra_msg);
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_MAX_VM_SIZE, "Change");
    fprintf(f, "</td>");
    print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_VM_SIZE);
    fprintf(f, "</tr></form>\n");
  }

  if (!problem_type_flag && show_adv) {
    //PROBLEM_PARAM(max_stack_size, "z"),
    extra_msg = "";
    if (prob->abstract) {
      /*
      if (prob->max_stack_size == -1L) extra_msg = "<i>(Undefined)</i>";
      else if (!prob->max_stack_size) extra_msg = "<i>(OS Limit)</i>";
      */
      if (prob->max_stack_size == -1L || !prob->max_stack_size)
        extra_msg = "<i>(OS Limit)</i>";
    } else {
      if (prob->max_stack_size == -1L) {
        prepare_set_prob_value(CNTSPROB_max_stack_size,
                               tmp_prob, sup_prob, sstate->global);
        if (tmp_prob->max_stack_size == -1L || !tmp_prob->max_stack_size)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
        else
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %s)</i>",
                   num_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_stack_size));
        extra_msg = msg_buf;
      } else if (!prob->max_stack_size) extra_msg = "<i>(OS Limit)</i>";
    }
    if (prob->max_stack_size == -1L) {
      snprintf(num_buf, sizeof(num_buf), "-1");
    } else {
      num_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_stack_size);
    }
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>%s</td><td>",
            form_row_attrs[row ^= 1], "Maximum stack size:");
    html_edit_text_form(f, 0, 0, "param", num_buf);
    fprintf(f, "%s</td><td>", extra_msg);
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_MAX_STACK_SIZE, "Change");
    fprintf(f, "</td>");
    print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_STACK_SIZE);
    fprintf(f, "</tr></form>\n");
  }

  //PROBLEM_PARAM(max_core_size, "z"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->max_core_size == -1L)
        extra_msg = "<i>(OS Limit)</i>";
    } else {
      if (prob->max_core_size == -1L) {
        prepare_set_prob_value(CNTSPROB_max_core_size,
                               tmp_prob, sup_prob, sstate->global);
        if (tmp_prob->max_core_size == -1L)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %s)</i>",
                 size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_core_size));
        extra_msg = msg_buf;
      }
    }
    if (prob->max_core_size == -1L) {
      num_buf[0] = 0;
    } else {
      size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_core_size);
    }
    if (!problem_type_flag) {
      html_start_form(f, 1, self_url, prob_hidden_vars);
      fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
              "Maximum core file size:");
      html_edit_text_form(f, 0, 0, "param", num_buf);
      fprintf(f, "%s</td><td>", extra_msg);
      html_submit_button(f, SSERV_CMD_PROB_CHANGE_MAX_CORE_SIZE, "Change");
      fprintf(f, "</td>");
      print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_CORE_SIZE);
      fprintf(f, "</tr></form>\n");
    }
  }

  //PROBLEM_PARAM(max_file_size, "z"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->max_file_size == -1L)
        extra_msg = "<i>(OS Limit)</i>";
    } else {
      if (prob->max_file_size == -1L) {
        prepare_set_prob_value(CNTSPROB_max_file_size,
                               tmp_prob, sup_prob, sstate->global);
        if (tmp_prob->max_file_size == -1L)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
      else
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %s)</i>",
                 size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_file_size));
        extra_msg = msg_buf;
      }
    }
    if (prob->max_file_size == -1L) {
      num_buf[0] = 0;
    } else {
      size_t_to_size_str(num_buf, sizeof(num_buf), tmp_prob->max_file_size);
    }
    if (!problem_type_flag) {
      html_start_form(f, 1, self_url, prob_hidden_vars);
      fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
              "Maximum file size:");
      html_edit_text_form(f, 0, 0, "param", num_buf);
      fprintf(f, "%s</td><td>", extra_msg);
      html_submit_button(f, SSERV_CMD_PROB_CHANGE_MAX_FILE_SIZE, "Change");
      fprintf(f, "</td>");
      print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_FILE_SIZE);
      fprintf(f, "</tr></form>\n");
    }
  }

  //PROBLEM_PARAM(max_open_file_count, "d"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->max_open_file_count < 0)
        extra_msg = "<i>(OS Limit)</i>";
    } else {
      if (prob->max_open_file_count < 0) {
        prepare_set_prob_value(CNTSPROB_max_open_file_count,
                               tmp_prob, sup_prob, sstate->global);
        if (tmp_prob->max_open_file_count < 0)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
        else
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->max_open_file_count);
        extra_msg = msg_buf;
      }
    }
    if (prob->max_open_file_count < 0) {
      num_buf[0] = 0;
    } else {
      snprintf(num_buf, sizeof(num_buf), "%d", tmp_prob->max_open_file_count);
    }
    if (!problem_type_flag) {
      html_start_form(f, 1, self_url, prob_hidden_vars);
      fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
              "Maximum open file count:");
      html_edit_text_form(f, 0, 0, "param", num_buf);
      fprintf(f, "%s</td><td>", extra_msg);
      html_submit_button(f,SSERV_CMD_PROB_CHANGE_MAX_OPEN_FILE_COUNT,"Change");
      fprintf(f, "</td>");
      print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_OPEN_FILE_COUNT);
      fprintf(f, "</tr></form>\n");
    }
  }

  //PROBLEM_PARAM(max_process_count, "d"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->max_process_count < 0)
        extra_msg = "<i>(OS Limit)</i>";
    } else {
      if (prob->max_process_count < 0) {
        prepare_set_prob_value(CNTSPROB_max_process_count,
                               tmp_prob, sup_prob, sstate->global);
        if (tmp_prob->max_process_count < 0)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - OS Limit)</i>");
        else
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->max_process_count);
        extra_msg = msg_buf;
      }
    }
    if (prob->max_process_count < 0) {
      num_buf[0] = 0;
    } else {
      snprintf(num_buf, sizeof(num_buf), "%d", tmp_prob->max_process_count);
    }
    if (!problem_type_flag) {
      html_start_form(f, 1, self_url, prob_hidden_vars);
      fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
              "Maximum process count:");
      html_edit_text_form(f, 0, 0, "param", num_buf);
      fprintf(f, "%s</td><td>", extra_msg);
      html_submit_button(f,SSERV_CMD_PROB_CHANGE_MAX_PROCESS_COUNT, "Change");
      fprintf(f, "</td>");
      print_help_url(f, SSERV_CMD_PROB_CHANGE_MAX_PROCESS_COUNT);
      fprintf(f, "</tr></form>\n");
    }
  }

  if (show_adv) {
    //PROBLEM_PARAM(enable_process_group, "d"),
    extra_msg = "Undefined";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_enable_process_group,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->enable_process_group?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f,"Use separate process group:",
                               prob->enable_process_group,
                               SSERV_CMD_PROB_CHANGE_ENABLE_PROCESS_GROUP,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(checker_real_time_limit, "d"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->checker_real_time_limit == -1) extra_msg = "<i>(Undefined)</i>";
      else if (!prob->checker_real_time_limit) extra_msg = "<i>(Unlimited)</i>";
    } else {
      if (prob->checker_real_time_limit == -1) {
        prepare_set_prob_value(CNTSPROB_checker_real_time_limit,
                               tmp_prob, sup_prob, sstate->global);
        if (!tmp_prob->checker_real_time_limit)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - Unlimited)</i>");
        else
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->checker_real_time_limit);
        extra_msg = msg_buf;
      } else if (!prob->checker_real_time_limit) extra_msg = "<i>(Unlimited)</i>";
    }
    print_int_editing_row(f, "Real time limit for checker (sec):",
                          prob->checker_real_time_limit, extra_msg,
                          SSERV_CMD_PROB_CHANGE_CHECKER_REAL_TIME_LIMIT,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(use_ac_not_ok, "d"),
    extra_msg = "Undefined";
    tmp_prob->use_ac_not_ok = prob->use_ac_not_ok;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_use_ac_not_ok,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->use_ac_not_ok?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Use AC status instead of OK:",
                               prob->use_ac_not_ok,
                               SSERV_CMD_PROB_CHANGE_USE_AC_NOT_OK,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    if (tmp_prob->use_ac_not_ok > 0) {
      extra_msg = "Undefined";
      tmp_prob->ignore_prev_ac = prob->ignore_prev_ac;
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_ignore_prev_ac,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->ignore_prev_ac?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Mark previous AC as IG:",
                                 prob->ignore_prev_ac,
                                 SSERV_CMD_PROB_CHANGE_IGNORE_PREV_AC,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    //PROBLEM_PARAM(team_enable_rep_view, "d"),
    extra_msg = "Undefined";
    tmp_prob->team_enable_rep_view = prob->team_enable_rep_view;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_team_enable_rep_view,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->team_enable_rep_view?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Contestant may view testing protocol:",
                               prob->team_enable_rep_view,
                               SSERV_CMD_PROB_CHANGE_TEAM_ENABLE_REP_VIEW,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    if (tmp_prob->team_enable_rep_view != 1) {
      //PROBLEM_PARAM(team_enable_ce_view, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_team_enable_ce_view,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->team_enable_ce_view?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Contestant may view compilation errors:",
                                 prob->team_enable_ce_view,
                                 SSERV_CMD_PROB_CHANGE_TEAM_ENABLE_CE_VIEW,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    if (tmp_prob->team_enable_rep_view != 0) {
      //PROBLEM_PARAM(team_show_judge_report, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_team_show_judge_report,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->team_show_judge_report?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Contestant may view FULL (judge's) testing protocol:",
                                 prob->team_show_judge_report,
                                 SSERV_CMD_PROB_CHANGE_TEAM_SHOW_JUDGE_REPORT,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);

      //PROBLEM_PARAM(show_checker_comment, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_show_checker_comment,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->show_checker_comment?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Contestant may view checker comment:",
                                 prob->show_checker_comment,
                                 SSERV_CMD_PROB_CHANGE_SHOW_CHECKER_COMMENT,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    //PROBLEM_PARAM(ignore_compile_errors, "d"),
    extra_msg = "Undefined";
    tmp_prob->ignore_compile_errors = prob->ignore_compile_errors;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_ignore_compile_errors,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->ignore_compile_errors?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Ignore compilation errors:",
                               prob->ignore_compile_errors,
                               SSERV_CMD_PROB_CHANGE_IGNORE_COMPILE_ERRORS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(disable_user_submit, "d"),
    extra_msg = "Undefined";
    tmp_prob->disable_user_submit = prob->disable_user_submit;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_user_submit,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_user_submit?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Disable user submissions:",
                               prob->disable_user_submit,
                               SSERV_CMD_PROB_CHANGE_DISABLE_USER_SUBMIT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    if (global && global->problem_navigation > 0) {
      //PROBLEM_PARAM(disable_tab, "d"),
      extra_msg = "Undefined";
      tmp_prob->disable_tab = prob->disable_tab;
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_disable_tab,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->disable_tab?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Disable problem tab:",
                                 prob->disable_tab,
                                 SSERV_CMD_PROB_CHANGE_DISABLE_TAB,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    //PROBLEM_PARAM(restricted_statement, "d"),
    extra_msg = "Undefined";
    tmp_prob->restricted_statement = prob->restricted_statement;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_restricted_statement,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->restricted_statement?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Restricted problem statement:",
                               prob->restricted_statement,
                               SSERV_CMD_PROB_CHANGE_RESTRICTED_STATEMENT,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(disable_submit_after_ok, "d"),
    extra_msg = "Undefined";
    tmp_prob->disable_submit_after_ok = prob->disable_submit_after_ok;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_submit_after_ok,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_submit_after_ok?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Disable submissions after OK:",
                               prob->disable_submit_after_ok,
                               SSERV_CMD_PROB_CHANGE_DISABLE_SUBMIT_AFTER_OK,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(disable_security, "d"),
    extra_msg = "Undefined";
    tmp_prob->disable_security = prob->disable_security;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_security,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_security?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Disable security restrictions:",
                               prob->disable_security,
                               SSERV_CMD_PROB_CHANGE_DISABLE_SECURITY,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(disable_testing, "d"),
    extra_msg = "Undefined";
    tmp_prob->disable_testing = prob->disable_testing;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_testing,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_testing?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Disable any testing of submissions:",
                               prob->disable_testing,
                               SSERV_CMD_PROB_CHANGE_DISABLE_TESTING,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    if (tmp_prob->disable_testing != 1) {
      //PROBLEM_PARAM(disable_auto_testing, "d"),
      extra_msg = "Undefined";
      tmp_prob->disable_auto_testing = prob->disable_auto_testing;
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_disable_auto_testing,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->disable_auto_testing?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Disable automatic testing of submissions:",
                                 prob->disable_auto_testing,
                                 SSERV_CMD_PROB_CHANGE_DISABLE_AUTO_TESTING,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    if (!problem_type_flag && tmp_prob->disable_testing == 1) {
      //PROBLEM_PARAM(enable_compilation, "d"),
      extra_msg = "Undefined";
      tmp_prob->enable_compilation = prob->enable_compilation;
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_enable_compilation,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->enable_compilation?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Still compile runs to mark as ACCEPTED:",
                                 prob->enable_compilation,
                                 SSERV_CMD_PROB_CHANGE_ENABLE_COMPILATION,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }
  } /* show_adv */

  if (show_adv) {
    //PROBLEM_PARAM(ignore_exit_code, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_ignore_exit_code,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->ignore_exit_code?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Ignore exit code?", prob->ignore_exit_code,
                               SSERV_CMD_PROB_CHANGE_IGNORE_EXIT_CODE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global && sstate->global->score_system == SCORE_KIROV
      && show_adv) {
    //PROBLEM_PARAM(olympiad_mode, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_olympiad_mode,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->olympiad_mode?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Use Olympiad mode?", prob->olympiad_mode,
                               SSERV_CMD_PROB_CHANGE_OLYMPIAD_MODE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global && sstate->global->score_system == SCORE_KIROV
      && show_adv) {
    //PROBLEM_PARAM(score_latest, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_score_latest,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->score_latest?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Score the latest submit?", prob->score_latest,
                               SSERV_CMD_PROB_CHANGE_SCORE_LATEST,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(score_latest_or_unmarked, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_score_latest_or_unmarked,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->score_latest_or_unmarked?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Score the latest or the best unmarked?", prob->score_latest_or_unmarked,
                               SSERV_CMD_PROB_CHANGE_SCORE_LATEST_OR_UNMARKED,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(score_latest_marked, "d"),
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_score_latest_marked,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->score_latest_marked?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Score the latest marked submit?", prob->score_latest_marked,
                               SSERV_CMD_PROB_CHANGE_SCORE_LATEST_MARKED,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  }

  if (sstate->global && sstate->global->score_system != SCORE_ACM) {
    //PROBLEM_PARAM(full_score, "d"),
    extra_msg = "";
    if (prob->full_score == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_full_score,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->full_score);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Score for full solution:",
                          prob->full_score, extra_msg,
                          SSERV_CMD_PROB_CHANGE_FULL_SCORE,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global && sstate->global->score_system != SCORE_ACM
      && sstate->global->separate_user_score > 0) {
    //PROBLEM_PARAM(full_user_score, "d"),
    extra_msg = "";
    if (prob->full_user_score == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_full_user_score,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->full_user_score);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Score for user-visible full solution:",
                          prob->full_user_score, extra_msg,
                          SSERV_CMD_PROB_CHANGE_FULL_USER_SCORE,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global &&
      (sstate->global->score_system == SCORE_KIROV
       || sstate->global->score_system == SCORE_OLYMPIAD)) {
    if (show_adv) {
      //PROBLEM_PARAM(variable_full_score, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_variable_full_score,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->variable_full_score?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Allow variable score for full solution:",
                                 prob->variable_full_score,
                                 SSERV_CMD_PROB_CHANGE_VARIABLE_FULL_SCORE,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }

    //PROBLEM_PARAM(test_score, "d"),
    extra_msg = "";
    if (prob->test_score == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_test_score,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->test_score);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Default score for 1 passed test:",
                          prob->test_score, extra_msg,
                          SSERV_CMD_PROB_CHANGE_TEST_SCORE,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);

    if (sstate->global->score_system == SCORE_KIROV) {
      //PROBLEM_PARAM(run_penalty, "d"),
      extra_msg = "";
      if (prob->run_penalty == -1) {
        if (prob->abstract) {
          extra_msg = "<i>(Undefined)</i>";
        } else {
          prepare_set_prob_value(CNTSPROB_run_penalty,
                                 tmp_prob, sup_prob, sstate->global);
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->run_penalty);
          extra_msg = msg_buf;
        }
      }
      print_int_editing_row(f, "Penalty for a submission:",
                            prob->run_penalty, extra_msg,
                            SSERV_CMD_PROB_CHANGE_RUN_PENALTY,
                            session_id, form_row_attrs[row ^= 1],
                            self_url, extra_args, prob_hidden_vars);
    }

    //PROBLEM_PARAM(disqualified_penalty, "d"),
    extra_msg = "";
    if (prob->disqualified_penalty == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_disqualified_penalty,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->disqualified_penalty);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Penalty for a disqualified submission:",
                          prob->disqualified_penalty, extra_msg,
                          SSERV_CMD_PROB_CHANGE_DISQUALIFIED_PENALTY,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(test_score_list, "s"),
    print_string_editing_row(f, "Test scores for tests:", prob->test_score_list,
                             SSERV_CMD_PROB_CHANGE_TEST_SCORE_LIST,
                             SSERV_CMD_PROB_CLEAR_TEST_SCORE_LIST,
                             0,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);
  }

  if ((sstate->global->score_system == SCORE_ACM
       || sstate->global->score_system == SCORE_MOSCOW)
      && show_adv) {
    //PROBLEM_PARAM(acm_run_penalty, "d"),
    extra_msg = "";
    if (prob->acm_run_penalty == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_acm_run_penalty,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->acm_run_penalty);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Penalty for a submission (minutes):",
                          prob->acm_run_penalty, extra_msg,
                          SSERV_CMD_PROB_CHANGE_ACM_RUN_PENALTY,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global && sstate->global->score_system == SCORE_MOSCOW) {
    //PROBLEM_PARAM(score_tests, "s"),
    print_string_editing_row(f, "Tests for problem scores:", prob->score_tests,
                             SSERV_CMD_PROB_CHANGE_SCORE_TESTS,
                             SSERV_CMD_PROB_CLEAR_SCORE_TESTS,
                             0,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);
  }

  if (sstate->global
      && (sstate->global->score_system == SCORE_KIROV
          || sstate->global->score_system == SCORE_OLYMPIAD)
      && !prob->abstract
      && show_adv) {
    if (!prob->test_sets || !prob->test_sets[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->test_sets);
    }
    print_string_editing_row_3(f, "Specially scored test sets:", checker_env,
                               SSERV_CMD_PROB_CHANGE_TEST_SETS,
                               SSERV_CMD_PROB_CLEAR_TEST_SETS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(score_bonus, "s"),
  extra_msg = 0;
  if (global && global->score_system == SCORE_KIROV) {
    if (prob->abstract && (show_adv || prob->score_bonus[0])) extra_msg = "";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_score_bonus,
                             tmp_prob, sup_prob, sstate->global);
      if (show_adv || tmp_prob->score_bonus[0]) {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
                 prob->score_bonus[0]?"Default - ":"",
                 ARMOR(tmp_prob->score_bonus));
        extra_msg = msg_buf;
      }
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Additional score bonus:", prob->score_bonus,
                               SSERV_CMD_PROB_CHANGE_SCORE_BONUS,
                               SSERV_CMD_PROB_CLEAR_SCORE_BONUS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(open_tests, "s"),
  extra_msg = 0;
  if (show_adv && !prob->abstract) {
    if (prob->abstract && (show_adv || prob->open_tests[0])) extra_msg = "";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_open_tests,
                             tmp_prob, sup_prob, sstate->global);
      if (show_adv || tmp_prob->open_tests[0]) {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
                 prob->open_tests[0]?"Default - ":"",
                 ARMOR(tmp_prob->open_tests));
        extra_msg = msg_buf;
      }
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Tests open for participants:",
                               prob->open_tests,
                               SSERV_CMD_PROB_CHANGE_OPEN_TESTS,
                               SSERV_CMD_PROB_CLEAR_OPEN_TESTS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(final_open_tests, "s"),
  extra_msg = 0;
  if (show_adv && !prob->abstract) {
    if (prob->abstract && (show_adv || prob->final_open_tests[0])) extra_msg = "";
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_final_open_tests,
                             tmp_prob, sup_prob, sstate->global);
      if (show_adv || tmp_prob->final_open_tests[0]) {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
                 prob->final_open_tests[0]?"Default - ":"",
                 ARMOR(tmp_prob->final_open_tests));
        extra_msg = msg_buf;
      }
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Tests open for participants finally:",
                               prob->final_open_tests,
                               SSERV_CMD_PROB_CHANGE_FINAL_OPEN_TESTS,
                               SSERV_CMD_PROB_CLEAR_FINAL_OPEN_TESTS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  if (sstate->global && sstate->global->score_system == SCORE_OLYMPIAD) {
    //PROBLEM_PARAM(tests_to_accept, "d"),
    extra_msg = "";
    if (prob->tests_to_accept == -1) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_tests_to_accept,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->tests_to_accept);
        extra_msg = msg_buf;
      }
    }
    if (!problem_type_flag) {
      print_int_editing_row(f, "Number of accept tests:",
                            prob->tests_to_accept, extra_msg,
                            SSERV_CMD_PROB_CHANGE_TESTS_TO_ACCEPT,
                            session_id, form_row_attrs[row ^= 1],
                            self_url, extra_args, prob_hidden_vars);
    }

    if (show_adv) {
      //PROBLEM_PARAM(accept_partial, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_accept_partial,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->accept_partial?"Yes":"No");
        extra_msg = msg_buf;
      }
      if (!problem_type_flag) {
        print_boolean_3_select_row(f, "Accept for testing solutions that do not pass all accept tests:",
                                   prob->accept_partial,
                                   SSERV_CMD_PROB_CHANGE_ACCEPT_PARTIAL,
                                   extra_msg,
                                   session_id, form_row_attrs[row ^= 1],
                                   self_url, extra_args, prob_hidden_vars);
      }

      //PROBLEM_PARAM(min_tests_to_accept, "d"),
      extra_msg = "";
      if (prob->min_tests_to_accept < 0) {
        if (prob->abstract) {
          extra_msg = "<i>(Undefined)</i>";
        } else {
          prepare_set_prob_value(CNTSPROB_min_tests_to_accept,
                                 tmp_prob, sup_prob, sstate->global);
          if (tmp_prob->min_tests_to_accept < 0)
            tmp_prob->min_tests_to_accept = tmp_prob->tests_to_accept;
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->min_tests_to_accept);
          extra_msg = msg_buf;
        }
      }
      if (!problem_type_flag) {
        print_int_editing_row(f, "Min. Number of accept tests:",
                              prob->min_tests_to_accept, extra_msg,
                              SSERV_CMD_PROB_CHANGE_MIN_TESTS_TO_ACCEPT,
                              session_id, form_row_attrs[row ^= 1],
                              self_url, extra_args, prob_hidden_vars);
      }
    }
  }

  if (show_adv) {
    //PROBLEM_PARAM(max_user_run_count, "d"),
    extra_msg = "";
    if (prob->max_user_run_count < 0) {
      if (prob->abstract) {
        extra_msg = "<i>(Undefined)</i>";
      } else {
        prepare_set_prob_value(CNTSPROB_max_user_run_count,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                 tmp_prob->max_user_run_count);
        extra_msg = msg_buf;
      }
    }
    print_int_editing_row(f, "Max submissions for the problem:",
                          prob->max_user_run_count, extra_msg,
                          SSERV_CMD_PROB_CHANGE_MAX_USER_RUN_COUNT,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(hidden, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_hidden,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->hidden?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f, "Do not show this problem in standings:",
                                 prob->hidden,
                                 SSERV_CMD_PROB_CHANGE_HIDDEN,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  if (!prob->abstract && show_adv && sstate->global
      && sstate->global->stand_show_ok_time) {
    //PROBLEM_PARAM(stand_hide_time, "d"),
    print_boolean_select_row(f, "Do not show accept time for this problem",
                             prob->stand_hide_time,
                             SSERV_CMD_PROB_CHANGE_STAND_HIDE_TIME,
                             session_id, form_row_attrs[row ^= 1],
                             self_url, extra_args, prob_hidden_vars);

  }

  if (show_adv && sstate->global && sstate->global->problem_navigation) {
    //PROBLEM_PARAM(advance_to_next, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_advance_to_next,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->advance_to_next?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Automatically advance to the next problem:",
                                 prob->advance_to_next,
                                 SSERV_CMD_PROB_CHANGE_ADVANCE_TO_NEXT,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv && sstate->global) {
    //PROBLEM_PARAM(disable_ctrl_chars, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_disable_ctrl_chars,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->disable_ctrl_chars?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Disable any control characters in the source code:",
                                 prob->disable_ctrl_chars,
                                 SSERV_CMD_PROB_CHANGE_DISABLE_CTRL_CHARS,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(enable_text_form, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_enable_text_form,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->enable_text_form?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Enable text input form anyway:",
                                 prob->enable_text_form,
                                 SSERV_CMD_PROB_CHANGE_ENABLE_TEXT_FORM,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(stand_attr, "s"),
    extra_msg = 0;
    if (prob->abstract && !prob->use_stdout) extra_msg = "";
    if (!prob->abstract && !tmp_prob->use_stdout) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_stand_attr,
                             tmp_prob, sup_prob, sstate->global);
      if (!prob->stand_attr[0]) {
        snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
                 ARMOR(tmp_prob->stand_attr));
        extra_msg = msg_buf;
      }
    }
    if (!problem_type_flag && extra_msg) {
      print_string_editing_row_2(f, "Standings attributes:", prob->stand_attr,
                                 SSERV_CMD_PROB_CHANGE_STAND_ATTR,
                                 SSERV_CMD_PROB_CLEAR_STAND_ATTR,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
    }
  }

  //PROBLEM_PARAM(disable_pe, "d")
  if (show_adv) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_pe,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_pe?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Convert PEs to VAs",
                               prob->disable_pe,
                               SSERV_CMD_PROB_CHANGE_DISABLE_PE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(disable_wtl, "d")
  if (show_adv) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_disable_wtl,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->disable_wtl?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Convert WTLs to TLs",
                               prob->disable_wtl,
                               SSERV_CMD_PROB_CHANGE_DISABLE_WTL,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(standard_checker, "s"),
  print_std_checker_row(f, prob, sstate, session_id, form_row_attrs[row ^= 1],
                        self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(check_cmd, "s"),
  extra_msg = 0;
  if (prob->abstract) extra_msg = "";
  if (!prob->abstract && !prob->standard_checker[0]) {
    extra_msg = "";
    prepare_set_prob_value(CNTSPROB_check_cmd,
                           tmp_prob, sup_prob, sstate->global);
    snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
             prob->check_cmd[0]?"Default - ":"", ARMOR(tmp_prob->check_cmd));
    extra_msg = msg_buf;
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Checker name:", prob->check_cmd,
                               SSERV_CMD_PROB_CHANGE_CHECK_CMD,
                               SSERV_CMD_PROB_CLEAR_CHECK_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(checker_env, "x"),
  if (!prob->abstract) {
    if (!prob->checker_env || !prob->checker_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->checker_env);
    }
    print_string_editing_row_3(f, "Checker environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_CHECKER_ENV,
                               SSERV_CMD_PROB_CLEAR_CHECKER_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(scoring_checker, "d")
  if (show_adv) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_scoring_checker,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->scoring_checker?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Checker calculates score",
                               prob->scoring_checker,
                               SSERV_CMD_PROB_CHANGE_SCORING_CHECKER,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(start_env, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->start_env || !prob->start_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->start_env);
    }
    print_string_editing_row_3(f, "Start environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_START_ENV,
                               SSERV_CMD_PROB_CLEAR_START_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(valuer_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_valuer_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->valuer_cmd[0]?"Default - ":"",ARMOR(tmp_prob->valuer_cmd));
      extra_msg = msg_buf;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Score valuer name:", prob->valuer_cmd,
                               SSERV_CMD_PROB_CHANGE_VALUER_CMD,
                               SSERV_CMD_PROB_CLEAR_VALUER_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  if (show_adv) {
    //PROBLEM_PARAM(valuer_sets_marked, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_valuer_sets_marked,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->valuer_sets_marked?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Valuer sets _marked_ flag:",
                                 prob->valuer_sets_marked,
                                 SSERV_CMD_PROB_CHANGE_VALUER_SETS_MARKED,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(interactive_valuer, "d")
  if (show_adv) {
    extra_msg = 0;
    if (!prob->abstract) {
      prepare_set_prob_value(CNTSPROB_interactive_valuer,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
               tmp_prob->interactive_valuer?"Yes":"No");
      extra_msg = msg_buf;
    }
    print_boolean_3_select_row(f, "Valuer works interactively",
                               prob->interactive_valuer,
                               SSERV_CMD_PROB_CHANGE_INTERACTIVE_VALUER,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv) {
    //PROBLEM_PARAM(ignore_unmarked, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_ignore_unmarked,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->ignore_unmarked?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Ignore unmarked runs in scoring:",
                                 prob->ignore_unmarked,
                                 SSERV_CMD_PROB_CHANGE_IGNORE_UNMARKED,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(valuer_env, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->valuer_env || !prob->valuer_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->valuer_env);
    }
    print_string_editing_row_3(f, "Valuer environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_VALUER_ENV,
                               SSERV_CMD_PROB_CLEAR_VALUER_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(interactor_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_interactor_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->interactor_cmd[0]?"Default - ":"",
               ARMOR(tmp_prob->interactor_cmd));
      extra_msg = msg_buf;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Interactor name:", prob->interactor_cmd,
                               SSERV_CMD_PROB_CHANGE_INTERACTOR_CMD,
                               SSERV_CMD_PROB_CLEAR_INTERACTOR_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(interactor_env, "x"),
  if (!prob->abstract) {
    if (!prob->interactor_env || !prob->interactor_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->interactor_env);
    }
    print_string_editing_row_3(f, "Interactor environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_INTERACTOR_ENV,
                               SSERV_CMD_PROB_CLEAR_INTERACTOR_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(interactor_time_limit, "d"),
  if (show_adv) {
    extra_msg = "";
    if (prob->abstract) {
      if (prob->interactor_time_limit == -1) extra_msg = "<i>(Undefined)</i>";
      else if (!prob->interactor_time_limit) extra_msg = "<i>(Unlimited)</i>";
    } else {
      if (prob->interactor_time_limit == -1) {
        prepare_set_prob_value(CNTSPROB_interactor_time_limit,
                               tmp_prob, sup_prob, sstate->global);
        if (!tmp_prob->interactor_time_limit)
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - Unlimited)</i>");
        else
          snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - %d)</i>",
                   tmp_prob->interactor_time_limit);
        extra_msg = msg_buf;
      } else if (!prob->interactor_time_limit) extra_msg = "<i>(Unlimited)</i>";
    }
    print_int_editing_row(f, "Time limit for interactor (sec):",
                          prob->interactor_time_limit, extra_msg,
                          SSERV_CMD_PROB_CHANGE_INTERACTOR_TIME_LIMIT,
                          session_id, form_row_attrs[row ^= 1],
                          self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(style_checker_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_style_checker_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->style_checker_cmd[0]?"Default - ":"",
               ARMOR(tmp_prob->style_checker_cmd));
      extra_msg = msg_buf;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Style checker name:",prob->style_checker_cmd,
                               SSERV_CMD_PROB_CHANGE_STYLE_CHECKER_CMD,
                               SSERV_CMD_PROB_CLEAR_STYLE_CHECKER_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(style_checker_env, "x"),
  if (!prob->abstract) {
    if (!prob->style_checker_env || !prob->style_checker_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->style_checker_env);
    }
    print_string_editing_row_3(f, "Style checker environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_STYLE_CHECKER_ENV,
                               SSERV_CMD_PROB_CLEAR_STYLE_CHECKER_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env); checker_env = 0;
  }

  //PROBLEM_PARAM(lang_compiler_env, "x"),
  if (!prob->abstract) {
    if (!prob->lang_compiler_env || !prob->lang_compiler_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->lang_compiler_env);
    }
    print_string_editing_row_3(f, "Compiler environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_LANG_COMPILER_ENV,
                               SSERV_CMD_PROB_CLEAR_LANG_COMPILER_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env); checker_env = 0;
  }

  //PROBLEM_PARAM(test_checker_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_test_checker_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->test_checker_cmd?"Default - ":"",
               ARMOR(tmp_prob->test_checker_cmd));
      extra_msg = msg_buf;
      xfree(tmp_prob->test_checker_cmd); tmp_prob->test_checker_cmd = 0;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Test checker name:",
                               prob->test_checker_cmd,
                               SSERV_CMD_PROB_CHANGE_TEST_CHECKER_CMD,
                               SSERV_CMD_PROB_CLEAR_TEST_CHECKER_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(test_checker_env, "x"),
  if (!prob->abstract) {
    if (!prob->test_checker_env || !prob->test_checker_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->test_checker_env);
    }
    print_string_editing_row_3(f, "Test checker environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_TEST_CHECKER_ENV,
                               SSERV_CMD_PROB_CLEAR_TEST_CHECKER_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env); checker_env = 0;
  }

  //PROBLEM_PARAM(init_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_init_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->init_cmd?"Default - ":"",
               ARMOR(tmp_prob->init_cmd));
      extra_msg = msg_buf;
      xfree(tmp_prob->init_cmd); tmp_prob->init_cmd = 0;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Init-style interactor name:",
                               prob->init_cmd,
                               SSERV_CMD_PROB_CHANGE_INIT_CMD,
                               SSERV_CMD_PROB_CLEAR_INIT_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(init_env, "x"),
  if (!prob->abstract) {
    if (!prob->init_env || !prob->init_env[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse(prob->init_env);
    }
    print_string_editing_row_3(f, "Init-style interactor environment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_INIT_ENV,
                               SSERV_CMD_PROB_CLEAR_INIT_ENV,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env); checker_env = 0;
  }

  //PROBLEM_PARAM(solution_src, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_solution_src,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->solution_src?"Default - ":"",
               ARMOR(tmp_prob->solution_src));
      extra_msg = msg_buf;
      xfree(tmp_prob->solution_src); tmp_prob->solution_src = 0;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Solution source name:",
                               prob->solution_src,
                               SSERV_CMD_PROB_CHANGE_SOLUTION_SRC,
                               SSERV_CMD_PROB_CLEAR_SOLUTION_SRC,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  //PROBLEM_PARAM(solution_cmd, "s"),
  extra_msg = 0;
  if (show_adv) {
    if (prob->abstract) extra_msg = "";
    if (!prob->abstract) {
      extra_msg = "";
      prepare_set_prob_value(CNTSPROB_solution_cmd,
                             tmp_prob, sup_prob, sstate->global);
      snprintf(msg_buf, sizeof(msg_buf), "<i>(%s\"%s\")</i>",
               prob->solution_cmd?"Default - ":"",
               ARMOR(tmp_prob->solution_cmd));
      extra_msg = msg_buf;
      xfree(tmp_prob->solution_cmd); tmp_prob->solution_cmd = 0;
    }
  }
  if (extra_msg)
    print_string_editing_row_3(f, "Solution command:",
                               prob->solution_cmd,
                               SSERV_CMD_PROB_CHANGE_SOLUTION_CMD,
                               SSERV_CMD_PROB_CLEAR_SOLUTION_CMD,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

  // PROBLEM_PARAM(score_view, "x")
  if (!prob->abstract && show_adv) {
    if (!prob->score_view || !prob->score_view[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->score_view);
    }
    print_string_editing_row_3(f, "Special view for scores:", checker_env,
                               SSERV_CMD_PROB_CHANGE_SCORE_VIEW,
                               SSERV_CMD_PROB_CLEAR_SCORE_VIEW,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  if (show_adv && sstate->global) {
    //PROBLEM_PARAM(stand_ignore_score, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_stand_ignore_score,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->stand_ignore_score?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Ignore problem score in standings:",
                                 prob->stand_ignore_score,
                                 SSERV_CMD_PROB_CHANGE_STAND_IGNORE_SCORE,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  if (show_adv && sstate->global) {
    //PROBLEM_PARAM(stand_last_column, "d"),
      extra_msg = "Undefined";
      if (!prob->abstract) {
        prepare_set_prob_value(CNTSPROB_stand_last_column,
                               tmp_prob, sup_prob, sstate->global);
        snprintf(msg_buf, sizeof(msg_buf), "Default (%s)",
                 tmp_prob->stand_last_column?"Yes":"No");
        extra_msg = msg_buf;
      }
      print_boolean_3_select_row(f,"Show the problem after all results:",
                                 prob->stand_last_column,
                                 SSERV_CMD_PROB_CHANGE_STAND_LAST_COLUMN,
                                 extra_msg,
                                 session_id, form_row_attrs[row ^= 1],
                                 self_url, extra_args, prob_hidden_vars);
  }

  //PROBLEM_PARAM(lang_time_adj, "x"),
  if (!prob->abstract && !problem_type_flag && show_adv) {
    if (!prob->lang_time_adj || !prob->lang_time_adj[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->lang_time_adj);
    }
    print_string_editing_row_3(f, "Language-based time-limit adjustment:", checker_env,
                               SSERV_CMD_PROB_CHANGE_LANG_TIME_ADJ,
                               SSERV_CMD_PROB_CLEAR_LANG_TIME_ADJ,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(lang_time_adj_millis, "x"),
  if (!prob->abstract && !problem_type_flag && show_adv) {
    if (!prob->lang_time_adj_millis || !prob->lang_time_adj_millis[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->lang_time_adj_millis);
    }
    print_string_editing_row_3(f, "Language-based time-limit adjustment (ms):",
                               checker_env,
                               SSERV_CMD_PROB_CHANGE_LANG_TIME_ADJ_MILLIS,
                               SSERV_CMD_PROB_CLEAR_LANG_TIME_ADJ_MILLIS,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(lang_max_vm_size, "x"),
  if (!prob->abstract && !problem_type_flag && show_adv) {
    if (!prob->lang_max_vm_size || !prob->lang_max_vm_size[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->lang_max_vm_size);
    }
    print_string_editing_row_3(f, "Language-based memory limit:", checker_env,
                               SSERV_CMD_PROB_CHANGE_LANG_MAX_VM_SIZE,
                               SSERV_CMD_PROB_CLEAR_LANG_MAX_VM_SIZE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(lang_max_stack_size, "x"),
  if (!prob->abstract && !problem_type_flag && show_adv) {
    if (!prob->lang_max_stack_size || !prob->lang_max_stack_size[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->lang_max_stack_size);
    }
    print_string_editing_row_3(f, "Language-based stack limit:", checker_env,
                               SSERV_CMD_PROB_CHANGE_LANG_MAX_STACK_SIZE,
                               SSERV_CMD_PROB_CLEAR_LANG_MAX_STACK_SIZE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(disable_language, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->disable_language || !prob->disable_language[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->disable_language);
    }
    print_string_editing_row_3(f, "Disabled languages:", checker_env,
                               SSERV_CMD_PROB_CHANGE_DISABLE_LANGUAGE,
                               SSERV_CMD_PROB_CLEAR_DISABLE_LANGUAGE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(enable_language, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->enable_language || !prob->enable_language[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->enable_language);
    }
    print_string_editing_row_3(f, "Enabled languages:", checker_env,
                               SSERV_CMD_PROB_CHANGE_ENABLE_LANGUAGE,
                               SSERV_CMD_PROB_CLEAR_ENABLE_LANGUAGE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(require, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->require || !prob->require[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->require);
    }
    print_string_editing_row_3(f, "Required problems:", checker_env,
                               SSERV_CMD_PROB_CHANGE_REQUIRE,
                               SSERV_CMD_PROB_CLEAR_REQUIRE,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(provide_ok, "x"),
  if (!prob->abstract && show_adv) {
    if (!prob->provide_ok || !prob->provide_ok[0]) {
      extra_msg = "(not set)";
      checker_env = xstrdup("");
    } else {
      extra_msg = "";
      checker_env = sarray_unparse_2(prob->provide_ok);
    }
    print_string_editing_row_3(f, "Provide OK to problems:", checker_env,
                               SSERV_CMD_PROB_CHANGE_PROVIDE_OK,
                               SSERV_CMD_PROB_CLEAR_PROVIDE_OK,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
    xfree(checker_env);
  }

  //PROBLEM_PARAM(variant_num, "d"),
  if (!prob->abstract && show_adv) {
    extra_msg = "";
    if (prob->variant_num <= 0) {
      prob->variant_num = 0;
      extra_msg = "<i>(No variants)</i>";
    }

    snprintf(num_buf, sizeof(num_buf), "%d", prob->variant_num);
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>%s</td><td>", form_row_attrs[row ^= 1],
            "Number of variants:");
    html_edit_text_form(f, 0, 0, "param", num_buf);
    fprintf(f, "%s</td><td>", extra_msg);
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_VARIANT_NUM, "Change");
    if (prob->variant_num > 0) {
      fprintf(f, "%sEdit variants</a>",
              html_hyperref(hbuf, sizeof(hbuf), session_id, self_url, extra_args,
                            "action=%d", SSERV_CMD_PROB_EDIT_VARIANTS));
    }
    fprintf(f, "</td>");
    print_help_url(f, SSERV_CMD_PROB_CHANGE_VARIANT_NUM);
    fprintf(f, "</tr></form>\n");
  }

  //PROBLEM_PARAM(start_date, "t"),
  if (!prob->abstract && show_adv && !global->contest_time) {
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>Accept start date:</td><td>",
            form_row_attrs[row ^= 1]);
    html_date_select(f, prob->start_date);
    fprintf(f, "</td><td>");
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_START_DATE, "Change");
    html_submit_button(f, SSERV_CMD_PROB_CLEAR_START_DATE, "Clear");
    fprintf(f, "</td></tr></form>\n");
  }
  //PROBLEM_PARAM(deadline, "t"),
  if (!prob->abstract && show_adv && !global->contest_time) {
    html_start_form(f, 1, self_url, prob_hidden_vars);
    fprintf(f, "<tr%s><td>Accept deadline:</td><td>",
            form_row_attrs[row ^= 1]);
    html_date_select(f, prob->deadline);
    fprintf(f, "</td><td>");
    html_submit_button(f, SSERV_CMD_PROB_CHANGE_DEADLINE, "Change");
    html_submit_button(f, SSERV_CMD_PROB_CLEAR_DEADLINE, "Clear");
    fprintf(f, "</td></tr></form>\n");
  }

  if (show_adv) {
    //PROBLEM_PARAM(source_header, "s"),
    extra_msg = "";
    prepare_set_prob_value(CNTSPROB_source_header,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->source_header[0]) {
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->source_header));
      extra_msg = msg_buf;
    }
    print_string_editing_row_2(f, "Source header file:", prob->source_header,
                               SSERV_CMD_PROB_CHANGE_SOURCE_HEADER,
                               SSERV_CMD_PROB_CLEAR_SOURCE_HEADER,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);

    //PROBLEM_PARAM(source_footer, "s"),
    extra_msg = "";
    prepare_set_prob_value(CNTSPROB_source_footer,
                           tmp_prob, sup_prob, sstate->global);
    if (!prob->source_footer[0]) {
      snprintf(msg_buf, sizeof(msg_buf), "<i>(Default - \"%s\")</i>",
               ARMOR(tmp_prob->source_footer));
      extra_msg = msg_buf;
    }
    print_string_editing_row_2(f, "Source footer file:", prob->source_footer,
                               SSERV_CMD_PROB_CHANGE_SOURCE_FOOTER,
                               SSERV_CMD_PROB_CLEAR_SOURCE_FOOTER,
                               extra_msg,
                               session_id, form_row_attrs[row ^= 1],
                               self_url, extra_args, prob_hidden_vars);
  }

  if (prob->unhandled_vars) {
    fprintf(f, "<tr%s><td colspan=\"3\" align=\"center\"><b>Uneditable parameters</td></tr>\n<tr><td colspan=\"3\"><pre>%s</pre></td></tr>\n",
            form_row_attrs[row ^= 1], ARMOR(prob->unhandled_vars));
  }
-->
<%
  }
%><%
  tmp_prob = prepare_problem_free(tmp_prob);
%>
